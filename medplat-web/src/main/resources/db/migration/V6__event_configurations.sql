TRUNCATE public.event_configuration CASCADE;

INSERT INTO public.event_configuration (id,created_by,created_on,modified_by,modified_on,"day",description,event_type,event_type_detail_id,form_type_id,"hour","minute","name",config_json,state,trigger_when,event_type_detail_code,uuid) VALUES
	 (23,409,'2018-06-15 12:37:33.56',58981,'2021-01-19 16:09:49.983',NULL,NULL,'FORM_SUBMITTED',NULL,3,NULL,NULL,'WPD visit','[{"query":"select rch_wpd_mother_master.id, rch_wpd_mother_master.member_id, rch_wpd_mother_master.family_id, \n(case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end) as location_id,\nto_char(rch_wpd_mother_master.date_of_delivery, ''MM/DD/YYYY'') as date_of_delivery, \nto_char(rch_wpd_mother_master.death_date, ''MM/DD/YYYY'') as death_date, \nrch_wpd_mother_master.death_reason, rch_wpd_mother_master.place_of_death, rch_wpd_mother_master.death_infra_id,\ncast(null as text) as other_death_reason,\nrch_wpd_mother_master.member_status, rch_wpd_mother_master.notification_id, \nrch_wpd_mother_master.has_delivery_happened, imt_member.cur_preg_reg_det_id, \nrch_wpd_mother_master.pregnancy_reg_det_id, rch_wpd_mother_master.created_by, \nrch_wpd_mother_master.is_discharged, rch_wpd_mother_master.discharge_date,  \nrch_wpd_mother_master.is_high_risk_case, \nrch_wpd_mother_master.family_planning_method,\nto_char(rch_wpd_mother_master.date_of_delivery + interval ''42'' day, ''MM/DD/YYYY'') as next_lmp_date,\ncase \n\twhen rch_wpd_mother_master.member_status = ''AVAILABLE''\n\tand rch_wpd_mother_master.has_delivery_happened = true\n\tand death_date is null\n\tand rch_wpd_mother_master.delivery_place = ''HOME'' \n\tand rch_wpd_mother_master.date_of_delivery > current_date - interval ''2 days''\n\tthen true else false end as generate_first_pnc\n,rch_wpd_mother_master.delivery_place\n,case when rch_wpd_mother_master.date_of_delivery is not null \n\t\tand rch_wpd_mother_master.date_of_delivery < imt_member.lmp + interval ''20 weeks'' then true\n\t\telse false end as del_before_20_weeks\nfrom rch_wpd_mother_master inner join imt_family on rch_wpd_mother_master.family_id = imt_family.id \ninner join imt_member on rch_wpd_mother_master.member_id = imt_member.id \nwhere rch_wpd_mother_master.id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#has_delivery_happened#'' == ''true''","conditionParam":"member_status,has_delivery_happened","description":null,"notificaitonConfigsType":[{"id":"1cd7545e-46d0-41d0-8256-105feffcf423","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'', modified_on = now(),action_by = #created_by# where member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'') and notification_type_id = (select id from notification_type_master where code = ''FHW_WPD'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":53,"queryCode":null,"queryMasterParamJson":[],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"424e6076-b7ba-4e46-925f-c6a3be0891ae","type":"QUERY","template":"update imt_member set is_pregnant = false, immunisation_given = null, \nlast_delivery_date = case when ''#date_of_delivery#'' = ''null'' then imt_member.last_delivery_date else to_date((case when ''#date_of_delivery#'' = ''null'' then null else ''#date_of_delivery#'' end), ''MM/DD/YYYY'') end, \nlast_delivery_outcome = case when ''#pregnancy_outcome#'' != ''null'' then ''#pregnancy_outcome#'' else imt_member.last_delivery_outcome end,\nlast_method_of_contraception = case when ''#family_planning_method#'' != ''null'' then ''#family_planning_method#'' else imt_member.last_method_of_contraception end,\nis_high_risk_case = case when ''#is_high_risk_case#'' != ''null'' then #is_high_risk_case# else imt_member.is_high_risk_case end\nwhere id =  #member_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,is_high_risk_case,date_of_delivery,family_planning_method,pregnancy_outcome","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"7e53812e-c069-44cb-84a7-fa636c1f7b64","type":"QUERY","template":"update event_mobile_notification_pending set is_completed = true, state = ''COMPLETED'', \nmodified_by = #created_by#, modified_on = now() \nfrom event_configuration_type\nwhere event_mobile_notification_pending.member_id = #member_id# \nand event_mobile_notification_pending.state = ''PENDING'' \nand event_mobile_notification_pending.notification_configuration_type_id = event_configuration_type.id\nand event_configuration_type.mobile_notification_type in (select id from notification_type_master where code in (''FHW_ANC'', ''FHW_WPD'', ''TT2_ALERT'', ''IRON_SUCROSE_ALERT''))","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"66c59fe2-d995-466a-8b12-be207bf605c0","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_DELIVERY_HAPPENED'', modified_on = now() \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'') \nand notification_type_id in (select id from notification_type_master where code in (''FHW_ANC'', ''TT2_ALERT'', ''IRON_SUCROSE_ALERT'', ''ASHA_ANC''));","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"00c526aa-d624-47f6-8387-40d5e94d3abe","type":"QUERY","template":"update rch_pregnancy_registration_det set state = ''DELIVERY_DONE'', delivery_date = ''#date_of_delivery#'' where id = #pregnancy_reg_det_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"date_of_delivery,pregnancy_reg_det_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#has_delivery_happened#'' == ''false''","conditionParam":"member_status,has_delivery_happened","description":null,"notificaitonConfigsType":[{"id":"3afd5d29-49c6-489c-9283-2bb095cf6ae3","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":52,"queryCode":"mob_notification_reschedule","queryMasterParamJson":[{"parameterName":"expiary_days_add","mappingValue":null,"isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"due_days_add","mappingValue":null,"isFixed":false},{"parameterName":"schedule_days_add","mappingValue":"7","isFixed":true},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"93ff2dd7-f25e-4fe4-9771-6dd0a1d95197","type":"QUERY","template":"update imt_member set modified_on = now() where id = #member_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#generate_first_pnc# == true","conditionParam":"generate_first_pnc","description":null,"notificaitonConfigsType":[{"id":"585097a3-3f7c-4421-b43b-a5113ff72de4","type":"QUERY","template":"INSERT INTO techo_notification_master(\n\tnotification_type_id, notification_code, location_id,\n\tfamily_id, member_id, schedule_date, due_on, expiry_date, \n\tstate, created_by, created_on, modified_by, modified_on, ref_code\n)\nselect id, null, #location_id#, #family_id#, #member_id#, ''#date_of_delivery#'',\nto_timestamp(''#date_of_delivery#'', ''MM/DD/YYYY'') + interval ''2 days'', \nto_timestamp(''#date_of_delivery#'', ''MM/DD/YYYY'') + interval ''2 days'', \n''PENDING'', #created_by#, now(), #created_by#, now(), #pregnancy_reg_det_id#\nfrom notification_type_master where code = ''FHW_PNC''","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,family_id,date_of_delivery,created_by,pregnancy_reg_det_id,location_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#has_delivery_happened#'' == ''true'' &&  ''#death_date#'' == ''null''","conditionParam":"member_status,has_delivery_happened,death_date","description":null,"notificaitonConfigsType":[{"id":"9b1a331b-fac5-48f0-908e-ef545e0b0c52","type":"MOBILE","template":null,"mobileNotificationType":3,"mobileNotificationTypeUUID":"bfd41946-0837-4ff7-8c16-c90d8b019c06","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"date_of_delivery","refCode":"pregnancy_reg_det_id","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"884b8013-fa5a-435d-b6ee-8d5f68b21b49","notificationCode":"0","numberOfDaysAddedForOnDate":3,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":6,"notificationTypeConfigId":"9b1a331b-fac5-48f0-908e-ef545e0b0c52"},{"id":"2e13a686-6b3d-4ce6-8db9-29080ebebbe3","notificationCode":"1","numberOfDaysAddedForOnDate":7,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":13,"notificationTypeConfigId":"9b1a331b-fac5-48f0-908e-ef545e0b0c52"},{"id":"d31c96b6-c10c-49ee-ae0d-741e3b47ec1f","notificationCode":"2","numberOfDaysAddedForOnDate":14,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":20,"notificationTypeConfigId":"9b1a331b-fac5-48f0-908e-ef545e0b0c52"},{"id":"cc519f5f-dc4b-4714-8b7d-6edcba84c27d","notificationCode":"3","numberOfDaysAddedForOnDate":21,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":27,"notificationTypeConfigId":"9b1a331b-fac5-48f0-908e-ef545e0b0c52"},{"id":"ab633f2d-d4f9-4b66-a94b-0476f7174198","notificationCode":"4","numberOfDaysAddedForOnDate":28,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":41,"notificationTypeConfigId":"9b1a331b-fac5-48f0-908e-ef545e0b0c52"},{"id":"708be876-1da9-4291-a1e5-5abc009a8d27","notificationCode":"5","numberOfDaysAddedForOnDate":42,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":60,"notificationTypeConfigId":"9b1a331b-fac5-48f0-908e-ef545e0b0c52"}],"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"54d751f7-6826-4471-a181-f9159f26cceb","type":"MOBILE","template":null,"mobileNotificationType":31,"mobileNotificationTypeUUID":"93576c97-172b-436f-9c9a-cb3e7226c524","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"date_of_delivery","refCode":"cur_preg_reg_det_id","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"12b09d99-6c07-4d40-9a49-d121ec1883dd","notificationCode":"1","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":null,"numberOfDaysAddedForExpiryDate":1,"notificationTypeConfigId":"54d751f7-6826-4471-a181-f9159f26cceb"},{"id":"18a7a94f-2833-4ca2-8d25-b99512bbcbe1","notificationCode":"2","numberOfDaysAddedForOnDate":2,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":5,"notificationTypeConfigId":"54d751f7-6826-4471-a181-f9159f26cceb"},{"id":"0f07620f-8266-45ba-8d5b-3f3719dbb3ef","notificationCode":"3","numberOfDaysAddedForOnDate":6,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":10,"notificationTypeConfigId":"54d751f7-6826-4471-a181-f9159f26cceb"},{"id":"09763449-b466-4f83-8d12-4bdddc6df3a0","notificationCode":"4","numberOfDaysAddedForOnDate":11,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":17,"notificationTypeConfigId":"54d751f7-6826-4471-a181-f9159f26cceb"},{"id":"fb0369f1-c5af-4047-b3d7-d9c3fdd35f23","notificationCode":"5","numberOfDaysAddedForOnDate":18,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":24,"notificationTypeConfigId":"54d751f7-6826-4471-a181-f9159f26cceb"},{"id":"da486aae-0738-4d82-950e-e23216e1eb35","notificationCode":"6","numberOfDaysAddedForOnDate":25,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":38,"notificationTypeConfigId":"54d751f7-6826-4471-a181-f9159f26cceb"},{"id":"c4432b8e-3ee8-4032-8ec5-8df1a5e59aa2","notificationCode":"7","numberOfDaysAddedForOnDate":39,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":44,"notificationTypeConfigId":"54d751f7-6826-4471-a181-f9159f26cceb"}],"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"b7463aa3-b1fd-43ab-b126-07a49a1b6bf6","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"710cbd3b-711a-408f-a8b6-c63255f3aaf3","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":"generate_asha_lmpfu_notification","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#has_delivery_happened#'' == ''true'' && ''#death_date#'' != ''null''","conditionParam":"member_status,has_delivery_happened,death_date","description":null,"notificaitonConfigsType":[{"id":"9a609b44-4ac1-419f-9a56-c2b00e3981a1","type":"QUERY","template":"","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false}, {"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"WPD_MOTHER","isFixed":true},{"parameterName":"reference_id","mappingValue":"resourceId","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#has_delivery_happened#'' == ''true'' &&  ''#death_date#'' == ''null'' && ''#is_discharged#'' != ''null'' && ''#is_discharged#'' == ''false''","conditionParam":"member_status,has_delivery_happened,is_discharged,death_date","description":"Create an entry for WPD_DISCHARGE Notification","notificaitonConfigsType":[{"id":"17044f5e-2900-499f-b7ac-bb4f77a8f900","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":"generate_discharge_notification","queryMasterParamJson":[{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"date_of_delivery","mappingValue":"date_of_delivery","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false},{"parameterName":"pregnancy_reg_det_id","mappingValue":"cur_preg_reg_det_id","isFixed":false},{"parameterName":"id","mappingValue":"id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#pregnancy_reg_det_id#'' == ''null'' || ''#pregnancy_reg_det_id#'' == ''-1''","conditionParam":"pregnancy_reg_det_id","description":"Update Current Pregnancy registration Details ID in WPD Mother Master","notificaitonConfigsType":[{"id":"fff826e7-486a-46ac-b855-659477585954","type":"QUERY","template":"update rch_wpd_mother_master set pregnancy_reg_det_id = #cur_preg_reg_det_id# where id = #id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"cur_preg_reg_det_id,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#delivery_place#'' == ''HOME'' && ''#has_delivery_happened#'' == ''true''","conditionParam":"delivery_place,has_delivery_happened","description":null,"notificaitonConfigsType":[{"id":"8041a04c-01ae-44df-bdfb-08d812521a62","type":"QUERY","template":"INSERT INTO techo_web_notification_master(\n            notification_type_id, location_id, \n            member_id, escalation_level_id, schedule_date, \n            state, created_by, created_on, \n            modified_by, modified_on, ref_code, notification_type_escalation_id\n            )\nselect notification_type_id,#location_id#,\n\t\t\t#member_id#,notification_type.id,now(),\n\t\t\t''PENDING'',#created_by#,now(),#created_by#,now(),#id#,escalation_id\n\t\t\tfrom (select id,notification_type_id,notification_type_id||''_''||id as escalation_id from escalation_level_master where name = ''Default'' \nand notification_type_id = (select id from notification_type_master where code = ''home_delivery_verification'')) as notification_type","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,id,created_by,location_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#del_before_20_weeks# == true","conditionParam":"del_before_20_weeks","description":null,"notificaitonConfigsType":[{"id":"d53536a3-4e9e-4740-aa1d-0ce9600db251","type":"QUERY","template":"update imt_member set current_para = case when current_para is not null then current_para - 1 else null end \nwhere id = #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]},{"query":"with wpd_child_det as(select ROW_NUMBER () OVER (ORDER BY rch_wpd_child_master.id) as row_num, rch_wpd_child_master.member_id, rch_wpd_child_master.family_id, rch_wpd_child_master.pregnancy_outcome, rch_wpd_mother_master.location_id, rch_wpd_child_master.mother_id, rch_wpd_mother_master.id as wpd_mother_id, to_char(rch_wpd_child_master.death_date,''MM/DD/YYYY'') as death_date, to_char(rch_wpd_child_master.date_of_delivery,''MM/DD/YYYY'') as dob, rch_wpd_child_master.created_by as action_by, rch_wpd_child_master.death_reason, rch_wpd_child_master.member_status, rch_wpd_child_master.place_of_death, rch_wpd_mother_master.delivery_place as place_of_birth, rch_wpd_child_master.birth_weight, rch_wpd_child_master.breast_feeding_in_one_hour as complimentary_feeding_started, rch_wpd_child_master.is_high_risk_case from rch_wpd_child_master, rch_wpd_mother_master where rch_wpd_mother_master.id = #resourceId# and rch_wpd_mother_master.id = rch_wpd_child_master.wpd_mother_id), count_det as(select count(*) as cnt from wpd_child_det) select * from wpd_child_det, count_det","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#member_id# != -1 && ''#death_date#'' == ''null''","conditionParam":"member_id,death_date","description":null,"notificaitonConfigsType":[{"id":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67","type":"MOBILE","template":null,"mobileNotificationType":4,"mobileNotificationTypeUUID":"91fb960a-6168-4d07-879f-fc3d9e637b18","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"dob","refCode":null,"memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"0606597d-8958-4935-bcf1-2cd46bd3d532","notificationCode":"1","numberOfDaysAddedForOnDate":75,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":104,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"92231745-a5c0-4c23-9dbd-07f2149335ae","notificationCode":"2","numberOfDaysAddedForOnDate":105,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":278,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"7a4c7418-e5f0-4a99-89c5-88f5f481bb45","notificationCode":"3","numberOfDaysAddedForOnDate":279,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":489,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"a000f46a-cc27-4a4b-b9b0-a5f3d206ea4e","notificationCode":"4","numberOfDaysAddedForOnDate":490,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":730,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"43a79980-2efa-4652-838c-b1d2705a3abe","notificationCode":"5","numberOfDaysAddedForOnDate":731,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":916,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"f4bc6173-51b0-464b-8036-4810765f7713","notificationCode":"6","numberOfDaysAddedForOnDate":917,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":1095,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"d6daf397-c9fd-4fdd-99a9-37192d7794b3","notificationCode":"7","numberOfDaysAddedForOnDate":1096,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":1281,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"536f68b3-ee1e-4e66-b748-6e561d0cb50f","notificationCode":"8","numberOfDaysAddedForOnDate":1282,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":1461,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"2c16c716-d4a0-480e-b02e-ca27acdc75bb","notificationCode":"9","numberOfDaysAddedForOnDate":1462,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":1647,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"5c941e59-b1cb-4005-96a3-01e302306f65","notificationCode":"10","numberOfDaysAddedForOnDate":1648,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":1799,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"},{"id":"e5085993-9df1-42e2-b808-4ebbac855ae7","notificationCode":"12","numberOfDaysAddedForOnDate":1827,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":2013,"notificationTypeConfigId":"f51c8c4f-6b2b-4dcb-8e64-ada1a3044a67"}],"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"7c6ba928-e102-4232-8646-9859e14796dc","type":"MOBILE","template":null,"mobileNotificationType":32,"mobileNotificationTypeUUID":"51095276-de38-4e97-8744-ec1a688764a2","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"dob","refCode":null,"memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"b859f0a2-4313-4eb0-b9af-79ed4db07b99","notificationCode":"1","numberOfDaysAddedForOnDate":90,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":180,"notificationTypeConfigId":"7c6ba928-e102-4232-8646-9859e14796dc"},{"id":"f96a87c2-96e6-49d5-85c6-558eaefd12d7","notificationCode":"2","numberOfDaysAddedForOnDate":181,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":210,"notificationTypeConfigId":"7c6ba928-e102-4232-8646-9859e14796dc"},{"id":"bd228218-3be9-47a5-a7b9-47e05f05bded","notificationCode":"3","numberOfDaysAddedForOnDate":211,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":300,"notificationTypeConfigId":"7c6ba928-e102-4232-8646-9859e14796dc"},{"id":"ab54bcd0-4b39-4b46-9a0d-cb2d43d99524","notificationCode":"4","numberOfDaysAddedForOnDate":301,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":360,"notificationTypeConfigId":"7c6ba928-e102-4232-8646-9859e14796dc"},{"id":"aa0f6303-5677-4b3e-b40e-a6b27d5c0314","notificationCode":"5","numberOfDaysAddedForOnDate":361,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":690,"notificationTypeConfigId":"7c6ba928-e102-4232-8646-9859e14796dc"},{"id":"6d327f4d-c1dc-4a6f-8f81-010aa87599a5","notificationCode":"6","numberOfDaysAddedForOnDate":691,"numberOfDaysAddedForDueDate":30,"numberOfDaysAddedForExpiryDate":720,"notificationTypeConfigId":"7c6ba928-e102-4232-8646-9859e14796dc"}],"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"83c20288-eab6-488f-b7c0-a1bcea3ca4a6","type":"QUERY","template":"update imt_member SET modified_on = now(), modified_by = #created_by#, complementary_feeding_started = #complimentary_feeding_started#, birth_weight = #birth_weight#, place_of_birth = ''#place_of_birth#'', is_high_risk_case = #is_high_risk_case# where id = #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"place_of_birth,member_id,complimentary_feeding_started,is_high_risk_case,birth_weight,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"\"#pregnancy_outcome#\" == \"SBIRTH\"","conditionParam":"pregnancy_outcome","description":null,"notificaitonConfigsType":[{"id":"eebd58eb-1750-44ca-862a-1b03a9296e72","type":"QUERY","template":"with user_det as(\nselect um_user.id as user_id from um_user,um_user_location where um_user.id = um_user_location.user_id \nand um_user_location.state = ''ACTIVE'' and um_user.state = ''ACTIVE'' \nand um_user_location.loc_id in (select parent_id from location_hierchy_closer_det where child_id = #location_id#)\nand um_user.role_id in (select id from um_role_master where code in (''mo_uphc'',''mo_phc''))\nlimit 1\n),insert_still_birth_mo as(\nINSERT INTO techo_web_notification_master(\n            notification_type_id, location_id, \n            member_id, escalation_level_id, schedule_date, \n            state, created_by, created_on, \n            modified_by, modified_on, ref_code, notification_type_escalation_id\n            )\nselect notification_type_id,#location_id#,\n\t\t\t#mother_id#,notification_type.id,now(),\n\t\t\t''PENDING'',#action_by#,now(),#action_by#,now(),#wpd_mother_id#,escalation_id\n\t\t\tfrom (select id,notification_type_id,notification_type_id||''_''||id as escalation_id from escalation_level_master where name = ''Default'' \nand notification_type_id = (select id from notification_type_master where code = ''still_birth_verification_mo'')) as notification_type\nreturning id\n)\nINSERT INTO techo_web_notification_master(\n            notification_type_id, location_id, \n            user_id,member_id, escalation_level_id, schedule_date, \n            state, created_by, created_on, \n            modified_by, modified_on, ref_code,related_notification_id, notification_type_escalation_id\n            )\nselect notification_type_id,#location_id#,(select user_id from user_det)\n\t\t\t,#mother_id#,notification_type.id,now(),\n\t\t\t''PENDING'',#action_by#,now(),#action_by#,now(),#wpd_mother_id#,insert_still_birth_mo.id,escalation_id\n\t\t\tfrom (select id,notification_type_id,notification_type_id||''_''||id as escalation_id from escalation_level_master where name = ''Default'' \nand notification_type_id = (select id from notification_type_master where code = ''still_birth_verification_ttc'')) as notification_type\n,insert_still_birth_mo;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"action_by,mother_id,location_id,wpd_mother_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#cnt# > 1 && #row_num# == #cnt#","conditionParam":"cnt,row_num","description":null,"notificaitonConfigsType":[{"id":"6dc813d7-e034-4fc9-9ef3-1b337e98397e","type":"QUERY","template":"with user_det as(\nselect um_user.id as user_id from um_user,um_user_location where um_user.id = um_user_location.user_id \nand um_user_location.state = ''ACTIVE'' and um_user.state = ''ACTIVE'' \nand um_user_location.loc_id in (select parent_id from location_hierchy_closer_det where child_id = #location_id#)\nand um_user.role_id = (select id from um_role_master where code in (''FHW''))\nlimit 1\n)\nINSERT INTO techo_web_notification_master(\n            notification_type_id, location_id, \n            user_id,member_id, escalation_level_id, schedule_date, \n            state, created_by, created_on, \n            modified_by, modified_on, ref_code, notification_type_escalation_id\n            )\nselect notification_type_id,#location_id#\n\t,(select user_id from user_det),#mother_id#,notification_type.id,now(),\n\t''PENDING'',#action_by#,now(),#action_by#,now(),#wpd_mother_id#,escalation_id\n\tfrom (select id,notification_type_id,notification_type_id||''_''||id as escalation_id from escalation_level_master where name = ''Default'' \nand notification_type_id = (select id from notification_type_master where code = ''twin_deliveries_verification'')) as notification_type","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"action_by,mother_id,location_id,wpd_mother_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":23,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'FHW_WPD','0e7e8c0f-c91e-4173-8a80-93aa92928492'),
	 (51,409,'2019-02-14 19:43:37.017',58981,'2021-08-09 13:42:13.419',NULL,'It''s call when new child was added thru FHW','FORM_SUBMITTED',NULL,33,NULL,NULL,'New Child Added','[{"query":"select imt_member.id as member_id,imt_family.id as family_id ,to_char(dob,''MM/DD/YYYY'') as dob,current_date - cast(dob as date) as days from imt_member,imt_family where imt_member.family_id = imt_family.family_id and imt_member.id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#days# < 75","conditionParam":"days","description":null,"notificaitonConfigsType":[{"id":"dfa2b7ee-0ae4-4d5e-bb8e-20252905ebc6","type":"MOBILE","template":null,"mobileNotificationType":4,"mobileNotificationTypeUUID":"91fb960a-6168-4d07-879f-fc3d9e637b18","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"dob","refCode":"","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"088b9d3d-fe68-4079-8e07-926b4fa04054","notificationCode":"1","numberOfDaysAddedForOnDate":1,"numberOfDaysAddedForDueDate":7,"numberOfDaysAddedForExpiryDate":41,"notificationTypeConfigId":"dfa2b7ee-0ae4-4d5e-bb8e-20252905ebc6"},{"id":"3830de33-3131-465c-bb94-97844bd27918","notificationCode":"2","numberOfDaysAddedForOnDate":42,"numberOfDaysAddedForDueDate":7,"numberOfDaysAddedForExpiryDate":74,"notificationTypeConfigId":"dfa2b7ee-0ae4-4d5e-bb8e-20252905ebc6"}],"configId":51,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'FHS_NEW_CHILD','1bd35d1c-9aad-4801-a740-2a5a91e936f4'),
	 (19,1,'2018-04-30 17:15:17.545',60512,'2021-04-07 18:43:55.831',NULL,NULL,'FORM_SUBMITTED',NULL,2,NULL,NULL,'ANC_config','[{"query":"select rch_anc_master.id, rch_anc_master.member_id, imt_family.id as family_id,  rch_anc_master.is_from_web,\n(case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end) as location_id, \ntecho_notification_master.id as notification_id, rch_anc_master.member_status, rch_anc_master.created_by as created_by, \nrch_anc_master.haemoglobin_count, rch_anc_master.jsy_payment_done, rch_anc_master.jsy_beneficiary, rch_anc_master.is_high_risk_case, \nrch_anc_master.blood_group, rch_anc_master.weight, rch_anc_master.last_delivery_outcome, \nto_char((case when rch_anc_master.lmp is null then imt_member.lmp else rch_anc_master.lmp end + interval ''1'' day * 281), ''MM/DD/YYYY'') as edd,\nto_char(death_date,''MM/DD/YYYY'') as death_date, death_reason, place_of_death, death_infra_id,\ncast(null as text) as other_death_reason,\nto_char(rch_anc_master.lmp,''MM/DD/YYYY'') as last_lmp_date, \nimt_member.cur_preg_reg_det_id,rch_anc_master.pregnancy_reg_det_id, \ncase when rch_anc_master.service_date is null then to_char(current_date, ''DD/MM/YYYY'') else to_char(rch_anc_master.service_date, ''DD/MM/YYYY'') end as service_date,\nto_char(rch_anc_master.iron_def_anemia_inj_due_date, ''MM/DD/YYYY'') as iron_sucrose_due_date,\nto_char(tt1.given_on, ''MM/DD/YYYY'') as tt1_given_date,\nto_char(tt2.given_on, ''MM/DD/YYYY'') as tt2_given_date,\ncase when emnp.id is null then false else true end as tt2_event_configured,\ntt2_alert.id as tt2_alert_id\nfrom rch_anc_master inner join imt_member on rch_anc_master.member_id = imt_member.id \ninner join imt_family on imt_family.family_id = imt_member.family_id \nleft join techo_notification_master on techo_notification_master.member_id = rch_anc_master.member_id and techo_notification_master.notification_type_id = 2 and techo_notification_master.state in (''PENDING'',''RESCHEDULE'') \nleft join rch_immunisation_master tt1 on tt1.member_id = rch_anc_master.member_id and tt1.pregnancy_reg_det_id = rch_anc_master.pregnancy_reg_det_id and tt1.immunisation_given = ''TT1''\nleft join rch_immunisation_master tt2 on tt2.member_id = rch_anc_master.member_id and tt2.pregnancy_reg_det_id = rch_anc_master.pregnancy_reg_det_id and tt2.immunisation_given = ''TT2''\nleft join event_mobile_notification_pending emnp on emnp.member_id = rch_anc_master.member_id and emnp.state = ''PENDING'' and emnp.notification_configuration_type_id = (\n\tselect id from event_configuration_type where mobile_notification_type = (select id from notification_type_master where code = ''TT2_ALERT'')\n)\nleft join techo_notification_master tt2_alert on tt2_alert.member_id = rch_anc_master.member_id and tt2_alert.state = ''PENDING'' and tt2_alert.notification_type_id = (\n\tselect id from notification_type_master where code = ''TT2_ALERT''\n)\nwhere rch_anc_master.id = #resourceId# limit 1;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#member_status#'' == ''DEATH''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"50c8d1d9-5b30-4d52-bf13-7d39243c27eb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_ANC","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"75bf1f30-d589-4f37-a866-1c1436fe3631","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#notification_id#'' == ''null'' && ''#member_status#'' == ''AVAILABLE'' && (''#is_from_web#'' == ''null'' || #is_from_web# == false)","conditionParam":"is_from_web,member_status,notification_id","description":null,"notificaitonConfigsType":[{"id":"5d884ebb-f202-4011-8e72-1f4814797473","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'' , action_by = #created_by# \nwhere member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'')  and notification_type_id = (select id from notification_type_master where code = ''FHW_ANC'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#notification_id#'' !== ''null'' && ''#member_status#'' == ''AVAILABLE''","conditionParam":"member_status,notification_id","description":null,"notificaitonConfigsType":[{"id":"1daab3d9-98b6-4267-949d-15e577a5ec03","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''WRONGLY_REGISTERED''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"30293ed6-8f45-41d2-8aec-bc97b65a551f","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":54,"queryCode":"mark_as_wrongly_pregnancy_mark","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"normal_cycle_days","mappingValue":"normal_cycle_days","isFixed":false},{"parameterName":"last_lmp_date","mappingValue":"last_lmp_date","isFixed":false},{"parameterName":"pregnancy_reg_det_id","mappingValue":"pregnancy_reg_det_id","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"bbc08f94-cc1b-4e6c-be8e-aebaafd50f8c","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_lmp_date#'' != ''null'' || ''#edd#'' != ''null'' || #weight# != null || ''#blood_group#'' != ''null'' || #jsy_beneficiary# != null || #jsy_payment_done# != null || #haemoglobin_count# != null || #is_high_risk_case# != null || ''#last_delivery_outcome#'' != ''null''","conditionParam":"jsy_beneficiary,is_high_risk_case,edd,last_delivery_outcome,weight,blood_group,haemoglobin_count,last_lmp_date,jsy_payment_done","description":null,"notificaitonConfigsType":[{"id":"2217c524-4f2b-4f05-9053-7b4ec3fb21dc","type":"QUERY","template":"update imt_member set \nanc_visit_dates = concat((case when anc_visit_dates is not null then concat(anc_visit_dates,'','') else null end), ''#service_date#''), \nlmp = case when ''#last_lmp_date#'' = ''null'' then imt_member.lmp else cast((case when ''#last_lmp_date#'' = ''null'' then null else ''#last_lmp_date#'' end) as date) end, \nedd = case when ''#edd#'' = ''null'' then imt_member.edd else cast((case when ''#edd#'' = ''null'' then null else ''#edd#'' end) as date) end, \nearly_registration = ((case when ''#last_lmp_date#'' = ''null'' then imt_member.lmp else cast((case when ''#last_lmp_date#'' = ''null'' then null else ''#last_lmp_date#'' end) as date) end) + 100 * INTERVAL ''1 day'') >= now(), \nweight = (case when #weight# is not null then #weight# else imt_member.weight end), \nblood_group = (case when ''#blood_group#'' != ''null'' then ''#blood_group#'' else imt_member.blood_group end), \njsy_payment_given = case when #jsy_payment_done# is not null then #jsy_payment_done# else imt_member.jsy_payment_given end, \njsy_beneficiary = case when #jsy_beneficiary# is not null then #jsy_beneficiary# else imt_member.jsy_beneficiary end, \nis_high_risk_case = case when #is_high_risk_case# is not null and #is_high_risk_case# = true then #is_high_risk_case# else imt_member.is_high_risk_case end, \nhaemoglobin = case when #haemoglobin_count# is not null then #haemoglobin_count# else imt_member.haemoglobin end, \nlast_delivery_outcome = case when ''#last_delivery_outcome#'' != ''null'' then ''#last_delivery_outcome#'' else imt_member.last_delivery_outcome end, \nmodified_on = now(), modified_by = #created_by# where id = #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,jsy_beneficiary,is_high_risk_case,edd,service_date,last_delivery_outcome,weight,blood_group,haemoglobin_count,last_lmp_date,created_by,jsy_payment_done","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_lmp_date#'' != ''null'' && ''#member_status#'' != ''WRONGLY_REGISTERED''","conditionParam":"member_status,last_lmp_date","description":null,"notificaitonConfigsType":[{"id":"c8002440-07ae-4b5b-b9b3-f488eb41264d","type":"QUERY","template":"update rch_pregnancy_registration_det set lmp_date = ''#last_lmp_date#'', edd = (cast(''#last_lmp_date#'' as date) + interval ''1'' day * 281), modified_on = now(), modified_by = #created_by#  where id = #pregnancy_reg_det_id#;\nupdate event_mobile_notification_pending set base_date = ''#last_lmp_date#'', modified_on = now(), modified_by = #created_by#  where member_id = #member_id#  and notification_configuration_type_id in (''5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a'',''faedb8e7-3e46-40a2-a9ac-ea7d5de944fa'') and ref_code = #pregnancy_reg_det_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,last_lmp_date,created_by,pregnancy_reg_det_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#pregnancy_reg_det_id#'' == ''null'' || ''#pregnancy_reg_det_id#'' == ''-1''","conditionParam":"pregnancy_reg_det_id","description":null,"notificaitonConfigsType":[{"id":"fbe31e48-ade3-441f-8e4c-391a00f4cee2","type":"QUERY","template":"update rch_anc_master set pregnancy_reg_det_id = #cur_preg_reg_det_id# where id = #id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"cur_preg_reg_det_id,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#tt1_given_date#'' != ''null'' && ''#tt2_given_date#'' == ''null'' && #tt2_event_configured# == false && #tt2_alert_id# == null","conditionParam":"tt1_given_date,tt2_given_date,tt2_event_configured,tt2_alert_id","description":"This will generate the TT2 alert for the beneficiary","notificaitonConfigsType":[{"id":"45056772-3000-40ea-926c-a63a4f140e38","type":"MOBILE","template":null,"mobileNotificationType":35,"mobileNotificationTypeUUID":"cb251690-e755-4e6f-aacd-32deccb13b79","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"tt1_given_date","refCode":"pregnancy_reg_det_id","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"e2b029c3-65e6-48f7-a1c7-15e33bd32d97","notificationCode":"0","numberOfDaysAddedForOnDate":28,"numberOfDaysAddedForDueDate":31,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"45056772-3000-40ea-926c-a63a4f140e38"}],"configId":19,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#tt2_given_date#'' != ''null'' && #tt2_alert_id# != null","conditionParam":"tt2_given_date,tt2_alert_id","description":null,"notificaitonConfigsType":[{"id":"522984cd-ccc4-4efb-84e8-ded121c6b2bd","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":19,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"tt2_alert_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#iron_sucrose_due_date#'' != ''null''","conditionParam":"iron_sucrose_due_date","description":null,"notificaitonConfigsType":[{"id":"a2cd5671-beda-4e6d-a355-5f1b107369c7","type":"MOBILE","template":null,"mobileNotificationType":36,"mobileNotificationTypeUUID":"99d837e9-3df4-4dc9-aafc-b84660d8b066","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"iron_sucrose_due_date","refCode":"pregnancy_reg_det_id","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"0e41aa0f-d0b0-47c4-ab65-e4fdbe1c07a3","notificationCode":"0","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":3,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"a2cd5671-beda-4e6d-a355-5f1b107369c7"}],"configId":19,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'FHW_ANC','b0c0867b-d2b9-4ba4-8feb-b8d20147addd'),
	 (56,58981,'2019-04-02 11:21:53.919',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,40,NULL,NULL,'Migration Out Event','[{"query":"select id, member_id, created_by, out_of_state from migration_master where id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#out_of_state# == null || #out_of_state# == false","conditionParam":"out_of_state","description":null,"notificaitonConfigsType":[{"id":"5edf9093-ca82-48bf-8772-03390bacb2f8","type":"QUERY","template":"update techo_notification_master set state = case when state = ''PENDING'' then ''MARK_AS_MIGRATED_PENDING'' \n\twhen state = ''RESCHEDULE'' then ''MARK_AS_MIGRATED_RESCHEDULE'' end, \nmodified_on = now(), modified_by = #created_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'');\n\nupdate event_mobile_notification_pending set is_completed = true, state = ''MARK_AS_MIGRATED_PENDING'', \nmodified_by = #created_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''PENDING'';\n\nupdate imt_member set state = ''com.argusoft.imtecho.member.state.migrated'', \nmodified_on = now(), modified_by = #created_by# where imt_member.id = #member_id#;\n\nwith childs as (\n\tselect child_id from migration_child_rel where migration_id = #id#\n), update_notifications as (\n\tupdate techo_notification_master set state = case when state = ''PENDING'' then ''MARK_AS_MIGRATED_PENDING'' \n\t\twhen state = ''RESCHEDULE'' then ''MARK_AS_MIGRATED_RESCHEDULE'' end, \n\tmodified_on = now(), modified_by = #created_by# \n\twhere member_id in (select child_id from childs) and state in (''PENDING'', ''RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set is_completed = true, state = ''MARK_AS_MIGRATED_PENDING'', \n\tmodified_by = #created_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''PENDING''\n\treturning event_mobile_notification_pending.id\n)\nupdate imt_member set state = ''com.argusoft.imtecho.member.state.migrated'', \nmodified_on = now(), modified_by = #created_by# where imt_member.id in (select child_id from childs);","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":56,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#out_of_state# == true","conditionParam":"out_of_state","description":null,"notificaitonConfigsType":[{"id":"fe1f0b8a-3102-461d-92fc-a4aa3390b286","type":"QUERY","template":"update techo_notification_master set state = case when state = ''PENDING'' then ''MARK_AS_MIGRATED_PENDING'' \n\twhen state = ''RESCHEDULE'' then ''MARK_AS_MIGRATED_RESCHEDULE'' end, \nmodified_on = now(), modified_by = #created_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'');\n\nupdate event_mobile_notification_pending set is_completed = true, state = ''MARK_AS_MIGRATED_PENDING'', \nmodified_by = #created_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''PENDING'';\n\nupdate imt_member set state = ''com.argusoft.imtecho.member.state.migrated.outofstate'', \nmodified_on = now(), modified_by = #created_by# where imt_member.id = #member_id#;\n\nwith childs as (\n\tselect child_id from migration_child_rel where migration_id = #id#\n), update_notifications as (\n\tupdate techo_notification_master set state = case when state = ''PENDING'' then ''MARK_AS_MIGRATED_PENDING'' \n\t\twhen state = ''RESCHEDULE'' then ''MARK_AS_MIGRATED_RESCHEDULE'' end, \n\tmodified_on = now(), modified_by = #created_by# \n\twhere member_id in (select child_id from childs) and state in (''PENDING'', ''RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set is_completed = true, state = ''MARK_AS_MIGRATED_PENDING'', \n\tmodified_by = #created_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''PENDING''\n\treturning event_mobile_notification_pending.id\n)\nupdate imt_member set state = ''com.argusoft.imtecho.member.state.migrated.outofstate'', \nmodified_on = now(), modified_by = #created_by# where imt_member.id in (select child_id from childs);","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":56,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'MIG_OUT','4013a91e-c532-43ff-ad6b-8adfe0237f63'),
	 (114,74840,'2020-03-16 12:07:55.125',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,93,NULL,NULL,'CFHC confirmed widget','[{"query":"select \ntecho_web_notification_master.id as web_notification_id,\ntecho_web_notification_master.modified_by as action_by,\nlistvalue_field_value_detail.value as selected_action,\ntecho_web_notification_master.ref_code\nfrom techo_web_notification_master\n,listvalue_field_value_detail\nwhere techo_web_notification_master.id  = #resourceId#\nand cast(techo_web_notification_master.action_taken as integer) =  listvalue_field_value_detail.id","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"\"#selected_action#\" == \"Confirmed\"","conditionParam":"selected_action","description":null,"notificaitonConfigsType":[{"id":"01c7fcc3-b547-4897-b5a3-a564d7ee3bf1","type":"QUERY","template":"update techo_web_notification_master set state = ''PENDING'' where id = #web_notification_id#","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"web_notification_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":114,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]},{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"0249a924-e8c7-4778-b9bf-a442860a92f9","type":"QUERY","template":"update wt_cfhc_suspected_disease set status = ''#selected_action#'',modified_by = #action_by# where id = #ref_code#","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"selected_action,action_by,ref_code","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":114,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]}]}]','ACTIVE',NULL,'cfhc_confirm_disease','c0b0252e-f176-451e-9c88-dc18cd5bb871'),
	 (57,58981,'2019-04-02 11:23:32.134',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,41,NULL,NULL,'Migration In Confirmation Event','[{"query":"select id, member_id, state, area_migrated_to, location_migrated_to, family_migrated_to, modified_by\nfrom migration_master where id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#state#'' == ''NOT_HAPPEN'' || ''#state#'' == ''NO_RESPONSE''","conditionParam":"state","description":null,"notificaitonConfigsType":[{"id":"4fc0bf75-cf1f-45b0-9645-840e996e5781","type":"QUERY","template":"update techo_notification_master set \nstate = case when state = ''MARK_AS_MIGRATED_PENDING'' then ''PENDING'' \n\twhen state = ''MARK_AS_MIGRATED_RESCHEDULE'' then ''RESCHEDULE'' end, \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''MARK_AS_MIGRATED_PENDING'', ''MARK_AS_MIGRATED_RESCHEDULE'');\n\nupdate event_mobile_notification_pending set is_completed = false, state = ''PENDING'', \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''MARK_AS_MIGRATED_PENDING'';\n\nupdate imt_member set state = (\n\tselect from_state from imt_member_state_detail where member_id = #member_id#\n\tand from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) order by id desc limit 1\n), \nmodified_on = now(), modified_by = #modified_by# where imt_member.id = #member_id#;\n\nwith childs as(\n\tselect child_id from migration_child_rel where migration_id = #id#\n), update_notifications as (\n\tupdate techo_notification_master set \n\tstate = case when state = ''MARK_AS_MIGRATED_PENDING'' then ''PENDING'' \n\t\twhen state = ''MARK_AS_MIGRATED_RESCHEDULE'' then ''RESCHEDULE'' end, \n\tmodified_on = now(), modified_by = #modified_by# \n\twhere member_id in (select child_id from childs) and state in (''MARK_AS_MIGRATED_PENDING'', ''MARK_AS_MIGRATED_RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set is_completed = false, state = ''PENDING'', \n\tmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''MARK_AS_MIGRATED_PENDING''\n\treturning event_mobile_notification_pending.id\n), max_states as (\n\tselect sd.member_id, max(id) from imt_member_state_detail sd\n\twhere member_id in (select child_id from childs) \n\tand sd.from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) \n\tgroup by sd.member_id\n), from_states as (\n\tselect member_id, from_state \n\tfrom imt_member_state_detail imsd\n\twhere id in (select max from max_states)\n)\nupdate imt_member set modified_on = now(), modified_by = #modified_by#,\nstate = from_states.from_state\nfrom from_states\nwhere imt_member.id = from_states.member_id","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,modified_by,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":57,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#state#'' == ''CONFIRMED''","conditionParam":"state","description":null,"notificaitonConfigsType":[{"id":"7d65e6b4-116a-4599-aac9-11ef7037d936","type":"QUERY","template":"update techo_notification_master set \nfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \nstate = case when state = ''MARK_AS_MIGRATED_PENDING'' then ''PENDING'' \n\twhen state = ''MARK_AS_MIGRATED_RESCHEDULE'' then ''RESCHEDULE'' end, \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''MARK_AS_MIGRATED_PENDING'', ''MARK_AS_MIGRATED_RESCHEDULE'');\n\nupdate event_mobile_notification_pending set is_completed = false, state = ''PENDING'', \nfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''MARK_AS_MIGRATED_PENDING'';\n\nupdate imt_member set state = (\n\tselect from_state from imt_member_state_detail where member_id = #member_id#\n\tand from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) order by id desc limit 1\n),  \nfamily_id = ''#family_migrated_to#'', modified_on = now(), modified_by = #modified_by# \nwhere imt_member.id = #member_id#;\n\nwith childs as(\n\tselect child_id from migration_child_rel where migration_id = #id#\n), update_notifications as (\n\tupdate techo_notification_master set \n\tfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \n\tstate = case when state = ''MARK_AS_MIGRATED_PENDING'' then ''PENDING'' \n\t\twhen state = ''MARK_AS_MIGRATED_RESCHEDULE'' then ''RESCHEDULE'' end, \n\tmodified_on = now(), modified_by = #modified_by# \n\twhere member_id in (select child_id from childs) and state in (''MARK_AS_MIGRATED_PENDING'', ''MARK_AS_MIGRATED_RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set is_completed = false, state = ''PENDING'', \n\tfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \n\tmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''MARK_AS_MIGRATED_PENDING''\n\treturning event_mobile_notification_pending.id\n), max_states as (\n\tselect sd.member_id, max(id) from imt_member_state_detail sd\n\twhere member_id in (select child_id from childs) \n\tand sd.from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) \n\tgroup by sd.member_id\n), from_states as (\n\tselect member_id, from_state \n\tfrom imt_member_state_detail imsd\n\twhere id in (select max from max_states)\n)\nupdate imt_member set family_id = ''#family_migrated_to#'', \nmodified_on = now(), modified_by = #modified_by#, \nstate = from_states.from_state\nfrom from_states\nwhere imt_member.id = from_states.member_id","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,modified_by,family_migrated_to,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":57,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'MIG_IN_CONF','5e2af9a8-f2a0-479b-be9d-2b22e27c837e'),
	 (20,409,'2018-07-06 15:10:39.585',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,5,NULL,NULL,'Child service','[{"query":"select cs.id, case when f.area_id is null then f.location_id else f.area_id end as area_id, \ncs.member_id, cs.family_id, cs.location_id, notification_id, cs.created_by, \ncase when cs.service_date is null then to_char(current_date, ''MM/DD/YYYY'') else to_char(cs.service_date, ''MM/DD/YYYY'') end as service_date,\nany_vaccination_pending, cs.weight, cs.height, mid_arm_circumference, sd_score, have_pedal_edema, \ncs.complementary_feeding_started, cs.member_status,\nto_char(cs.death_date,''MM/DD/YYYY'') as death_date,\ncs.death_reason, cs.other_death_reason, cs.place_of_death, cs.death_infra_id\nfrom rch_child_service_master cs, imt_member m, imt_family f\nwhere cs.id= #resourceId# and m.id = cs.member_id and m.family_id = f.family_id;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#any_vaccination_pending# != true","conditionParam":"any_vaccination_pending","description":null,"notificaitonConfigsType":[{"id":"60e4ed87-927a-4d6b-a615-2af91846fbb4","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":20,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"a235ce82-6490-41f1-88c8-ba9787ef38af","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'', action_by = #created_by#, modified_on = now()\nwhere member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'')\nand notification_type_id = (select id from notification_type_master where code = ''FHW_CS'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":20,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#weight# != null || #complementary_feeding_started# != null","conditionParam":"weight,complementary_feeding_started","description":null,"notificaitonConfigsType":[{"id":"4cd86503-4da8-4c63-b31d-7d9ac82216fe","type":"QUERY","template":"update imt_member set weight = (case when #weight# is not null then #weight# else weight end),\ncomplementary_feeding_started = (case when #complementary_feeding_started# is not null then #complementary_feeding_started# else complementary_feeding_started end) \nwhere id = #member_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,weight,complementary_feeding_started","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":20,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"(#mid_arm_circumference# != null && #mid_arm_circumference# < 11.5) || (#have_pedal_edema# != null && #have_pedal_edema# == true) || ( ''#sd_score#''  != ''null'' && (''#sd_score#'' == ''SD3'' || ''#sd_score#'' == ''SD4''))","conditionParam":"have_pedal_edema,sd_score,mid_arm_circumference","description":"To generate Appetite Test Alert For Child","notificaitonConfigsType":[{"id":"c4e1557e-0be7-4fb1-ac2e-85e90e976f6c","type":"QUERY","template":"update techo_notification_master set state = ''DONE_ON_CS'', modified_by = #created_by#, modified_on = now() \nwhere member_id = #member_id# and state = ''PENDING'' and notification_type_id = (select id from notification_type_master where code = ''SAM_SCREENING'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":20,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"efbe5cba-7e7a-48c1-8c48-63e58725cf83","type":"QUERY","template":"with sam as (\n\tinsert into child_nutrition_sam_screening_master (\n\t\tmember_id, family_id, location_id, height, weight, sd_score, muac, have_pedal_edema, \n\t\tcreated_by, created_on, modified_by, modified_on, service_date, done_from, done_by, reference_id \n\t) \n\tselect #member_id#, #family_id#, #area_id#, #height#, #weight#, ''#sd_score#'', #mid_arm_circumference#, #have_pedal_edema#, #created_by#, \n\tnow(), #created_by#, now(), ''#service_date#'',''FHW_CS'', #created_by#, #id# returning id \n) \ninsert into techo_notification_master (\n\tmember_id, family_id, location_id, notification_type_id, notification_code, \n\tschedule_date, due_on, expiry_date, state, created_by, created_on, modified_by, modified_on, related_id\n) \nselect #member_id#, #family_id#, #location_id#, id, case when #have_pedal_edema# = true then ''1'' else ''0'' end, \nnow(), now() + interval ''3 days'', null, ''PENDING'', #created_by#, now(), #created_by#, now(), \n(select id from sam) from notification_type_master where code = ''APPETITE'';","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,sd_score,have_pedal_edema,family_id,mid_arm_circumference,service_date,weight,id,area_id,created_by,location_id,height","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":20,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''DEATH''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"dc515892-2091-4951-b569-322099060daf","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":20,"queryMasterId":null,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_CS","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#any_vaccination_pending# == false || #any_vaccination_pending# == null","conditionParam":"any_vaccination_pending","description":null,"notificaitonConfigsType":[{"id":"a506206e-495b-4d8d-9637-3335e4f7bb58","type":"QUERY","template":"update techo_notification_master set modified_on = now() where id = #notification_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"notification_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":20,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'FHW_CS','bbbcf2b8-8a6b-4975-b510-c98c6fa04f34'),
	 (82,58981,'2019-09-13 18:29:34.685',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,70,NULL,NULL,'Asha ANC Service Visit','[{"query":"select id, service_date, member_id, family_id, location_id,\ndeath_date, death_place, death_reason, other_death_reason,\nmember_status, is_alive, notification_id, created_by\nfrom rch_asha_anc_master where id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#notification_id# != null","conditionParam":"notification_id","description":null,"notificaitonConfigsType":[{"id":"a9e793fe-c323-45ae-a074-194b05905163","type":"QUERY","template":null,"mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":82,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]},{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"5854e6f1-65cd-485b-b36c-6c4144d64ffd","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'', action_by = #created_by#, modified_on = now()\nwhere member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'') \nand notification_type_id = (select id from notification_type_master where code = ''ASHA_ANC'')","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":82,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]}]}]','ACTIVE',NULL,'ASHA_ANC','9d8c0bba-76fd-4203-a837-b0957ca47a9b'),
	 (21,58251,'2018-08-07 11:20:25.425',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,7,NULL,NULL,'RIM Visit','[{"query":"select id, menopause_arrived, hysterectomy_done, modified_by  from imt_member where id = ''#resourceId#''","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#menopause_arrived#'' != ''null'' && ''#menopause_arrived#'' == ''true''","conditionParam":"menopause_arrived","description":null,"notificaitonConfigsType":[{"id":"e9208e36-3610-47f5-a396-de9d27d11330","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_MENOPAUSE_ARRIVED'', action_by = ''#modified_by#'', modified_by = ''#modified_by#'', modified_on = now() where member_id = ''#id#'' and state = ''PENDING''","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"modified_by,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":21,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null}]},{"isConditionReq":true,"condition":"''#hysterectomy_done#'' != ''null'' && ''#hysterectomy_done#'' == ''true''","conditionParam":"hysterectomy_done","description":null,"notificaitonConfigsType":[{"id":"504a1dda-a40b-4157-9ac5-b61be5b70e86","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_HYSTERECTOMY_DONE'', action_by = ''#modified_by#'', modified_by = ''#modified_by#'', modified_on = now() where member_id = ''#id#'' and state = ''PENDING''","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"modified_by,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":21,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null}]}]}]','ACTIVE',NULL,'FHW_RIM','b88ef06d-e38e-4ec0-aea4-c4f2f0e0fd37'),
	 (30,58981,'2018-09-08 19:34:43.452',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,10,NULL,NULL,'Migration Out Request','[{"query":"select member_id, location_migrated_to, location_migrated_from, type, state, family_migrated_from, family_migrated_to, modified_by from migration_master where id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"fbf1b41d-4318-454a-bcdc-cc1249e372a0","type":"QUERY","template":"update techo_notification_master set state = case when state = ''PENDING'' then ''MARK_AS_MIGRATED_PENDING'' \n\twhen state = ''RESCHEDULE'' then ''MARK_AS_MIGRATED_RESCHEDULE'' end, \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'');\n\nupdate event_mobile_notification_pending set is_completed = true, state = ''MARK_AS_MIGRATED_PENDING'', \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere member_id = #member_id# and state = ''PENDING'';\n\nwith rows as(\n\tINSERT INTO imt_member_state_detail(member_id, from_state, to_state, created_by, created_on, modified_by, modified_on)\n\tVALUES(#member_id#, (select state from imt_member where id = #member_id#), \n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t#modified_by#, now(), #modified_by#, now()) RETURNING id)\nupdate imt_member set current_state = (select id from rows), state = ''com.argusoft.imtecho.member.state.migrated'', \nmodified_on = now(), modified_by = #modified_by# where imt_member.id = #member_id#;","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,modified_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":30,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null}]}]}]','INACTIVE',NULL,'MIGRATION_OUT_REQ','7dcd84eb-8882-4160-a399-1481b79d9346'),
	 (22,409,'2018-06-15 16:45:44.8',58981,'2021-01-19 17:17:47.308',NULL,NULL,'FORM_SUBMITTED',NULL,4,NULL,NULL,'PNC form configure','[{"query":"select rch_pnc_mother_master.id, rch_pnc_master.family_id, rch_pnc_mother_master.mother_id as member_id, \n(case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end) as location_id, \nrch_pnc_master.notification_id, rch_pnc_mother_master.family_planning_method as last_method_of_contraception, \nto_char(rch_pnc_mother_master.fp_insert_operate_date, ''MM/DD/YYYY'') as fp_insert_operate_date,\nrch_pnc_mother_master.is_high_risk_case, to_char(rch_pnc_mother_master.death_date,''MM/DD/YYYY'') as death_date, \ndeath_reason, place_of_death, other_death_reason, death_infra_id, rch_pnc_master.created_by \nfrom rch_pnc_master left join rch_pnc_mother_master on rch_pnc_master.id = rch_pnc_mother_master.pnc_master_id \ninner join imt_member on rch_pnc_mother_master.mother_id = imt_member.id \ninner join imt_family on rch_pnc_master.family_id = imt_family.id \nwhere rch_pnc_master.id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"03dd06fc-e948-4606-8d2f-9589ee2951e4","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":22,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"52f83323-4d51-4f39-b7f6-f4517c32f761","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'', action_by = #created_by#, modified_on = now()\nwhere member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'') \nand notification_type_id = (select id from notification_type_master where code = ''FHW_PNC'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":22,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_method_of_contraception#'' != ''null'' || ''#is_high_risk_case#'' != ''null'' || ''#fp_insert_operate_date#'' != ''null''","conditionParam":"is_high_risk_case,last_method_of_contraception,fp_insert_operate_date","description":"","notificaitonConfigsType":[{"id":"a10f47d4-8ef6-45fb-a172-502dff6eb72f","type":"QUERY","template":"update imt_member set modified_on = now(), modified_by = #created_by#, \nlast_method_of_contraception = case when ''#last_method_of_contraception#'' != ''null'' then ''#last_method_of_contraception#'' else last_method_of_contraception end,\nfp_insert_operate_date = (\n\tcase when ''#fp_insert_operate_date#'' != ''null'' \n\t\tthen to_date(case when ''#fp_insert_operate_date#'' = ''null'' then ''1970-01-01'' else ''#fp_insert_operate_date#'' end, ''MM/DD/YYYY'') \n\t\telse fp_insert_operate_date end),\nis_high_risk_case = case when ''#is_high_risk_case#'' != ''null'' then #is_high_risk_case# else is_high_risk_case end \nwhere id = #member_id# ;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,is_high_risk_case,last_method_of_contraception,fp_insert_operate_date,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":22,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#death_date#'' != ''null''","conditionParam":"death_date","description":null,"notificaitonConfigsType":[{"id":"1e1ce0f2-b31c-42b2-bc64-b1441d27f9de","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":22,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_PNC_MOTHER","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]},{"query":"select rch_pnc_child_master.id, rch_pnc_master.family_id, rch_pnc_child_master.child_id as member_id, \n(case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end) as location_id, \nto_char(death_date,''MM/DD/YYYY'') as death_date, -1 as death_infra_id,\nrch_pnc_child_master.death_reason, rch_pnc_child_master.place_of_death, other_death_reason, \nrch_pnc_child_master.is_high_risk_case, rch_pnc_master.created_by \nfrom rch_pnc_master inner join rch_pnc_child_master on rch_pnc_master.id = rch_pnc_child_master.pnc_master_id \ninner join imt_member on rch_pnc_child_master.child_id = imt_member.id \ninner join imt_family on rch_pnc_master.family_id = imt_family.id \nwhere rch_pnc_master.id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#death_date#'' != ''null''","conditionParam":"death_date","description":null,"notificaitonConfigsType":[{"id":"7f43d8ea-e4bb-4ae6-a0ff-78ba38c60e77","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":22,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":null,"isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_PNC_CHILD","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#is_high_risk_case#'' != ''null''","conditionParam":"is_high_risk_case","description":null,"notificaitonConfigsType":[{"id":"03f7ce57-3580-4012-a378-2ed8072214aa","type":"QUERY","template":"update imt_member set modified_on = now() , modified_by = #created_by#, is_high_risk_case = case when ''#is_high_risk_case#'' is not null then ''#is_high_risk_case#'' else is_high_risk_case end where id = #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,is_high_risk_case,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":22,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'FHW_PNC','453e82ce-479e-4f90-a070-6c43f3058f8f'),
	 (58,58981,'2019-04-02 11:24:22.596',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,42,NULL,NULL,'Migration Out Confirmation Event','[{"query":"select id, member_id, state, area_migrated_to, location_migrated_to, family_migrated_to, modified_by\nfrom migration_master where id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#state#'' == ''CONFIRMED'' || ''#state#'' == ''NO_RESPONSE''","conditionParam":"state","description":null,"notificaitonConfigsType":[{"id":"7ace51c1-e7e2-4264-9593-aff740d468de","type":"QUERY","template":"update techo_notification_master set \nfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'');\n\nupdate event_mobile_notification_pending set\nfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''PENDING'';\n\nupdate imt_member set family_id = ''#family_migrated_to#'', \nmodified_on = now(), modified_by = #modified_by# where imt_member.id = #member_id#;\n\nwith childs as (\n\tselect child_id from migration_child_rel where migration_id = #id#\n), update_notifications as (\n\tupdate techo_notification_master set \n\tfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \n\tmodified_on = now(), modified_by = #modified_by# \n\twhere member_id in (select child_id from childs) and state in (''PENDING'', ''RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set\n\tfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \n\tmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''PENDING''\n\treturning event_mobile_notification_pending.id\n)\nupdate imt_member set family_id = ''#family_migrated_to#'', \nmodified_on = now(), modified_by = #modified_by# where imt_member.id in (select child_id from childs);","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,modified_by,family_migrated_to,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":58,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null}]}]}]','ACTIVE',NULL,'MIG_OUT_CONF','28ebe071-5d8c-492f-8138-d2700f2de9de'),
	 (59,58981,'2019-04-02 11:42:57.516',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,43,NULL,NULL,'Revert Migration','[{"query":"select id, member_id, type, no_family, is_temporary, out_of_state, area_migrated_from, location_migrated_from, state, family_migrated_from, modified_by, reported_on from migration_master where id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#out_of_state# == false && ''#type#'' == ''IN'' && #is_temporary# == false","conditionParam":"out_of_state,is_temporary,type","description":null,"notificaitonConfigsType":[{"id":"4ca64dcd-0b5d-4326-af82-facab897d8a7","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_MIGRATION_REVERT'', \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'') \nand notification_type_id in (select id from notification_type_master where code in (''MI'',''MO''))\nand migration_id = #id#;\n\nupdate techo_notification_master set \nfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'');\n\nupdate event_mobile_notification_pending set\nfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''PENDING'';\n\nupdate imt_member set family_id = ''#family_migrated_from#'', \nmodified_on = now(), modified_by = #modified_by#,\nstate = (\n\tselect from_state from imt_member_state_detail where member_id = #member_id#\n\tand from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) order by id desc limit 1\n)\nwhere imt_member.id = #member_id#;\n\nwith childs as (\n\tselect child_id from migration_child_rel where migration_id = #id#\n    union\n    select id from imt_member where mother_id = #member_id# and dob > ''#reported_on#''\n), update_notifications as (\n\tupdate techo_notification_master set \n\tfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \n\tmodified_on = now(), modified_by = #modified_by# \n\twhere member_id in (select child_id from childs) and state in (''PENDING'', ''RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set\n\tfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \n\tmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''PENDING''\n\treturning event_mobile_notification_pending.id\n), max_states as (\n\tselect sd.member_id, max(id) from imt_member_state_detail sd\n\twhere member_id in (select child_id from childs) \n\tand sd.from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) \n\tgroup by sd.member_id\n), from_states as (\n\tselect member_id, from_state \n\tfrom imt_member_state_detail imsd\n\twhere id in (select max from max_states)\n)\nupdate imt_member set family_id = ''#family_migrated_from#'', \nmodified_on = now(), modified_by = #modified_by#,\nstate = from_states.from_state\nfrom from_states\nwhere imt_member.id = from_states.member_id;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,reported_on,modified_by,id,family_migrated_from","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":59,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#out_of_state# == false && ''#type#'' == ''IN'' && #is_temporary# == true","conditionParam":"out_of_state,is_temporary,type","description":null,"notificaitonConfigsType":[{"id":"273c02a9-be99-4677-90f9-28b5db440341","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_ARCHIVED'',\nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'');\n\nupdate event_mobile_notification_pending set state = ''MARK_AS_ARCHIVED'',\nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''PENDING'';\n\nupdate imt_member set state = ''com.argusoft.imtecho.member.state.archived'',\nmodified_on = now(), modified_by = #modified_by# where imt_member.id = #member_id#;\n\nwith childs as (\n\tselect child_id from migration_child_rel where migration_id = #id#\n        union\n        select id from imt_member where mother_id = #member_id# and dob > ''#reported_on#''\n), update_notifications as (\n\tupdate techo_notification_master set state = ''MARK_AS_ARCHIVED'',\n\tmodified_on = now(), modified_by = #modified_by# \n\twhere member_id in (select child_id from childs) and state in (''PENDING'', ''RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set state = ''MARK_AS_ARCHIVED'', \n\tmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''PENDING''\n\treturning event_mobile_notification_pending.id\n)\nupdate imt_member set state = ''com.argusoft.imtecho.member.state.archived'',\nmodified_on = now(), modified_by = #modified_by# where imt_member.id in (select child_id from childs);\n\nupdate imt_family set modified_on = now(), modified_by = #modified_by#,\nstate = case when #no_family# = true then ''com.argusoft.imtecho.family.state.archived.temporary'' else state end\nwhere family_id = ''#family_migrated_to#'';","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,no_family,reported_on,modified_by,id,family_migrated_to","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":59,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#out_of_state# == false && ''#type#'' == ''OUT''","conditionParam":"out_of_state,type","description":null,"notificaitonConfigsType":[{"id":"d30eaaa1-675a-49a7-a952-3d4d306140fb","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_MIGRATION_REVERT'', \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'') \nand notification_type_id in (select id from notification_type_master where code in (''MI'',''MO''))\nand migration_id = #id#;\n\nupdate techo_notification_master set \nfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'');\n\nupdate event_mobile_notification_pending set\nfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''PENDING'';\n\nupdate imt_member set family_id = ''#family_migrated_from#'', \nmodified_on = now(), modified_by = #modified_by#,\nstate = (\n\tselect from_state from imt_member_state_detail where member_id = #member_id#\n\tand from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) order by id desc limit 1\n)\nwhere imt_member.id = #member_id#;\n\nwith childs as (\n\tselect child_id from migration_child_rel where migration_id = #id#\n        union\n        select id from imt_member where mother_id = #member_id# and dob > ''#reported_on#''\n), update_notifications as (\n\tupdate techo_notification_master set \n\tfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \n\tmodified_on = now(), modified_by = #modified_by# \n\twhere member_id in (select child_id from childs) and state in (''PENDING'', ''RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set\n\tfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \n\tmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''PENDING''\n\treturning event_mobile_notification_pending.id\n), max_states as (\n\tselect sd.member_id, max(id) from imt_member_state_detail sd\n\twhere member_id in (select child_id from childs) \n\tand sd.from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) \n\tgroup by sd.member_id\n), from_states as (\n\tselect member_id, from_state \n\tfrom imt_member_state_detail imsd\n\twhere id in (select max from max_states)\n)\nupdate imt_member set family_id = ''#family_migrated_from#'', \nmodified_on = now(), modified_by = #modified_by#,\nstate = from_states.from_state\nfrom from_states\nwhere imt_member.id = from_states.member_id;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,reported_on,modified_by,id,family_migrated_from","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":59,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#out_of_state# == true && ''#type#'' == ''IN''","conditionParam":"out_of_state,type","description":null,"notificaitonConfigsType":[{"id":"5260c608-e775-4b92-a306-65e37c6cab62","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_OUT_OF_STATE'',\nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'');\n\nupdate event_mobile_notification_pending set state = ''MARK_AS_OUT_OF_STATE'',\nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''PENDING'';\n\nupdate imt_member set state = ''com.argusoft.imtecho.member.state.archived.outofstate'',\nmodified_on = now(), modified_by = #modified_by# where imt_member.id = #member_id#;\n\nwith childs as (\n\tselect child_id from migration_child_rel where migration_id = #id#\n        union\n        select id from imt_member where mother_id = #member_id# and dob > ''#reported_on#''\n), update_notifications as (\n\tupdate techo_notification_master set state = ''MARK_AS_OUT_OF_STATE'',\n\tmodified_on = now(), modified_by = #modified_by# \n\twhere member_id in (select child_id from childs) and state in (''PENDING'', ''RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set state = ''MARK_AS_OUT_OF_STATE'', \n\tmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''PENDING''\n\treturning event_mobile_notification_pending.id\n)\nupdate imt_member set state = ''com.argusoft.imtecho.member.state.archived.outofstate'',\nmodified_on = now(), modified_by = #modified_by# where imt_member.id in (select child_id from childs);\n\nupdate imt_family set modified_on = now(), modified_by = #modified_by#,\nstate = case when #no_family# = true then ''com.argusoft.imtecho.family.state.archived.temporary.outofstate'' else state end\nwhere family_id = ''#family_migrated_to#'';","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,no_family,reported_on,modified_by,id,family_migrated_to","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":59,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#out_of_state# == true && ''#type#'' == ''OUT''","conditionParam":"out_of_state,type","description":null,"notificaitonConfigsType":[{"id":"0e32f5de-a6f7-4311-ae04-eba920ba0929","type":"QUERY","template":"update techo_notification_master set \nstate = case when state = ''MARK_AS_MIGRATED_PENDING'' then ''PENDING'' \n\twhen state = ''MARK_AS_MIGRATED_RESCHEDULE'' then ''RESCHEDULE'' end, \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''MARK_AS_MIGRATED_PENDING'', ''MARK_AS_MIGRATED_RESCHEDULE'');\n\nupdate event_mobile_notification_pending set is_completed = false, state = ''PENDING'', \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''MARK_AS_MIGRATED_PENDING'';\n\nupdate imt_member set modified_on = now(), modified_by = #modified_by#,\nstate = (\n\tselect from_state from imt_member_state_detail where member_id = #member_id#\n\tand from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) order by id desc limit 1\n)\nwhere imt_member.id = #member_id#;\n\nwith childs as(\n\tselect child_id from migration_child_rel where migration_id = #id#\n    union\n    select id from imt_member where mother_id = #member_id# and dob > ''#reported_on#''\n), update_notifications as (\n\tupdate techo_notification_master set \n\tstate = case when state = ''MARK_AS_MIGRATED_PENDING'' then ''PENDING'' \n\t\twhen state = ''MARK_AS_MIGRATED_RESCHEDULE'' then ''RESCHEDULE'' end, \n\tmodified_on = now(), modified_by = #modified_by# \n\twhere member_id in (select child_id from childs) and state in (''MARK_AS_MIGRATED_PENDING'', ''MARK_AS_MIGRATED_RESCHEDULE'')\n\treturning techo_notification_master.id\n), update_event as (\n\tupdate event_mobile_notification_pending set is_completed = false, state = ''PENDING'', \n\tmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \n\twhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \n\tand member_id in (select child_id from childs) and state = ''MARK_AS_MIGRATED_PENDING''\n\treturning event_mobile_notification_pending.id\n), max_states as (\n\tselect sd.member_id, max(id) from imt_member_state_detail sd\n\twhere member_id in (select child_id from childs) \n\tand sd.from_state not in (\n\t\t''com.argusoft.imtecho.member.state.migrated'',\n\t\t''com.argusoft.imtecho.member.state.migrated.outofstate'',\n\t\t''com.argusoft.imtecho.member.state.migrated.lfu''\n\t) \n\tgroup by sd.member_id\n), from_states as (\n\tselect member_id, from_state \n\tfrom imt_member_state_detail imsd\n\twhere id in (select max from max_states)\n)\nupdate imt_member set modified_on = now(), modified_by = #modified_by#,\nstate = from_states.from_state\nfrom from_states\nwhere imt_member.id = from_states.member_id","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,reported_on,modified_by,id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":59,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'MIG_REVERT','32a56aad-96cd-450f-9d13-997893183d83'),
	 (31,58981,'2018-09-08 19:35:39.512',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,12,NULL,NULL,'Migration Out Response','[{"query":"select member_id, location_migrated_to, location_migrated_from, type, state, family_migrated_from, family_migrated_to, modified_by from migration_master where id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"state = ''CONFIRMED''","conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"e121f026-09f6-4f21-96e7-f633c00e0572","type":"QUERY","template":"update techo_notification_master set location_id = #location_migrated_to#, \nfamily_id = (select id from imt_family where family_id = ''#family_migrated_to#''), \nstate = case when state = ''MARK_AS_MIGRATED_PENDING'' then ''PENDING'' \n\twhen state = ''MARK_AS_MIGRATED_RESCHEDULE'' then ''RESCHEDULE'' end, \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''MARK_AS_MIGRATED_PENDING'', ''MARK_AS_MIGRATED_RESCHEDULE'');\n\nupdate event_mobile_notification_pending set is_completed = false, state = ''PENDING'', \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''MARK_AS_MIGRATED_PENDING'';\n\nwith rows as(\n\tINSERT INTO imt_member_state_detail (member_id, from_state, to_state, created_by, created_on, modified_by, modified_on)\n\tVALUES(#member_id#, (select state from imt_member where id = #member_id#), \n\t\t(select from_state from imt_member_state_detail where id = (select current_state from imt_member where id = #member_id#)),\n\t\t#modified_by#, now(), #modified_by#, now()) RETURNING id)\nupdate imt_member set current_state = (select id from rows), \nstate = (select from_state from imt_member_state_detail where id = (select current_state from imt_member where id = #member_id#)), \nfamily_id = ''#family_migrated_to#'', modified_on = now(), modified_by = #modified_by# where imt_member.id = #member_id#;","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,location_migrated_to,modified_by,family_migrated_to","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":31,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null}]},{"isConditionReq":true,"condition":"state = ''NOT_HAPPEN''","conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"007b0d53-2e73-4888-b2f8-7e4aae99516b","type":"QUERY","template":"update techo_notification_master set location_id = #location_migrated_from#, \nfamily_id = (select id from imt_family where family_id = ''#family_migrated_from#''), \nstate = case when state = ''MARK_AS_MIGRATED_PENDING'' then ''PENDING'' \n\twhen state = ''MARK_AS_MIGRATED_RESCHEDULE'' then ''RESCHEDULE'' end, \nmodified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''MARK_AS_MIGRATED_PENDING'', ''MARK_AS_MIGRATED_RESCHEDULE'');\n\nupdate event_mobile_notification_pending set is_completed = false, state = ''PENDING'', \nmodified_by = #modified_by#, modified_on = now() from event_mobile_configuration \nwhere event_mobile_notification_pending.notification_configuration_type_id = event_mobile_configuration.id \nand member_id = #member_id# and state = ''MARK_AS_MIGRATED_PENDING'';\n\nwith rows as(\n\tINSERT INTO imt_member_state_detail (member_id, from_state, to_state, created_by, created_on, modified_by, modified_on)\n\tVALUES(#member_id#, (select state from imt_member where id = #member_id#), \n\t\t(select from_state from imt_member_state_detail where id = (select current_state from imt_member where id = #member_id#)),\n\t\t#modified_by#, now(), #modified_by#, now()) RETURNING id)\nupdate imt_member set current_state = (select id from rows), \nstate = (select from_state from imt_member_state_detail where id = (select current_state from imt_member where id = #member_id#)), \nfamily_id = ''#family_migrated_from#'', modified_on = now(), modified_by = #modified_by# where imt_member.id = #member_id#;","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,location_migrated_from,modified_by,family_migrated_from","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":31,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null}]}]}]','INACTIVE',NULL,'MIGRATION_OUT_RESP','fc43ae87-e855-4095-9a7d-ab4810fd270d'),
	 (28,58981,'2018-09-08 19:32:35.7',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,9,NULL,NULL,'Migration In Request','[{"query":"select mig.member_id, mig.location_migrated_to, mig.location_migrated_from, mig.type, mig.state, \nmig.family_migrated_from, mig.family_migrated_to, mig.modified_by, fam.area_id as area_id, \nfam.id as family_id, mem.state as member_state from migration_master mig inner join imt_family fam \non mig.family_migrated_to = fam.family_id inner join imt_member mem on mig.member_id = mem.id where mig.id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#member_state#'' == ''com.argusoft.imtecho.member.state.migrated''","conditionParam":"member_state","description":null,"notificaitonConfigsType":[{"id":"702d7913-e1da-4cda-875c-d6c68a401406","type":"QUERY","template":"update techo_notification_master set location_id = case when ''#area_id#'' is not null \nthen cast(''#area_id#'' as integer) else #location_migrated_to# end,\nfamily_id = #family_id#, modified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE''); \n\nupdate imt_member set family_id = ''#family_migrated_to#'', modified_on = now(), modified_by = #modified_by# \nwhere id = #member_id#;","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,family_id,location_migrated_to,modified_by,family_migrated_to,area_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":28,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null}]}]}]','INACTIVE',NULL,'MIGRATION_IN_REQ','8901dd94-8b17-47c7-b414-53e53a66f6e9'),
	 (80,58981,'2019-09-13 18:21:32.942',58981,'2021-01-19 17:20:19.266',NULL,NULL,'FORM_SUBMITTED',NULL,68,NULL,NULL,'ASHA LMP Follow Up Event','[{"query":"select rch_asha_lmp_follow_up.id, rch_asha_lmp_follow_up.member_id, rch_asha_lmp_follow_up.member_status, rch_asha_lmp_follow_up.year, \nimt_family.id as family_id, to_char(rch_asha_lmp_follow_up.service_date,''MM/DD/YYYY'') as service_date, \nimt_family.area_id as location_id, \nto_char(rch_asha_lmp_follow_up.lmp, ''MM/DD/YYYY'') as lmp_date, \nto_char(rch_asha_lmp_follow_up.lmp, ''MM/DD/YYYY'') as last_lmp_date, \nto_char(now(), ''MM/DD/YYYY'') as cur_date, \nto_char((rch_asha_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)), ''MM/DD/YYYY'') as next_lmp_date, \nto_char((rch_asha_lmp_follow_up.lmp + interval ''281 days''), ''MM/DD/YYYY'') as edd, \nrch_asha_lmp_follow_up.family_planning_method as family_planning_method, \n(case when rch_asha_lmp_follow_up.family_planning_method is null then imt_member.last_method_of_contraception else rch_asha_lmp_follow_up.family_planning_method end) as last_method_of_contraception, \nto_char(rch_asha_lmp_follow_up.fp_insert_operate_date, ''MM/DD/YYYY'') as fp_insert_operate_date, \n(case when rch_asha_lmp_follow_up.fp_insert_operate_date is null then imt_member.fp_insert_operate_date + interval ''90'' day > (rch_asha_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)) else rch_asha_lmp_follow_up.fp_insert_operate_date + interval ''90'' day > (rch_asha_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)) end) as to_generate_lmp_visit, \nrch_asha_lmp_follow_up.is_pregnant, \ntecho_notification_master.id as notification_id, \nrch_asha_lmp_follow_up.created_by as created_by, \nto_char(death_date, ''MM/DD/YYYY'') as death_date, \ndeath_reason, place_of_death, cast(null as text) as other_death_reason, \ntecho_notification_master.notification_code, \nto_char(case when imt_member.lmp is null then now() else imt_member.lmp end, ''MM/DD/YYYY'') as next_lmp_schedule_date \nfrom rch_asha_lmp_follow_up inner join imt_member on rch_asha_lmp_follow_up.member_id = imt_member.id \ninner join imt_family on imt_member.family_id = imt_family.family_id \nleft join techo_notification_master on techo_notification_master.member_id = rch_asha_lmp_follow_up.member_id \nand techo_notification_master.notification_type_id = (select id from notification_type_master where code = ''ASHA_LMPFU'')\nand techo_notification_master.state in (''PENDING'',''RESCHEDULE'') \nwhere rch_asha_lmp_follow_up.id = #resourceId# limit 1;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#year# != null || ''#lmp_date#'' != ''null'' || ''#family_planning_method#'' != ''null'' || ''#fp_insert_operate_date#'' != ''null''","conditionParam":"lmp_date,year,fp_insert_operate_date,family_planning_method","description":null,"notificaitonConfigsType":[{"id":"0c33ddb1-f0c6-4897-8408-50e4df146dbd","type":"QUERY","template":"update imt_member set year_of_wedding = (case when #year# is not null then #year# else year_of_wedding end), \nlmp = (case when ''#lmp_date#'' != ''null'' then to_date((case when ''#lmp_date#'' = ''null'' then ''1970-01-01'' else ''#lmp_date#'' end), ''MM/DD/YYYY'') else lmp end), \nlast_method_of_contraception = (case when ''#family_planning_method#'' != ''null'' then ''#family_planning_method#'' else last_method_of_contraception end), \nfp_insert_operate_date = (case when ''#fp_insert_operate_date#'' != ''null'' then to_date((case when ''#fp_insert_operate_date#'' = ''null'' then ''1970-01-01'' else ''#fp_insert_operate_date#'' end), ''MM/DD/YYYY'') else fp_insert_operate_date end),\nmodified_by = #created_by#, modified_on = now() where id = #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"lmp_date,member_id,year,fp_insert_operate_date,family_planning_method,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#lmp_date#'' !== ''null'' && (#is_pregnant# == null || #is_pregnant# == false)","conditionParam":"lmp_date,is_pregnant","description":null,"notificaitonConfigsType":[{"id":"109c377a-740a-4e24-94d6-23d416e4ed03","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"5575355b-37df-46a6-aa4b-1fca5df85122","type":"QUERY","template":"update techo_notification_master set state = ''DONE_BY_ASHA''\nwhere member_id = #member_id# and state = ''PENDING''\nand notification_type_id = (select id from notification_type_master where code = ''LMPFU'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"eac4f01d-6a31-4f5a-98ce-bc378be878d4","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"cf0cc43e-8eaa-4293-a6da-f39cb8893c97","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":"generate_asha_lmpfu_notification","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#is_pregnant#'' !== ''null'' && #is_pregnant# == true","conditionParam":"is_pregnant","description":null,"notificaitonConfigsType":[{"id":"faa3aaa0-20ec-47ea-9277-8833c68760d2","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"60820764-542e-42be-825c-5696e221bbca","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_NO_RESPONSE''\nwhere member_id = #member_id# and state = ''PENDING''\nand notification_type_id = (select id from notification_type_master where code = ''FHW_PREG_CONF'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"1ff1dfc8-0bf6-43dc-b81a-3370d07748c4","type":"QUERY","template":"update techo_notification_master set state = ''DONE_BY_ASHA''\nwhere member_id = #member_id# and state = ''PENDING''\nand notification_type_id = (select id from notification_type_master where code = ''LMPFU'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"18ae7ac6-0f2d-440d-b18a-606d34e1c8af","type":"QUERY","template":"INSERT INTO techo_notification_master(\nnotification_type_id, notification_code, location_id,family_id, member_id, schedule_date, due_on, expiry_date, ref_code,\nstate, created_by, created_on, modified_by, modified_on)\nselect (select id from notification_type_master  where code  = ''FHW_PREG_CONF''), 0, #location_id#,#family_id#,#member_id#,current_date,\ncurrent_date + interval ''3 days'',null,#id#,''PENDING'',#created_by#,now(),#created_by#,now();","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,family_id,id,created_by,location_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"70c5aa5f-1a92-4a28-95fd-365231c42f49","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'', action_by = #created_by#, modified_on = now() where member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'') and notification_type_id = (select id from notification_type_master where code = ''ASHA_LMPFU'');","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":80,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'ASHA_LMPFU','f4bf56fc-3c2f-4a7f-8e6c-527894c87edf'),
	 (29,58981,'2018-09-08 19:33:48.535',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,11,NULL,NULL,'Migration In Response','[{"query":"select mig.member_id, mig.location_migrated_to, mig.location_migrated_from, mig.type, mig.state, \nmig.family_migrated_from, mig.family_migrated_to, mig.modified_by, (case when fam.area_id is not null then cast(fam.area_id as integer) else fam.location_id end) as area_id, \nfam.id as family_id, mem.state as member_state from migration_master mig inner join imt_family fam \non mig.family_migrated_from = fam.family_id inner join imt_member mem on mig.member_id = mem.id where mig.id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#state#'' == ''NOT_HAPPENED''","conditionParam":"state","description":null,"notificaitonConfigsType":[{"id":"506f7934-cb16-4be0-a3b0-477b9b111d0a","type":"QUERY","template":"update techo_notification_master set location_id = cast(#area_id# as integer), family_id = #family_id#, modified_on = now(), modified_by = #modified_by# \nwhere member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE''); \n\nupdate imt_member set family_id = ''#family_migrated_from#'', modified_on = now(), modified_by = #modified_by# \nwhere id = #member_id#;","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,family_id,modified_by,area_id,family_migrated_from","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null}]},{"isConditionReq":true,"condition":"''#state#'' == ''CONFIRMED''","conditionParam":"state","description":null,"notificaitonConfigsType":null}]}]','INACTIVE',NULL,'MIGRATION_IN_RESP','515dd6eb-0888-4fa1-a1c4-c4efb9ed0980'),
	 (43,409,'2018-12-31 05:47:51.535',1,'2021-01-13 20:22:06.427965',NULL,'Maternal Death Verification MO Two option accept / reject On reject member should start show. On accept or reject ttc notification should close.','FORM_SUBMITTED',NULL,30,NULL,NULL,'Maternal Death Verification MO','[{"query":"select techo_web_notification_master.id as resourse_id\n,rch_member_death_deatil.member_id\n,techo_web_notification_master.other_details \n,rch_member_death_deatil.id as death_detail_id\n,listvalue_field_value_detail.value as selected_action\n,listvalue_field_value_detail.id as selected_action_id\n,techo_web_notification_master.related_notification_id\n,techo_web_notification_master.modified_by as action_by\nfrom techo_web_notification_master,listvalue_field_value_detail,rch_member_death_deatil\nwhere cast(techo_web_notification_master.action_taken as integer) =  listvalue_field_value_detail.id\nand rch_member_death_deatil.id = techo_web_notification_master.ref_code\nand techo_web_notification_master.id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"\"#selected_action#\" == \"Reject\"","conditionParam":"selected_action","description":"","notificaitonConfigsType":[{"id":"860a59e3-a9b7-46ce-a341-3440607c63b1","type":"QUERY","template":null,"mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":43,"queryMasterId":null,"queryCode":"mark_as_false_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"action_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null}]},{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"0f8dd025-5813-487c-b51e-d85cf234a4c8","type":"QUERY","template":null,"mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":43,"queryMasterId":null,"queryCode":"mark_techo_web_notification_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"action_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"related_notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null},{"id":"ced7b562-dc27-4924-a04f-bf19bc986f4d","type":"QUERY","template":"UPDATE rch_member_death_deatil set death_reason = CASE WHEN ''#selected_action#'' = '''' THEN -1 else ''#selected_action_id#'' end, other_death_reason = CASE WHEN ''#selected_action#'' = '''' THEN ''#other_details#'' else null end, modified_by = ''#action_by#'', modified_on = now() where id=#death_detail_id#","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"other_details,selected_action,action_by,death_detail_id,selected_action_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":43,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null}]}]}]','ACTIVE',NULL,'maternal_death_verification_mo','ec75fb39-d00f-40f8-9b51-f5944b093fd7'),
	 (65,58981,'2019-05-20 10:54:28.051',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,51,NULL,NULL,'Asha Child Service Visit','[{"query":"select id, member_id, family_id, location_id, notification_id, created_by, service_date, is_alive, death_date, death_place, death_reason, other_death_reason, weight from rch_asha_child_service_master where id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#weight# != null","conditionParam":"weight","description":null,"notificaitonConfigsType":[{"id":"5085aa49-18d8-4e26-9d7b-6761ea390783","type":"QUERY","template":"update imt_member set weight = #weight# where id = #member_id#","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,weight","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":65,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]},{"isConditionReq":true,"condition":"#notification_id# != null","conditionParam":"notification_id","description":null,"notificaitonConfigsType":[{"id":"549d9920-9c68-4f53-9265-e1e5ed0833a1","type":"QUERY","template":null,"mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":65,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]},{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"23bddf56-331e-4132-9457-5135f8c8cb1b","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'', action_by = #created_by#, modified_on = now()\nwhere member_id = #member_id# and state = ''PENDING'' \nand notification_type_id = (select id from notification_type_master where code = ''ASHA_CS'')","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":65,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]}]}]','ACTIVE',NULL,'ASHA_CS','446ccaa4-d8ea-492f-ac4a-c9b977a090a0'),
	 (113,74840,'2020-03-16 10:47:48.721',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,92,NULL,NULL,'CFHC Suspected widget','[{"query":"select \ntecho_web_notification_master.id as web_notification_id,\ntecho_web_notification_master.modified_by as action_by,\nlistvalue_field_value_detail.value as selected_action,\ntecho_web_notification_master.ref_code\nfrom techo_web_notification_master\n,listvalue_field_value_detail\nwhere techo_web_notification_master.id  = #resourceId#\nand cast(techo_web_notification_master.action_taken as integer) =  listvalue_field_value_detail.id","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"\"#selected_action#\" == \"Suspected\"","conditionParam":"selected_action","description":null,"notificaitonConfigsType":[{"id":"34af8154-8f09-4501-84b1-c04f633550bf","type":"QUERY","template":"update techo_web_notification_master set state = ''PENDING'' where id = #web_notification_id#","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"web_notification_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":113,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]},{"isConditionReq":true,"condition":"\"#selected_action#\" == \"Confirmed\"","conditionParam":"selected_action","description":null,"notificaitonConfigsType":[{"id":"7d0a6241-61a8-4751-816d-8e3bb07d8b27","type":"QUERY","template":"INSERT INTO techo_web_notification_master(\n            notification_type_id, location_id, \n            member_id, escalation_level_id, schedule_date, \n            state, created_by, created_on, \n            modified_by, modified_on, ref_code, notification_type_escalation_id\n            )\nselect notification_type.notification_type_id,twn.location_id,twn.member_id,\nnotification_type.id,now(),''PENDING'',modified_by,now(),-1,now(),twn.ref_code,notification_type.notification_type_id||''_''||notification_type.id\nfrom techo_web_notification_master twn,\n(select id,notification_type_id from escalation_level_master where name = ''Default'' \nand notification_type_id = (select id from notification_type_master where code = ''cfhc_confirm_disease'')) as notification_type\nwhere twn.id =  #web_notification_id#;","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"web_notification_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":113,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]},{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"621d6b27-c3dd-4447-a7d1-d989380c56db","type":"QUERY","template":"update wt_cfhc_suspected_disease set status = ''#selected_action#'',modified_by = #action_by# where id = #ref_code#","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"selected_action,action_by,ref_code","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":113,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]}]}]','ACTIVE',NULL,'cfhc_suspected_disease','fd2dd718-5298-47ed-b28b-2ae63285c66e'),
	 (66,58981,'2019-05-20 10:59:06.934',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,50,NULL,NULL,'Asha PNC Visit','[{"query":"select rch_asha_pnc_master.id, rch_asha_pnc_master.member_id, rch_asha_pnc_master.family_id, \nrch_asha_pnc_master.location_id, \nrch_asha_pnc_master.notification_id, rch_asha_pnc_master.created_by, \nrch_asha_pnc_master.pregnancy_reg_det_id, rch_asha_pnc_master.service_date,\nrch_asha_pnc_mother_master.is_alive, rch_asha_pnc_mother_master.death_date,\nrch_asha_pnc_mother_master.death_place, rch_asha_pnc_mother_master.death_reason,\nrch_asha_pnc_mother_master.other_death_reason\nfrom rch_asha_pnc_master left join rch_asha_pnc_mother_master on rch_asha_pnc_master.id = rch_asha_pnc_mother_master.pnc_master_id\nwhere rch_asha_pnc_master.id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#notification_id# != null","conditionParam":"notification_id","description":null,"notificaitonConfigsType":[{"id":"142bf8d8-98f0-4dbf-aa47-3985cae55c67","type":"QUERY","template":null,"mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":66,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]},{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"19dda3d6-cb1b-471c-b48c-94ed285814aa","type":"QUERY","template":"update techo_notification_master set state = ''COMPLETED'', action_by = #created_by#, modified_on = now()\nwhere member_id = #member_id# and state in (''PENDING'',''RESCHEDULE'') \nand notification_type_id = (select id from notification_type_master where code = ''ASHA_PNC'')","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,created_by","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":66,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]}]},{"query":"select rch_asha_pnc_child_master.id, rch_asha_pnc_master.family_id, rch_asha_pnc_child_master.child_id as member_id, \nrch_asha_pnc_master.location_id, \nrch_asha_pnc_master.created_by, rch_asha_pnc_child_master.is_alive,\nto_char(rch_asha_pnc_child_master.death_date,''MM/DD/YYYY'') as death_date, \nrch_asha_pnc_child_master.death_reason, rch_asha_pnc_child_master.death_place, \nrch_asha_pnc_child_master.other_death_reason \nfrom rch_asha_pnc_master \ninner join rch_asha_pnc_child_master on rch_asha_pnc_master.id = rch_asha_pnc_child_master.pnc_master_id \nwhere rch_asha_pnc_master.id = #resourceId#;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"#weight# != null","conditionParam":"weight","description":null,"notificaitonConfigsType":[{"id":"0893ebae-2282-41f4-b315-2db92ba6ae6b","type":"QUERY","template":"update imt_member set weight = #weight# where id = #member_id#","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,weight","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":66,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]}]}]','ACTIVE',NULL,'ASHA_PNC','496a1c67-623f-4283-859b-8a5d9c07a5dc'),
	 (116,74841,'2020-03-17 15:55:19.202',1,'2021-01-13 20:22:06.427965',NULL,NULL,'FORM_SUBMITTED',NULL,94,NULL,NULL,'CFHC Death Verification MO','[{"query":"select techo_web_notification_master.id as resourse_id\n,rch_member_death_deatil.member_id\n,techo_web_notification_master.other_details \n,rch_member_death_deatil.id as death_detail_id\n,listvalue_field_value_detail.value as selected_action\n,listvalue_field_value_detail.id as selected_action_id\n,techo_web_notification_master.related_notification_id\n,techo_web_notification_master.modified_by as action_by\nfrom techo_web_notification_master,listvalue_field_value_detail,rch_member_death_deatil\nwhere cast(techo_web_notification_master.action_taken as integer) =  listvalue_field_value_detail.id\nand rch_member_death_deatil.id = techo_web_notification_master.ref_code\nand techo_web_notification_master.id = #resourceId#","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"\"#selected_action#\" == \"Mark As False Death\"","conditionParam":"selected_action","description":null,"notificaitonConfigsType":[{"id":"fc411fc5-28eb-43ec-8efd-d7aa2d0e849d","type":"QUERY","template":null,"mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":null,"queryMasterId":null,"queryCode":"mark_as_false_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"action_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]},{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"858af8d5-49c4-4344-8b78-7455c71a5f52","type":"QUERY","template":null,"mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":null,"queryMasterId":null,"queryCode":"mark_techo_web_notification_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"action_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"related_notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null},{"id":"abe7c1af-90fe-47d9-a2ca-2529fe5cc136","type":"QUERY","template":"update\n\trch_member_death_deatil\nset\n\tdeath_reason =\n\tcase\n\t\twhen ''#selected_action#'' = '''' then -1\n\t\telse ''#selected_action_id#''\n\tend,\n\tother_death_reason =\n\tcase\n\t\twhen ''#selected_action#'' = '''' then ''#other_details#''\n\t\telse null\n\tend,\n\tmodified_by = ''#action_by#'',\n\tmodified_on = now()\nwhere\n\tid =#death_detail_id#","mobileNotificationType":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"other_details,selected_action,action_by,death_detail_id,selected_action_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":null,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null}]}]}]','ACTIVE',NULL,'cfhc_death_verification_mo','1a39ecaf-894b-4cb2-a80f-eecb2e2e2f7a'),
	 (24,1027,'2018-07-30 19:49:16.783',1,'2023-07-06 20:08:41.184',NULL,NULL,'FORM_SUBMITTED',NULL,1,NULL,NULL,'LMP Followup','[{"query":"select rch_lmp_follow_up.id, rch_lmp_follow_up.member_id, member_status, year, imt_family.id as family_id, \nto_char(rch_lmp_follow_up.date_of_wedding, ''MM/DD/YYYY'') as date_of_wedding, \nto_char(rch_lmp_follow_up.service_date,''MM/DD/YYYY'') as service_date, \n(case when imt_family.area_id is null then imt_family.location_id else cast(imt_family.area_id as integer) end) as location_id, \nto_char(rch_lmp_follow_up.lmp, ''MM/DD/YYYY'') as lmp_date, \nto_char(rch_lmp_follow_up.lmp, ''MM/DD/YYYY'') as last_lmp_date, \nto_char(now(), ''MM/DD/YYYY'') as cur_date, \nto_char((rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)), ''MM/DD/YYYY'') as next_lmp_date, \nto_char((rch_lmp_follow_up.lmp + interval ''1'' day * 281), ''MM/DD/YYYY'') as edd, \nrch_lmp_follow_up.family_planning_method as family_planning_method, \n(case when rch_lmp_follow_up.family_planning_method is null then imt_member.last_method_of_contraception else rch_lmp_follow_up.family_planning_method end) as last_method_of_contraception, \nto_char(rch_lmp_follow_up.fp_insert_operate_date, ''MM/DD/YYYY'') as fp_insert_operate_date, \n(case when rch_lmp_follow_up.fp_insert_operate_date is null then imt_member.fp_insert_operate_date + interval ''90'' day > (rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)) else rch_lmp_follow_up.fp_insert_operate_date + interval ''90'' day > (rch_lmp_follow_up.lmp + interval ''1'' day * (case when normal_cycle_days is null then 28 else normal_cycle_days end)) end) as to_generate_lmp_visit, \nrch_lmp_follow_up.is_pregnant, \ntecho_notification_master.id as notification_id, \nrch_lmp_follow_up.created_by as created_by, \nto_char(death_date, ''MM/DD/YYYY'') as death_date, \ndeath_reason, place_of_death, cast(null as text) as other_death_reason, death_infra_id,\ntecho_notification_master.notification_code, \nto_char(case when imt_member.lmp is null then now() else imt_member.lmp end, ''MM/DD/YYYY'') as next_lmp_schedule_date, \nrch_lmp_follow_up.current_gravida, rch_lmp_follow_up.current_para\nfrom rch_lmp_follow_up inner join imt_member on rch_lmp_follow_up.member_id = imt_member.id \ninner join imt_family on imt_member.family_id = imt_family.family_id \nleft join techo_notification_master on techo_notification_master.member_id = rch_lmp_follow_up.member_id \nand techo_notification_master.notification_type_id = 1 \nand techo_notification_master.state in (''PENDING'',''RESCHEDULE'') \nwhere rch_lmp_follow_up.id = #resourceId# limit 1;","queryParam":"resourceId","conditions":[{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#lmp_date#'' == ''null'' && (''#is_pregnant#'' == ''null'' || #is_pregnant# == false) && ''#notification_code#'' == ''0''","conditionParam":"lmp_date,is_pregnant,member_status,notification_code","description":null,"notificaitonConfigsType":[{"id":"dc474c48-fe8d-466f-bfc9-05861100a7cb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":52,"queryCode":"mob_notification_reschedule","queryMasterParamJson":[{"parameterName":"expiary_days_add","mappingValue":null,"isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"due_days_add","mappingValue":null,"isFixed":false},{"parameterName":"schedule_days_add","mappingValue":"5","isFixed":true},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"54021c0f-093c-4eae-899a-adb2f9eff1c9","type":"QUERY","template":"update techo_notification_master set notification_code = case when notification_code = ''0'' then cast(cast(notification_code as integer) + 1 as character varying) else notification_code end where id = #notification_id#","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"notification_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''DEATH''","conditionParam":"member_status","description":null,"notificaitonConfigsType":[{"id":"91f1cd4e-b006-4ac3-bfe0-c30595675413","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"7ebffd7f-3205-423e-b3d0-51c87fb5f3d6","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":56,"queryCode":"mark_member_as_death","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"service_type","mappingValue":"FHW_LMP","isFixed":true},{"parameterName":"reference_id","mappingValue":"id","isFixed":false},{"parameterName":"death_reason","mappingValue":"death_reason","isFixed":false},{"parameterName":"other_death_reason","mappingValue":"other_death_reason","isFixed":false},{"parameterName":"place_of_death","mappingValue":"place_of_death","isFixed":false},{"parameterName":"location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"death_date","mappingValue":"death_date","isFixed":false},{"parameterName":"health_infra_id","mappingValue":"death_infra_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"#year# != null || ''#lmp_date#'' != ''null'' || ''#family_planning_method#'' != ''null'' || ''#fp_insert_operate_date#'' != ''null'' || ''#date_of_wedding#'' != ''null'' || #current_gravida# != null || #current_para# != null","conditionParam":"lmp_date,date_of_wedding,year,fp_insert_operate_date,family_planning_method,current_para,current_gravida","description":null,"notificaitonConfigsType":[{"id":"70fcf116-10f7-44be-b309-53bd71ef19a7","type":"QUERY","template":"update imt_member set year_of_wedding = (case when #year# is not null then #year# else year_of_wedding end), \ndate_of_wedding = (case when ''#date_of_wedding#'' != ''null'' then to_date((case when ''#date_of_wedding#'' = ''null'' then ''1970-01-01'' else ''#date_of_wedding#'' end), ''MM/DD/YYYY'') else date_of_wedding end),\nlmp = (case when ''#lmp_date#'' != ''null'' then to_date((case when ''#lmp_date#'' = ''null'' then ''1970-01-01'' else ''#lmp_date#'' end), ''MM/DD/YYYY'') else lmp end), \nlast_method_of_contraception = (case when ''#family_planning_method#'' != ''null'' then ''#family_planning_method#'' else last_method_of_contraception end),\nfp_insert_operate_date = (\n\tcase when ''#fp_insert_operate_date#'' != ''null'' \n\t\tthen to_date(case when ''#fp_insert_operate_date#'' = ''null'' then ''1970-01-01'' else ''#fp_insert_operate_date#'' end, ''MM/DD/YYYY'') \n\t\telse fp_insert_operate_date end),\ncurrent_gravida = case when #current_gravida# is not null then #current_gravida# else current_gravida end,\ncurrent_para = case when #current_para# is not null then #current_para# else current_para end,\nmodified_by = #created_by#, modified_on = now() \nwhere id = #member_id#;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"date_of_wedding,lmp_date,member_id,year,fp_insert_operate_date,family_planning_method,current_para,created_by,current_gravida","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#lmp_date#'' !== ''null''","conditionParam":"lmp_date","description":null,"notificaitonConfigsType":[{"id":"b059db39-4a17-41a4-a2dd-fc57582c717a","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#is_pregnant#'' !== ''null'' && #is_pregnant# == true","conditionParam":"is_pregnant","description":null,"notificaitonConfigsType":[{"id":"81880422-23d5-43a6-8bf9-42d968b64f43","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":53,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a","type":"MOBILE","template":null,"mobileNotificationType":2,"mobileNotificationTypeUUID":"d6eae54f-0650-4985-9628-c6a37a92c4d4","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":"","memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"5ee09d52-f3ec-4c75-8a02-d18a7e6ce066","notificationCode":"1","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":91,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"a90441c0-20cb-423e-9626-6e991a48375d","notificationCode":"2","numberOfDaysAddedForOnDate":92,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":189,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"06e835bb-f352-4f53-a5bf-76cb93685529","notificationCode":"3","numberOfDaysAddedForOnDate":190,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":245,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"},{"id":"28a9d911-4a3d-45d8-ae9d-02d241348302","notificationCode":"4","numberOfDaysAddedForOnDate":246,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"5d1131bc-f5bc-4a4a-8d7d-6dfd3f512f0a"}],"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"fb77b27a-fd04-434e-b856-2c563f63af27","type":"MOBILE","template":null,"mobileNotificationType":44,"mobileNotificationTypeUUID":"36c98c12-2dd1-4593-956b-4d8f9e02419d","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":null,"memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"a268b579-fa16-4c61-a401-c2c4deb516f0","notificationCode":"1","numberOfDaysAddedForOnDate":0,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":160,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"c387698c-e0a3-4216-ba24-8909505dca9a","notificationCode":"2","numberOfDaysAddedForOnDate":161,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":216,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"65d265be-9ae4-4c50-a6f8-e8f14daf8dc0","notificationCode":"3","numberOfDaysAddedForOnDate":217,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":244,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"},{"id":"53bcfb3d-5b31-401b-a7b8-e9e91d6d6441","notificationCode":"4","numberOfDaysAddedForOnDate":245,"numberOfDaysAddedForDueDate":28,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"fb77b27a-fd04-434e-b856-2c563f63af27"}],"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"faedb8e7-3e46-40a2-a9ac-ea7d5de944fa","type":"MOBILE","template":null,"mobileNotificationType":5,"mobileNotificationTypeUUID":"7d3d809f-e90f-40a2-95a8-f1e5fe3aeb0d","emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":"last_lmp_date","refCode":null,"memberFieldName":"member_id","userFieldName":null,"familyFieldName":"family_id","trigerWhen":null,"day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":[{"id":"1337a6d4-d98d-4000-83ca-b81a5151c869","notificationCode":"0","numberOfDaysAddedForOnDate":267,"numberOfDaysAddedForDueDate":7,"numberOfDaysAddedForExpiryDate":null,"notificationTypeConfigId":"faedb8e7-3e46-40a2-a9ac-ea7d5de944fa"}],"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"e57ce81b-d5a8-4d40-a8c1-fe265a8536e7","type":"QUERY","template":"with rows as ( INSERT INTO rch_pregnancy_registration_det( member_id, family_id, lmp_date, edd, reg_date, state,location_id,current_location_id, created_on, created_by, modified_on, modified_by) VALUES (#member_id#, #family_id#, ''#last_lmp_date#'', ''#edd#'', ''#service_date#'', ''PENDING'', #location_id#, #location_id# ,now(), #created_by#, now(), #created_by#) RETURNING id ) update imt_member set is_pregnant = true, edd = ''#edd#'', early_registration = (to_date(''#last_lmp_date#'', ''MM/DD/YYYY'') + INTERVAL ''84 days'') >= to_date(''#service_date#'', ''MM/DD/YYYY'') , cur_preg_reg_det_id = (select id from rows), cur_preg_reg_date=''#service_date#'', anc_visit_dates = null, immunisation_given = null, modified_by = ''#created_by#'', modified_on = now() where id= #member_id# ;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id,family_id,edd,service_date,last_lmp_date,created_by,location_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"112fbaf9-9f82-4b38-9a12-d3a06a31dd33","type":"QUERY","template":"update event_mobile_notification_pending set ref_code = (select cur_preg_reg_det_id from imt_member where id = ''#member_id#'') where member_id = ''#member_id#'' and state = ''PENDING'' and ref_code=-1;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"8c06b081-964e-4bba-ba2d-3e349a644652","type":"QUERY","template":"update techo_notification_master set state = ''MARK_AS_PREGNANT'' where member_id = #member_id# and state in (''PENDING'', ''RESCHEDULE'') and notification_type_id = (select id from notification_type_master where code = ''LMPFU'')","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"a7b9413a-f112-4180-bb13-ea60f1054b5e","type":"QUERY","template":"update techo_notification_master set ref_code = (select cur_preg_reg_det_id from imt_member where id = #member_id#)\nwhere member_id = #member_id# and state in (''PENDING'') and \nnotification_type_id in (select id from notification_type_master where code in (''FHW_ANC'',''FHW_WPD''));","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":"member_id","baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#lmp_date#'' !== ''null'' && #is_pregnant# == false && (''#last_method_of_contraception#'' == ''null'' || (''#last_method_of_contraception#'' != ''MLSTR'' && ''#last_method_of_contraception#'' != ''FMLSTR''))","conditionParam":"lmp_date,is_pregnant,last_method_of_contraception","description":null,"notificaitonConfigsType":[{"id":"578fc23c-b2fe-4172-b127-8bb1d9192cbb","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#last_method_of_contraception#'' != ''null'' && (''#last_method_of_contraception#'' == ''MLSTR'' || ''#last_method_of_contraception#'' == ''FMLSTR'') && ''#to_generate_lmp_visit#''","conditionParam":"to_generate_lmp_visit,last_method_of_contraception","description":null,"notificaitonConfigsType":[{"id":"aa4f85aa-3043-48c9-8d04-e4093abff918","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]},{"isConditionReq":true,"condition":"''#member_status#'' == ''AVAILABLE'' && ''#lmp_date#'' == ''null'' && (''#is_pregnant#'' == ''null'' || #is_pregnant# == false) && ''#notification_code#'' == ''1''","conditionParam":"lmp_date,is_pregnant,member_status,notification_code","description":null,"notificaitonConfigsType":[{"id":"68539887-b180-4461-b418-ddac0470d653","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":"mob_notification_mark_as_complete","queryMasterParamJson":[{"parameterName":"action_by","mappingValue":"created_by","isFixed":false},{"parameterName":"notification_id","mappingValue":"notification_id","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null},{"id":"0214a9cd-f111-452a-bc81-8408cc5f03b4","type":"QUERY","template":null,"mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":24,"queryMasterId":null,"queryCode":"generate_lmp_followup","queryMasterParamJson":[{"parameterName":"member_id","mappingValue":"member_id","isFixed":false},{"parameterName":"family_id","mappingValue":"family_id","isFixed":false},{"parameterName":"schedule_date","mappingValue":"next_lmp_schedule_date","isFixed":false},{"parameterName":"member_location_id","mappingValue":"location_id","isFixed":false},{"parameterName":"created_by","mappingValue":"created_by","isFixed":false}],"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"pushNotificationConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE',NULL,'FHW_LMPFU','fd52fb4e-aa72-41a9-ae33-f507b7022709'),
(39,1027,'2018-11-02 11:49:41.296',97065,'2021-07-27 10:46:54.686',NULL,'This will do an all count related to the maternal report.','TIMMER_BASED',NULL,NULL,2,0,'Update Data for Pregnancy Analytics','[{"query":"select 1;","queryParam":null,"conditions":[{"isConditionReq":false,"condition":null,"conditionParam":null,"description":null,"notificaitonConfigsType":[{"id":"8fb48344-84d1-4c23-ab76-54193ed3ae02","type":"QUERY","template":"begin;\n---1\ndrop table if exists t_pregnancy_registration_det;\ncreate table t_pregnancy_registration_det\n(\n\tpregnancy_reg_id bigint primary key,\n\tmember_id bigint,\n\tunique_health_id text,\n\tdob date,\n\tfamily_id text,\n\tmember_name text,\n\tmember_caste integer,\n\tis_bpl_family boolean,\n\tmobile_number text,\n\treg_service_date date,\n\treg_service_date_month_year date,\n\treg_service_financial_year text,\n\treg_server_date timestamp without time zone,\n\tpregnancy_reg_location_id bigint,\n\tnative_location_id integer,\n\t\n\ttracking_location_id integer,\n\tis_valid_for_tracking_report boolean,\n\t\n\tpregnancy_reg_family_id bigint,\n\tpreg_reg_state text,\n\tmember_basic_state text,\n\tmember_state text,\n\t\n\tlmp_date date,\n\tlmp_month_year date,\n\tlmp_financial_year text,\n\tedd date,\n\tdate_of_delivery date,\n\tdate_of_delivery_month_year date,\n\tdelivery_reg_date date,\n\tdelivery_reg_date_financial_year text,\n\tdelivery_location_id bigint,\n\tdelivery_family_id bigint,\n\tmember_current_location_id bigint,\n\tage_during_delivery smallint,\n\tregistered_with_no_of_child smallint,\n\tregistered_with_male_cnt smallint,\n\tregistered_with_female_cnt smallint,\n\tanc1 date,\n\tanc1_location_id integer,\n\tanc2 date,\n\tanc2_location_id integer,\n\tanc3 date,\n\tanc3_location_id integer,\n\tanc4 date,\n\tanc4_location_id integer,\n\tlast_systolic_bp integer,\n\tlast_diastolic_bp integer,\n\ttotal_regular_anc smallint,\n\ttt1_given date,\n\ttt1_location_id integer,\n\ttt2_given date,\n\ttt2_location_id integer,\n\ttt_boster date,\n\ttt_booster_location_id integer,\n\ttt2_tt_booster_given date,\n\ttt2_tt_booster_location_id integer,\n\tearly_anc boolean,\n\ttotal_anc smallint,\n\t\n\tcomplete_anc_date date,\n\tcomplete_anc_location integer,\n\t\n\t\n\tifa integer,\n\t\n\tifa_180_anc_date date,\n\tifa_180_anc_location integer,\n\t\n\tfa_tab_in_30_day integer,\n\tfa_tab_in_31_to_60_day integer,\n\tfa_tab_in_61_to_90_day integer,\n\tifa_tab_in_4_month_to_9_month integer,\n\thb real,\n\thb_date date,\n\thb_between_90_to_360_days real,\n\ttotal_ca integer,\n\tca_tab_in_91_to_180_day integer,\n\tca_tab_in_181_to_360_day integer,\n\texpected_delivery_place text,\n\t\n\tL2L_Preg_Complication text,\n\tOutcome_L2L_Preg text,\n\tL2L_Preg_Complication_Length smallint,\n\tOutcome_Last_Preg integer,\n\t\n\t\n\talben_given boolean,\n\tmaternal_detah boolean,\n\tmaternal_death_type text,\n\tdeath_date date,\n\tdeath_location_id integer,\n\t\n\tlow_height boolean,\n\turine_albumin boolean,\n\t\n\tsystolic_bp smallint,\n\tdiastolic_bp smallint,\n\tprev_pregnancy_date date,\n\tprev_preg_diff_in_month smallint,\n\tgravida smallint,\n\t\n\tjsy_beneficiary boolean,\n\tjsy_payment_date date,\n\tany_chronic_dis boolean,\n\taadhar_and_bank boolean,\n\taadhar_reg boolean,\n\taadhar_with_no_bank boolean,\n\tbank_with_no_aadhar boolean,\n\tno_aadhar_and_bank boolean,\n\thigh_risk_mother boolean,\n\t\n\tpre_preg_anemia boolean,\n\tpre_preg_caesarean_section boolean,\n\tpre_preg_aph boolean,\n\tpre_preg_pph boolean,\n\tpre_preg_pre_eclampsia boolean,\n\tpre_preg_abortion boolean,\n\tpre_preg_obstructed_labour boolean,\n\tpre_preg_placenta_previa boolean,\n\tpre_preg_malpresentation  boolean,\n\tpre_preg_birth_defect boolean,\n\tpre_preg_preterm_delivery boolean,\n\tany_prev_preg_complication boolean,\n\t\n\tchro_tb boolean,\n\tchro_diabetes boolean,\n\tchro_heart_kidney boolean,\n\tchro_hiv boolean,\n\tchro_sickle boolean,\n\tchro_thalessemia boolean,\n\t\n\tcur_extreme_age boolean,\n\tcur_low_weight boolean,\n\tcur_severe_anemia boolean,\n\tcur_blood_pressure_issue boolean,\n\tcur_urine_protein_issue boolean,\n\tcur_convulsion_issue boolean,\n\tcur_malaria_issue boolean,\n\tcur_social_vulnerability boolean,\n\tcur_gestational_diabetes_issue boolean,\n\tcur_twin_pregnancy boolean,\n\tcur_mal_presentation_issue boolean,\n\tcur_absent_reduce_fetal_movment boolean,\n\tcur_less_than_18_month_interval boolean,\n\tcur_aph_issue boolean,\n\tcur_pelvic_sepsis boolean,\n\tcur_hiv_issue boolean,\n\tcur_vdrl_issue boolean,\n\tcur_hbsag_issue boolean,\n\tcur_brethless_issue boolean,\n\tany_cur_preg_complication boolean,\n\t\n\thigh_risk_cnt smallint,\n\thbsag_test_cnt smallint,\n\thbsag_reactive_cnt smallint,\n\thbsag_non_reactive_cnt smallint,\n\t\n\tdelivery_outcome text,\n\ttype_of_delivery text,\n\thome_del boolean,\n\tinstitutional_del boolean,\n\tdelivery_108 boolean,\n    \n    delivery_out_of_state_govt boolean,\n    delivery_out_of_state_pvt boolean,\n\n    delivery_place text,\n\tbreast_feeding_in_one_hour boolean,\n\tdelivery_hospital text,\n\tis_chiranjivi_delivery boolean,\n\tdelivery_health_infrastructure integer, \n\tdel_week smallint,\n\tis_cortico_steroid boolean,\n\tmother_alive boolean,\n\ttotal_out_come smallint,\n\tmale smallint,\n\tfemale smallint,\n\t\n\tstill_birth smallint,\n\tlive_birth smallint,\n\t\n\t\n\tdelivery_done_by text,\n\tpnc1 date,\n\tpnc1_location_id integer,\n\tpnc2 date,\n\tpnc2_location_id integer,\n\tpnc3 date,\n\tpnc3_location_id integer,\n\tpnc4 date,\n\tpnc4_location_id integer,\n\t\n\tifa_tab_after_delivery smallint,\n\t\n\thaemoglobin_tested_count integer,\n\tiron_def_anemia_inj text,\n\tblood_transfusion boolean,\n\t\n\tppiucd_insert_date date,\n\tppiucd_insert_location integer,\n\n\thigh_risk_reasons text,\n\t\n\tis_fru boolean\n);\n\n\ndelete from rch_pregnancy_analytics_details where pregnancy_reg_id in (\nselect rpa.pregnancy_reg_id\nfrom rch_pregnancy_analytics_details rpa\nleft join imt_member m on rpa.member_id = m.id and m.basic_state in (''VERIFIED'',''REVERIFICATION'',''NEW'',''DEAD'',''TEMPORARY'',''MIGRATED'')\n--left join imt_family f on m.family_id = f.family_id and f.basic_state in (''VERIFIED'',''REVERIFICATION'',''NEW'',''TEMPORARY'',''MIGRATED'')\nwhere  m.id is null\n--or f.id is null\n) and (select cast(key_value as boolean) as value from system_configuration where system_key = ''rch_pregnancy_analytics_run_for_all_pregnancy'' ) = false;\n\ndelete from rch_pregnancy_analytics_details where pregnancy_reg_id in (\nselect rpa.pregnancy_reg_id\nfrom rch_pregnancy_analytics_details rpa\nleft join imt_family f on rpa.family_id = f.family_id and f.basic_state in (''VERIFIED'',''REVERIFICATION'',''NEW'',''TEMPORARY'',''MIGRATED'')\nwhere \nf.id is null\n) and (select cast(key_value as boolean) as value from system_configuration where system_key = ''rch_pregnancy_analytics_run_for_all_pregnancy'' ) = false;\n\ndelete from rch_pregnancy_analytics_details where pregnancy_reg_id in (\nselect rpa.pregnancy_reg_id\nfrom rch_pregnancy_analytics_details rpa\nleft join rch_pregnancy_registration_det rpr on rpr.id = rpa.pregnancy_reg_id and rpr.state in (''DELIVERY_DONE'',''PENDING'',''PREGNANT'')\nwhere rpr.id is null\n)and (select cast(key_value as boolean) as value from system_configuration where system_key = ''rch_pregnancy_analytics_run_for_all_pregnancy'' ) = false;\n\n\nwith parameter as (\nselect \n(select to_date(key_value,''MM-DD-YYYY'') as  from_date from system_configuration  where system_key = ''rch_pregnancy_analytics_last_schedule_date'') as from_date\n,(select cast(key_value as boolean) as value from system_configuration where system_key = ''rch_pregnancy_analytics_run_for_all_pregnancy'') as run_for_all_pregnancy\n), member_det as (\nselect imt_member.id as member_id \nfrom imt_member,rch_pregnancy_registration_det rpa,parameter,imt_family f\nwhere rpa.member_id = imt_member.id\nand f.family_id = imt_member.family_id\n--and  imt_member.modified_on >= (select to_date(key_value,''MM-DD-YYYY'') as  from_date from system_configuration  where system_key = ''rch_pregnancy_analytics_last_schedule_date'') \n--and  imt_member.modified_on >= current_date - interval ''2 day'' \nand f.modified_on >= current_date - interval ''2 day'' \nand parameter.run_for_all_pregnancy = false\nunion\nselect member_id from rch_pregnancy_registration_det,parameter \nwhere parameter.run_for_all_pregnancy = true \n--or modified_on >= (select to_date(key_value,''MM-DD-YYYY'') as  from_date from system_configuration  where system_key = ''rch_pregnancy_analytics_last_schedule_date'')\nor modified_on >= current_date - interval ''2 day'' \nunion\nselect member_id from rch_lmp_follow_up ,parameter\n--where modified_on >= (select to_date(key_value,''MM-DD-YYYY'') as  from_date from system_configuration  where system_key = ''rch_pregnancy_analytics_last_schedule_date'') \nwhere modified_on >= current_date - interval ''2 day'' \nand parameter.run_for_all_pregnancy = false\nunion\nselect member_id from rch_anc_master ,parameter\n--where modified_on >= (select to_date(key_value,''MM-DD-YYYY'') as  from_date from system_configuration  where system_key = ''rch_pregnancy_analytics_last_schedule_date'') \nwhere modified_on >= current_date - interval ''2 day''  \nand parameter.run_for_all_pregnancy = false\nunion\nselect member_id from rch_wpd_mother_master,parameter\n--where modified_on >= (select to_date(key_value,''MM-DD-YYYY'') as  from_date from system_configuration  where system_key = ''rch_pregnancy_analytics_last_schedule_date'') \nwhere modified_on >= current_date - interval ''2 day'' \nand parameter.run_for_all_pregnancy = false\nunion\nselect member_id from rch_pnc_master ,parameter\n--where modified_on >= (select to_date(key_value,''MM-DD-YYYY'') as  from_date from system_configuration  where system_key = ''rch_pregnancy_analytics_last_schedule_date'') \nwhere modified_on >= current_date - interval ''2 day'' \nand parameter.run_for_all_pregnancy = false\n)\ninsert into t_pregnancy_registration_det(\n\tpregnancy_reg_id,member_id,unique_health_id,dob,family_id,member_name,member_caste,is_bpl_family,mobile_number,reg_service_date,reg_service_date_month_year,reg_service_financial_year,\n\treg_server_date,pregnancy_reg_location_id,native_location_id,lmp_date,lmp_month_year,lmp_financial_year,edd,preg_reg_state,member_basic_state\n\t,early_anc,is_valid_for_tracking_report\n)\nselect rch_pregnancy_registration_det.id,\nrch_pregnancy_registration_det.member_id,\nimt_member.unique_health_id,\nimt_member.dob,\nimt_member.family_id,\nconcat(imt_member.first_name,'' '',imt_member.middle_name,'' '',imt_member.last_name),\ncast(imt_family.caste as integer) as member_caste,\nimt_family.bpl_flag as is_bpl_family,\nimt_member.mobile_number,\nreg_date,\ncast(date_trunc(''month'', reg_date) as date),\ncase when extract(month from reg_date) > 3 \n\tthen concat(extract(year from reg_date), ''-'', extract(year from reg_date) + 1)\n\telse concat(extract(year from reg_date) - 1, ''-'', extract(year from reg_date)) end,\nrch_pregnancy_registration_det.created_on,\nrch_pregnancy_registration_det.location_id,\nrch_pregnancy_registration_det.location_id,\nrch_pregnancy_registration_det.lmp_date,\ncast(date_trunc(''month'', rch_pregnancy_registration_det.lmp_date) as date),\ncase when extract(month from rch_pregnancy_registration_det.lmp_date) > 3 \n\tthen concat(extract(year from rch_pregnancy_registration_det.lmp_date), ''-'', extract(year from rch_pregnancy_registration_det.lmp_date) + 1)\n\telse concat(extract(year from rch_pregnancy_registration_det.lmp_date) - 1, ''-'', extract(year from rch_pregnancy_registration_det.lmp_date)) end,\nrch_pregnancy_registration_det.edd as edd,\nrch_pregnancy_registration_det.state as preg_reg_state,\nimt_member.basic_state as member_basic_state,\ncase when rch_pregnancy_registration_det.lmp_date + interval ''84 days'' >= rch_pregnancy_registration_det.reg_date then true else false end,\ncase when (imt_family.state in (''com.argusoft.imtecho.family.state.archived.temporary'',''com.argusoft.imtecho.family.state.archived.temporary.outofstate'', ''com.argusoft.imtecho.family.state.migrated.outofstate'') \n\tor imt_member.state in (''com.argusoft.imtecho.member.state.migrated.lfu'',''com.argusoft.imtecho.member.state.migrated.outofstate'',''com.argusoft.imtecho.member.state.archived.outofstate''))\n\tthen false else true end\n\nfrom member_det inner join\nrch_pregnancy_registration_det on member_det.member_id = rch_pregnancy_registration_det.member_id\ninner join imt_member on rch_pregnancy_registration_det.member_id = imt_member.id \nand imt_member.basic_state in (''VERIFIED'',''REVERIFICATION'',''NEW'',''DEAD'',''TEMPORARY'',''MIGRATED'')\ninner join imt_family on imt_member.family_id = imt_family.family_id\nand imt_family.basic_state in(''VERIFIED'',''REVERIFICATION'',''NEW'',''TEMPORARY'',''MIGRATED'')\nwhere \nrch_pregnancy_registration_det.state in (''DELIVERY_DONE'',''PENDING'',''PREGNANT'');\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED1''\nwhere event_config_id = 39 and status = ''PROCESSED'';\ncommit;\n---2\nbegin;\nwith rch_anc_det as(\nselect rch_anc_master.*,sum(ifa_tablets_given)OVER(PARTITION BY rch_anc_master.pregnancy_reg_det_id ORDER BY rch_anc_master.service_date) as total_ifa_tab\nfrom rch_anc_master,t_pregnancy_registration_det\nwhere rch_anc_master.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id\nand rch_anc_master.member_status = ''AVAILABLE''\n)\nupdate t_pregnancy_registration_det \nset anc1 = (case when t.anc1 is not null then t.anc1\n\t\t\t\twhen t.anc2 is not null then t.anc2\n\t\t\t\twhen t.anc3 is not null then t.anc3\n\t\t\t\twhen t.anc4 is not null then t.anc4\n\t\t\tend)\t\t\t\t\n, anc1_location_id = (case when t.anc1 is not null then t.anc1_location_id\n\t\t\t\twhen t.anc2 is not null then t.anc2_location_id\n\t\t\t\twhen t.anc3 is not null then t.anc3_location_id\n\t\t\t\twhen t.anc4 is not null then t.anc4_location_id\n\t\t\tend)\n, anc2 = (case \twhen t.anc2 is not null and t.anc1 is not null then t.anc2\n\t\t\t\twhen t.anc3 is not null and (t.anc1 is not null or t.anc2 is not null) then t.anc3\n\t\t\t\twhen t.anc4 is not null and (t.anc1 is not null or t.anc2 is not null or t.anc3 is not null) then t.anc4\n\t\t\tend)\n, anc2_location_id = (case \twhen t.anc2 is not null and t.anc1 is not null then t.anc2_location_id\n\t\t\t\twhen t.anc3 is not null and (t.anc1 is not null or t.anc2 is not null) then t.anc3_location_id\n\t\t\t\twhen t.anc4 is not null and (t.anc1 is not null or t.anc2 is not null or t.anc3 is not null) then t.anc4_location_id\n\t\t\tend)\n, anc3 = (case \twhen t.anc3 is not null and (t.anc1 is not null and t.anc2 is not null) then t.anc3\n\t\t\t\twhen t.anc4 is not null and ((case when t.anc1 is not null then 1 else 0 end)\n\t\t\t\t\t\t\t\t\t\t\t+(case when t.anc2 is not null then 1 else 0 end)\n\t\t\t\t\t\t\t\t\t\t\t+(case when t.anc3 is not null then 1 else 0 end)) = 2 then t.anc4\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tend)\n, anc3_location_id = (case \twhen t.anc3 is not null and (t.anc1 is not null and t.anc2 is not null) then t.anc3_location_id\n\t\t\t\twhen t.anc4 is not null and ((case when t.anc1 is not null then 1 else 0 end)\n\t\t\t\t\t\t\t\t\t\t\t+(case when t.anc2 is not null then 1 else 0 end)\n\t\t\t\t\t\t\t\t\t\t\t+(case when t.anc3 is not null then 1 else 0 end)) = 2 then t.anc4_location_id\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tend)\n, anc4 = (case when t.anc4 is not null and t.anc1 is not null and t.anc2 is not null and t.anc3 is not null then t.anc4 end)\n, anc4_location_id = (case when t.anc4 is not null and t.anc1 is not null and t.anc2 is not null and t.anc3 is not null then t.anc4_location_id end)\n--, early_anc = case when t.early_reg = 1 then true else false end\n, alben_given = case when t.alben_given = 1 then true else false end,\nifa = t.ifa_tablets_given\n,ifa_180_anc_date = t.ifa_180_anc_date\n,ifa_180_anc_location = t.ifa_180_anc_location\n, total_anc = t.total_anc\n, fa_tab_in_30_day = t.fa_tab_in_30_day\n, fa_tab_in_31_to_60_day = t.fa_tab_in_31_to_60_day\n, fa_tab_in_61_to_90_day = t.fa_tab_in_61_to_90_day\n, ifa_tab_in_4_month_to_9_month = t.ifa_tab_in_4_month_to_9_month\n, ca_tab_in_91_to_180_day = t.ca_tab_in_91_to_180_day\n, ca_tab_in_181_to_360_day = t.ca_tab_in_181_to_360_day\n, hb = t.hb\n, hb_date = t.hb_date\n, haemoglobin_tested_count = t.haemoglobin_tested_count\n, total_ca = t.total_ca\n, expected_delivery_place = t.expected_delivery_place\n, hb_between_90_to_360_days = t.hb_between_90_to_360_days\n,hbsag_test_cnt = t.hbsag_test_cnt\n,hbsag_reactive_cnt = t.hbsag_reactive_cnt\n,hbsag_non_reactive_cnt = case when t.hbsag_test_cnt = 1 and t.hbsag_reactive_cnt = 0 then 1 else 0 end \n,iron_def_anemia_inj = t.iron_def_anemia_inj\n,blood_transfusion = case when t.blood_transfusion = 1 then true else false end\n,last_systolic_bp = t.systolic_bp\n,last_diastolic_bp = t.diastolic_bp\nfrom(\n\tselect t1.pregnancy_reg_det_id,t1.anc1,t1.anc2,t1.anc3,t1.anc4,t1.alben_given\n\t,t1.ifa_tablets_given,ifa_180_anc.service_date as ifa_180_anc_date,ifa_180_anc.location_id as ifa_180_anc_location\n\t,t1.total_anc\n\t,anc_master1.location_id as anc1_location_id,anc_master2.location_id as anc2_location_id\n\t,anc_master3.location_id as anc3_location_id,anc_master4.location_id as anc4_location_id\n\t,anc_systolic_bp.systolic_bp,anc_diastolic_bp.diastolic_bp\n\t,t1.fa_tab_in_30_day,t1.fa_tab_in_31_to_60_day,t1.fa_tab_in_61_to_90_day\n\t,t1.ifa_tab_in_4_month_to_9_month,anc_hb.haemoglobin_count as hb,anc_hb.service_date as hb_date\n\t,t1.haemoglobin_tested_count,t1.hb_between_90_to_360_days,t1.total_ca,t1.ca_tab_in_91_to_180_day\n\t,t1.ca_tab_in_181_to_360_day,t1.expected_delivery_place\n\t,t1.hbsag_test_cnt,t1.hbsag_reactive_cnt\n\t,iron_def_anemia_inj_det.iron_def_anemia_inj,t1.blood_transfusion\n\tfrom (\n\tselect rch_anc_master.pregnancy_reg_det_id,\n\tmin(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 0 and 84 then rch_anc_master.service_date else null end) anc1,\n\tmin(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 0 and 84 then rch_anc_master.id else null end) anc1_id,\n\tmin(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 85 and 182 then rch_anc_master.service_date else null end) anc2,\n\tmin(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 85 and 182 then rch_anc_master.id else null end) anc2_id,\n\tmin(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 183 and 238 then rch_anc_master.service_date else null end) anc3,\n\tmin(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 183 and 238 then rch_anc_master.id else null end) anc3_id,\n\tmin(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date >= 239 then rch_anc_master.service_date else null end) anc4,\n\tmin(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date >= 239 then rch_anc_master.id else null end) anc4_id,\n\t--max(case when t_pregnancy_registration_det.lmp_date + interval ''84 days'' > t_pregnancy_registration_det.reg_service_date then 1 else 0 end) early_reg,\n\tmax(case when rch_anc_master.systolic_bp is not null then rch_anc_master.id else null end) as systolic_bp,\n\tmax(case when rch_anc_master.diastolic_bp is not null then rch_anc_master.id else null end) as diastolic_bp,\n\tmax(case when albendazole_given then 1 else 0 end) as alben_given,\n\tsum(ifa_tablets_given) as ifa_tablets_given,\n\tsum(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 0 and 30 then fa_tablets_given else 0 end) as fa_tab_in_30_day,\n\tsum(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 31 and 60 then fa_tablets_given else 0 end) as fa_tab_in_31_to_60_day,\n\tsum(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 61 and 90 then fa_tablets_given else 0 end) as fa_tab_in_61_to_90_day,\n\tsum(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 90 and 270 then ifa_tablets_given else 0 end) as ifa_tab_in_4_month_to_9_month,\n\tmax(case when haemoglobin_count is not null then rch_anc_master.id else null end ) as hb,\n\tsum(case when haemoglobin_count is not null then 1 else 0 end )  as haemoglobin_tested_count,\n\tmax(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 90 and 360 then haemoglobin_count else 0 end) as hb_between_90_to_360_days,\n\tsum(calcium_tablets_given) as total_ca,\n\tsum(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 91 and 180 then calcium_tablets_given else 0 end) as ca_tab_in_91_to_180_day,\n\tsum(case when cast(rch_anc_master.service_date as date) - t_pregnancy_registration_det.lmp_date between 181 and 360 then calcium_tablets_given else 0 end) as ca_tab_in_181_to_360_day,\n\tmax(rch_anc_master.expected_delivery_place) as expected_delivery_place,\n\tmax(case when rch_anc_master.hbsag_test is not null then 1 else 0 end) as hbsag_test_cnt,\n\tmax(case when rch_anc_master.hbsag_test = ''REACTIVE'' then 1 else 0 end) as hbsag_reactive_cnt,\n\tmax(case when rch_anc_master.iron_def_anemia_inj in (''FCM'',''IRON_SUCROSE'') then rch_anc_master.id else null end) as iron_def_anemia_inj_anc_id,\n\tmax(case when rch_anc_master.blood_transfusion = true then 1 else 0 end) as blood_transfusion,\n\tcount(*) total_anc,\n\tmin(case when rch_anc_master.total_ifa_tab >= 180 then rch_anc_master.id end) as ifa_180_anc_id\n\tfrom rch_anc_det as rch_anc_master,t_pregnancy_registration_det\n\twhere rch_anc_master.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id\n\tand rch_anc_master.member_status = ''AVAILABLE''\n\tgroup by rch_anc_master.pregnancy_reg_det_id) as t1\n\tleft join rch_anc_master anc_master1 on anc_master1.id = t1.anc1_id\n\tleft join rch_anc_master anc_master2 on anc_master2.id = t1.anc2_id\n\tleft join rch_anc_master anc_master3 on anc_master3.id = t1.anc3_id\n\tleft join rch_anc_master anc_master4 on anc_master4.id = t1.anc3_id\n\tleft join rch_anc_master anc_systolic_bp on anc_systolic_bp.id = t1.systolic_bp\n\tleft join rch_anc_master anc_diastolic_bp on anc_diastolic_bp.id = t1.diastolic_bp\n\tleft join rch_anc_master anc_hb on anc_hb.id = t1.hb\n\tleft join rch_anc_master iron_def_anemia_inj_det on iron_def_anemia_inj_det.id = t1.iron_def_anemia_inj_anc_id \n\tleft join rch_anc_master ifa_180_anc on ifa_180_anc.id = t1.ifa_180_anc_id\n\t\n) as t\nwhere t.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED2''\nwhere event_config_id = 39 and status = ''PROCESSED1'';\ncommit;\n---3\nbegin;\n/*\nupdate t_pregnancy_registration_det \nset hbsag_test_cnt = t.hbsag_test_cnt,\nhbsag_reactive_cnt = t.hbsag_reactive_cnt,\nhbsag_non_reactive_cnt = case when t.hbsag_test_cnt = 1 and t.hbsag_reactive_cnt = 0 then 1 else 0 end \nfrom (  \n\tselect rch_anc_master.pregnancy_reg_det_id,\n\tmax(case when rch_anc_master.hbsag_test is not null then 1 else 0 end) as hbsag_test_cnt,\n\tmax(case when rch_anc_master.hbsag_test = ''REACTIVE'' then 1 else 0 end) as hbsag_reactive_cnt\n\t--sum(case when rch_anc_master.hbsag_test = ''NON_REACTIVE'' then 1 else 0 end) as hbsag_non_reactive_cnt\n\tfrom rch_anc_master \n\tinner join t_pregnancy_registration_det \n\ton rch_anc_master.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id\n\twhere rch_anc_master.member_status = ''AVAILABLE''\n\tgroup by rch_anc_master.pregnancy_reg_det_id\n) as t\nwhere t.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id;\n*/\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED3''\nwhere event_config_id = 39 and status = ''PROCESSED2'';\n\ncommit;\n\n---4\nbegin;\nupdate t_pregnancy_registration_det \nset cur_severe_anemia = case when t.cur_severe_anemia = 1 then true else false end\n,cur_blood_pressure_issue = case when t.cur_blood_pressure_issue = 1 then true else false end \n,low_height = case when t.low_height = 1 then true else false end \n,cur_low_weight = case when t.cur_low_weight = 1 then true else false end\n,urine_albumin = case when t.urine_albumin = 1 then true else false end\n,high_risk_mother = case when t.high_risk_mother = 1 then true else false end\n,pre_preg_anemia = case when t.pre_preg_anemia = 1 then true else false end\n,pre_preg_caesarean_section = case when t.pre_preg_caesarean_section = 1 then true else false end\n,pre_preg_abortion = case when t.pre_preg_abortion = 1 then true else false end\n,pre_preg_aph = case when t.pre_preg_aph = 1 then true else false end\n,pre_preg_pph = case when t.pre_preg_pph = 1 then true else false end\n,pre_preg_pre_eclampsia = case when t.pre_preg_pre_eclampsia = 1 then true else false end\n,pre_preg_obstructed_labour = case when t.pre_preg_obstructed_labour = 1 then true else false end\n,pre_preg_placenta_previa = case when t.pre_preg_placenta_previa = 1 then true else false end\n,pre_preg_malpresentation = case when t.pre_preg_malpresentation = 1 then true else false end\n,pre_preg_birth_defect = case when t.pre_preg_birth_defect = 1 then true else false end\n,pre_preg_preterm_delivery = case when t.pre_preg_preterm_delivery = 1 then true else false end\n,cur_urine_protein_issue = case when t.cur_urine_protein_issue = 1 then true else false end\n,cur_convulsion_issue = case when t.cur_convulsion_issue = 1 then true else false end\n,cur_malaria_issue = case when t.cur_malaria_issue = 1 then true else false end\n,cur_gestational_diabetes_issue = case when t.cur_gestational_diabetes_issue = 1 then true else false end\n,cur_twin_pregnancy = case when t.cur_twin_pregnancy = 1 then true else false end\n,cur_mal_presentation_issue = case when t.cur_mal_presentation_issue = 1 then true else false end\n,cur_absent_reduce_fetal_movment = case when t.cur_absent_reduce_fetal_movment = 1 then true else false end\n,cur_aph_issue = case when t.cur_aph_issue = 1 then true else false end\n,cur_pelvic_sepsis = case when t.cur_pelvic_sepsis = 1 then true else false end\n,cur_hiv_issue = case when t.cur_hiv_issue = 1 then true else false end\n,cur_vdrl_issue = case when t.cur_vdrl_issue = 1 then true else false end\n,cur_hbsag_issue = case when t.cur_hbsag_issue = 1 then true else false end\n,cur_brethless_issue = case when t.cur_brethless_issue = 1 then true else false end\n,high_risk_cnt = t.pre_preg_anemia + t.pre_preg_caesarean_section \n\t+ (case when t.pre_preg_aph = 1 or t.pre_preg_pph = 1 then 1 else 0 end)\n\t+ t.pre_preg_pre_eclampsia + t.pre_preg_abortion + t.pre_preg_obstructed_labour \n\t+ t.pre_preg_placenta_previa + t.pre_preg_malpresentation + t.pre_preg_birth_defect\n\t+ t.pre_preg_preterm_delivery + t.cur_severe_anemia + t.cur_low_weight + t.low_height\n\t+ (case when t.cur_blood_pressure_issue = 1 or t.cur_urine_protein_issue = 1 or t.cur_convulsion_issue = 1 then 1 else 0 end)\n\t+ t.cur_malaria_issue + t.cur_gestational_diabetes_issue + t.cur_twin_pregnancy + t.cur_mal_presentation_issue\n\t+ t.cur_absent_reduce_fetal_movment + t.cur_aph_issue + t.cur_pelvic_sepsis + t.cur_brethless_issue\n\t+ (case when t.cur_hiv_issue = 1 or t.cur_vdrl_issue = 1 or t.cur_hbsag_issue = 1 then 1 else 0 end)\n,jsy_payment_date = t.jsy_payment_date\n,jsy_beneficiary = case when t.jsy_beneficiary = 1 then true else false end \nfrom (\n\tselect rch_anc_master.pregnancy_reg_det_id,\n\tmax(\n\tcase when \n\tdanger_sign.dangerous_sign_id = (\n\tselect id from listvalue_field_value_detail where value = ''Severe anemia''\n\t) or rch_anc_master.haemoglobin_count <= 7 \n\tthen 1 else 0 end\n\t) cur_severe_anemia,\n\tmax(case when rch_anc_master.member_height < 140 then 1 else 0 end) low_height,\n\tmax(case when rch_anc_master.systolic_bp >= 140 or rch_anc_master.diastolic_bp >= 90 then 1 else 0 end) as cur_blood_pressure_issue,\n\tmax(case when rch_anc_master.weight <= 40 then 1 else 0 end) cur_low_weight,\n\tmax(case when rch_anc_master.urine_albumin is not null and rch_anc_master.urine_albumin <> ''0'' then 1 else 0 end) urine_albumin,\n\tmax(\n\tcase when \n\t(urine_sugar is not null and urine_sugar != ''0'') \n\tor sugar_test_after_food_val >140 \n\tor danger_sign.dangerous_sign_id = 769/*Urine sugar*/ \n\tthen 1 else 0 end\n\t) cur_gestational_diabetes_issue,\n\tmax(\n\tcase when \n\trch_anc_master.foetal_movement in (''DECREASED'',''ABSENT'')\n\tor (rch_anc_master.foetal_position is not null and rch_anc_master.foetal_position not in(''VERTEX'',''CBMO''))\n\tor rch_anc_master.hiv_test = ''POSITIVE''\n\tor rch_anc_master.vdrl_test = ''POSITIVE''\n\tor rch_anc_master.hbsag_test = ''REACTIVE''\n\tor pre_compl.previous_pregnancy_complication in (\n\t''SEVANM''/*Anemia*/\n\t,''CAESARIAN''/*Caesarean Section*/\n\t,''APH'',''PPH''/*Ante partum Haemorrhage(APH)/Post partum Haemorrhage (PPH)*/\n\t,''CONVLS''/*Pre Eclampsia or Eclampsia*/\n\t,''P2ABO''/*Abortion*/\n\t,''OBSLBR''/*OBSLBR*/\n\t,''PLPRE''/*Placenta previa*/\n\t,''MLPRST''/*Malpresentation*/\n\t,''CONGDEF''/*Birth defect*/\n\t,''PRETRM''/*Preterm delivery*/\n\t) or danger_sign.dangerous_sign_id in (\n\t768/*urine protein*/\n\t,909/*convulsion*/\n\t,769/*Urine Sugar*/\n\t,912/*Twin*/\n\t,1024/*Malaria Fever*/\n\t,910/*APH*/\n\t,911/*Pelvic sepsis (vaginal discharge)(Foul smelling discharge)*/\n\t,915/*Breathlessness*/\n\t)\n\tthen 1 else 0 end\n\t) as high_risk_mother,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''SEVANM'' then 1 else 0 end) as pre_preg_anemia,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''CAESARIAN'' then 1 else 0 end) as pre_preg_caesarean_section,\n\t--max(case when pre_compl.previous_pregnancy_complication = ''APH'' or pre_compl.previous_pregnancy_complication = ''PPH''  then 1 else 0 end) as prev_aph_pph,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''P2ABO''   then 1 else 0 end) as pre_preg_abortion,\n\t\n\tmax(case when pre_compl.previous_pregnancy_complication = ''APH''   then 1 else 0 end) as pre_preg_aph,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''PPH''   then 1 else 0 end) as pre_preg_pph,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''CONVLS''   then 1 else 0 end) as pre_preg_pre_eclampsia,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''OBSLBR''   then 1 else 0 end) as pre_preg_obstructed_labour,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''PLPRE''   then 1 else 0 end) as pre_preg_placenta_previa,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''MLPRST''   then 1 else 0 end) as pre_preg_malpresentation,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''CONGDEF''   then 1 else 0 end) as pre_preg_birth_defect,\n\tmax(case when pre_compl.previous_pregnancy_complication = ''PRETRM''   then 1 else 0 end) as pre_preg_preterm_delivery,\n\t\n\tmax(case when danger_sign.dangerous_sign_id  = 768   then 1 else 0 end) as cur_urine_protein_issue,\n\tmax(case when danger_sign.dangerous_sign_id  = 909   then 1 else 0 end) as cur_convulsion_issue,\n\tmax(case when danger_sign.dangerous_sign_id  = 1024   then 1 else 0 end) as cur_malaria_issue,\n\tmax(case when danger_sign.dangerous_sign_id  = 912   then 1 else 0 end) as cur_twin_pregnancy,\n\tmax(case when (rch_anc_master.foetal_position is not null and  rch_anc_master.foetal_position not in(''VERTEX'',''CBMO'')) then 1 else 0 end) as cur_mal_presentation_issue,\n\tmax(case when rch_anc_master.foetal_movement in (''DECREASED'',''ABSENT'')   then 1 else 0 end) as cur_absent_reduce_fetal_movment,\n\tmax(case when danger_sign.dangerous_sign_id  = 910   then 1 else 0 end) as cur_aph_issue,\n\tmax(case when danger_sign.dangerous_sign_id  = 911   then 1 else 0 end) as cur_pelvic_sepsis,\n\tmax(case when rch_anc_master.hiv_test = ''POSITIVE'' then 1 else 0 end) as cur_hiv_issue,\n\tmax(case when rch_anc_master.vdrl_test = ''POSITIVE'' then 1 else 0 end) as cur_vdrl_issue,\n\tmax(case when rch_anc_master.hbsag_test = ''REACTIVE'' then 1 else 0 end) as cur_hbsag_issue,\n\tmax(case when danger_sign.dangerous_sign_id  = 915   then 1 else 0 end) as cur_brethless_issue,\n\tmax(case when rch_anc_master.jsy_beneficiary = true then 1 else 0 end) as jsy_beneficiary,\n\tmax(case when rch_anc_master.jsy_payment_done = true then rch_anc_master.service_date else null end) as jsy_payment_date\n\t\n\t--count(DISTINCT danger_sign.dangerous_sign_id) as high_risk_cnt\n\t\n\tfrom rch_anc_master \n\tinner join t_pregnancy_registration_det \n\ton rch_anc_master.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id\n\tleft join rch_anc_dangerous_sign_rel as danger_sign on danger_sign.anc_id = rch_anc_master.id\n\tleft join rch_anc_previous_pregnancy_complication_rel as pre_compl on pre_compl.anc_id = rch_anc_master.id\n\twhere rch_anc_master.member_status = ''AVAILABLE''\n\tgroup by rch_anc_master.pregnancy_reg_det_id\n) as t\nwhere t.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED4''\nwhere event_config_id = 39 and status = ''PROCESSED3'';\ncommit;\n\n---  add high risk reason string\nbegin;\n\tupdate t_pregnancy_registration_det\n\tset \n\thigh_risk_reasons = t.high_risk_reasons\n\tfrom (\n\t\tselect \n\t\tpregnancy_reg_id\n\t\t,concat_ws ('','',\n\t\tcase when r.pre_preg_anemia = true then ''Anaemia'' else null end,\n\t\tcase when r.pre_preg_caesarean_section = true then ''Caesarean Section'' else null end,\n\t\tcase when r.pre_preg_aph = true then ''prev preg Ante partum Haemorrhage(APH)'' else null end,\n\t\tcase when r.pre_preg_pph = true then ''prev preg Post partum Haemorrhage (PPH)'' else null end,\n\t\tcase when r.pre_preg_pre_eclampsia = true then ''Pre Eclampsia/Eclampsia'' else null end,\n\t\tcase when r.pre_preg_abortion = true then ''Abortion'' else null end,\n\t\tcase when r.pre_preg_obstructed_labour = true then ''Obstructed labour'' else null end,\n\t\tcase when r.pre_preg_placenta_previa = true then ''Placenta previa'' else null end,\n\t\tcase when r.pre_preg_malpresentation = true then ''Malpresentation'' else null end,\n\t\tcase when r.pre_preg_birth_defect = true then ''Birth defect'' else null end,\n\t\tcase when r.pre_preg_preterm_delivery = true then ''Preterm delivery'' else null end,\t\t\n\t\tcase when r.chro_tb = true then ''Tuberculosis'' else null end,\n\t\tcase when r.chro_diabetes = true then ''Diabetes Mellitus'' else null end,\n\t\tcase when r.chro_heart_kidney = true then ''Heart/Kidney Diseases'' else null end,\n\t\tcase when r.chro_hiv = true then ''pre existing chronic HIV'' else null end,\n\t\tcase when r.chro_sickle = true then ''Sickle cell Anemia'' else null end,\n\t\tcase when r.chro_thalessemia = true then ''Thalessemia'' else null end,\n\t\tcase when r.cur_extreme_age = true then ''Extreme age(less than 18 and more than 35 years)'' else null end,\n\t\tcase when r.cur_low_weight = true then ''Weight (less than 45 kg)'' else null end,\t\t\n\t\tcase when r.cur_severe_anemia = true then ''present pregnency anemia'' else null end,\n\t\tcase when r.cur_blood_pressure_issue = true then ''Blood Pressure (More than 140/90)'' else null end,\n\t\tcase when r.cur_urine_protein_issue = true then ''oedema or urine protein or headache with blurred vision'' else null end,\n\t\tcase when r.cur_convulsion_issue = true then ''convulsion'' else null end,\n\t\tcase when r.cur_malaria_issue = true then ''Malaria'' else null end,\n\t\tcase when r.cur_social_vulnerability = true then ''Severe social vulnerability'' else null end,\n\t\tcase when r.cur_gestational_diabetes_issue = true then ''Gestational diabetes mellitus'' else null end,\n\t\tcase when r.cur_twin_pregnancy = true then ''Twin Pregnancy'' else null end,\n\t\tcase when r.cur_mal_presentation_issue = true then ''Mal presentation'' else null end,\n\t\tcase when r.cur_absent_reduce_fetal_movment = true then ''Absent or reduced fetal movement'' else null end,\n\t\tcase when r.cur_less_than_18_month_interval = true then ''Interval between two pregnancy (less than 18 Months)'' else null end,\n\t\tcase when r.cur_aph_issue = true then ''present pregnency Antepartum haemorrhage'' else null end,\n\t\tcase when r.cur_pelvic_sepsis = true then ''Pelvic sepsis (vaginal discharge)'' else null end,\n\t\tcase when r.cur_hiv_issue = true then ''present pregnency HIV'' else null end,\n\t\tcase when r.cur_vdrl_issue = true then ''present pregnency VDRL'' else null end,\n\t\tcase when r.cur_hbsag_issue = true then ''present pregnency HBsAg'' else null end,\n\t\tcase when r.cur_brethless_issue = true then ''Breathlessness'' else null end\t\t\n\t\t) as high_risk_reasons\n\t\tfrom \n\t\tt_pregnancy_registration_det r\n\t\twhere r.high_risk_mother = true\t\t\n\t ) as t\n\twhere t_pregnancy_registration_det.pregnancy_reg_id = t.pregnancy_reg_id;\t\n\ncommit;\n\n\n---\n\n\n\n---5\nbegin;\nupdate t_pregnancy_registration_det \nset tt1_given = t.tt1_given\n,tt2_given = t.tt2_given\n,tt_boster = t.tt_boster\n,tt2_tt_booster_given = case when t.tt_boster is not null then t.tt_boster else t.tt2_given end\n,tt1_location_id = t.tt1_location_id\n,tt2_location_id = t.tt2_location_id\n,tt_booster_location_id = t.tt_booster_location_id\n,tt2_tt_booster_location_id = case when t.tt_booster_location_id is not null then t.tt_booster_location_id else t.tt2_location_id end\nfrom (\n\tselect t1.pregnancy_reg_det_id,t1.tt1_given,t1.tt2_given,t1.tt_boster\n\t,tt1_immunization_det.location_id as tt1_location_id\n\t,tt2_immunization_det.location_id as tt2_location_id\n\t,tt_booster_immunization_det.location_id as tt_booster_location_id\n\tfrom (\n\tselect rch_immunisation_master.pregnancy_reg_det_id,\n\tmax(case when rch_immunisation_master.immunisation_given = ''TT1'' then given_on else null end) as tt1_given,\n\tmax(case when rch_immunisation_master.immunisation_given = ''TT1'' then rch_immunisation_master.id else null end) as tt1_id,\n\tmax(case when rch_immunisation_master.immunisation_given = ''TT2'' then given_on else null end) as tt2_given,\n\tmax(case when rch_immunisation_master.immunisation_given = ''TT2'' then rch_immunisation_master.id else null end) as tt2_id,\n\tmax(case when rch_immunisation_master.immunisation_given = ''TT_BOOSTER'' then given_on else null end) as tt_boster,\n\tmax(case when rch_immunisation_master.immunisation_given = ''TT_BOOSTER'' then rch_immunisation_master.id else null end) as tt_boster_id\n\tfrom rch_immunisation_master \n\tinner join t_pregnancy_registration_det \n\ton rch_immunisation_master.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id\n\tgroup by rch_immunisation_master.pregnancy_reg_det_id\n\t) as t1\n\tleft join rch_immunisation_master tt1_immunization_det on tt1_immunization_det.id = tt1_id\n\tleft join rch_immunisation_master tt2_immunization_det on tt2_immunization_det.id = tt2_id\n\tleft join rch_immunisation_master tt_booster_immunization_det on tt_booster_immunization_det.id = tt_boster_id\t\n) as t\nwhere t.pregnancy_reg_det_id = t_pregnancy_registration_det.pregnancy_reg_id;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED5''\nwhere event_config_id = 39 and status = ''PROCESSED4'';\ncommit;\n---6\nbegin;\nupdate t_pregnancy_registration_det \nset registered_with_no_of_child = t.registered_with_no_of_child\n,registered_with_male_cnt = t.registered_with_male_cnt\n,registered_with_female_cnt = t.registered_with_female_cnt\n,prev_preg_diff_in_month = EXTRACT(year FROM age(t_pregnancy_registration_det.lmp_date,t.last_delivery_date))*12 + EXTRACT(month FROM age(t_pregnancy_registration_det.lmp_date,t.last_delivery_date))\nfrom (  \n\tselect t_pregnancy_registration_det.pregnancy_reg_id,\n\tsum(case when imt_member.death_detail_id is null or rch_member_death_deatil.dod > t_pregnancy_registration_det.lmp_date then 1 else 0 end) as registered_with_no_of_child,\n\tsum(\n\tcase when (imt_member.death_detail_id is null or rch_member_death_deatil.dod > t_pregnancy_registration_det.lmp_date) \n\tand imt_member.gender = ''M'' then 1 else 0 end\n\t) as registered_with_male_cnt,\n\tsum(\n\tcase when (imt_member.death_detail_id is null or rch_member_death_deatil.dod > t_pregnancy_registration_det.lmp_date) \n\tand imt_member.gender = ''F'' then 1 else 0 end\n\t) as registered_with_female_cnt,\n\tmax(imt_member.dob) as last_delivery_date\n\tfrom imt_member \n\tinner join t_pregnancy_registration_det \n\ton imt_member.mother_id = t_pregnancy_registration_det.member_id\n\tand imt_member.dob < t_pregnancy_registration_det.lmp_date\n\tleft join rch_member_death_deatil on imt_member.death_detail_id = rch_member_death_deatil.id\n\tgroup by t_pregnancy_registration_det.pregnancy_reg_id\n) as t\nwhere t.pregnancy_reg_id = t_pregnancy_registration_det.pregnancy_reg_id;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED6''\nwhere event_config_id = 39 and status = ''PROCESSED5'';\ncommit;\n\n---7\n---------------------------------------------delivery related-------------------------------------------------------------------------------------------------------\nbegin;\nupdate t_pregnancy_registration_det \nset date_of_delivery_month_year = t.date_of_delivery_month_year\n,date_of_delivery = t.date_of_delivery\n,delivery_reg_date = t.delivery_reg_date\n,delivery_reg_date_financial_year = case when t.delivery_reg_date is not null and extract(month from t.delivery_reg_date) > 3 \n\tthen concat(extract(year from t.delivery_reg_date), ''-'', extract(year from t.delivery_reg_date) + 1)\n\twhen t.delivery_reg_date is not null then concat(extract(year from t.delivery_reg_date) - 1, ''-'', extract(year from t.delivery_reg_date)) end \n,delivery_location_id = t.delivery_location_id\n,delivery_family_id = t.delivery_family_id\n,delivery_hospital = t.delivery_hospital\n,delivery_health_infrastructure = t.delivery_health_infrastructure\n,is_chiranjivi_delivery = case when t.is_chiranjivi_delivery = 1 then true else false end\n,delivery_outcome = t.delivery_outcome\n,type_of_delivery = t.type_of_delivery\n,delivery_done_by = t.delivery_done_by\n,delivery_place = t.delivery_place\n,home_del = case when t.home_del = 1 then true else false end\n,institutional_del = case when t.institutional_del = 1 then true else false end\n,delivery_108 = case when t.delivery_108 = 1 then true else false end\n,delivery_out_of_state_govt = case when t.delivery_out_of_state_govt = 1 then true else false end\n,delivery_out_of_state_pvt = case when t.delivery_out_of_state_pvt = 1 then true else false end\n,breast_feeding_in_one_hour = case when t.breast_feeding_in_one_hour = 1 then true else false end\n,del_week = t.del_week\n,is_cortico_steroid = case when t.is_cortico_steroid = 1 then true else false end\n,mother_alive = case when t.mother_alive = 1 then true else false end\n,total_out_come = t.total_out_come\n,male = t.male\n,female = t.female\n,still_birth = t.still_birth\n,live_birth = t.live_birth\n,ppiucd_insert_date = t.ppiucd_insert_date\n,ppiucd_insert_location = t.ppiucd_insert_location\n,is_fru = (case when t.is_fru = 1 then true else false end)\nfrom(\n\tselect t_pregnancy_registration_det.pregnancy_reg_id,\n\tmax(cast(date_trunc(''month'', rwmm.date_of_delivery) as date)) as date_of_delivery_month_year,\n\tmax(rwmm.date_of_delivery) as date_of_delivery,\n\tmax(rwmm.date_of_delivery) as delivery_reg_date,\n\tmax(rwmm.location_id) as delivery_location_id,\n\tmax(rwmm.family_id) as delivery_family_id,\n\tmax(rwmm.type_of_hospital) as delivery_hospital,\n\tmax(rwmm.health_infrastructure_id) as delivery_health_infrastructure,\n\tmax(case when rwmm.type_of_hospital = ''892'' or (rwmm.eligible_for_chiranjeevi = true and rwmm.type_of_hospital in (1013, 1010, 1064) and hid.is_chiranjeevi_scheme) then 1 else 0 end) as is_chiranjivi_delivery,\n\t\n\tmax(rwmm.pregnancy_outcome) as delivery_outcome,\n\tmax(rwmm.type_of_delivery) as type_of_delivery,\n\tmax(rwmm.delivery_done_by) as delivery_done_by,\n\tmax(case when rwmm.delivery_place in (''HOME'',''ON_THE_WAY'') then 1 else 0 end) as home_del,\n\tmax(case when rwmm.delivery_place = ''HOSP'' then 1 else 0 end) as institutional_del,\n\tmax(case when rwmm.delivery_place = ''108_AMBULANCE'' then 1 else 0 end) as delivery_108,\n    max(case when rwmm.delivery_place = ''OUT_OF_STATE_GOVT'' then 1 else 0 end) as delivery_out_of_state_govt,\n    max(case when rwmm.delivery_place = ''OUT_OF_STATE_PVT'' then 1 else 0 end) as delivery_out_of_state_pvt,\n\tmax(rwmm.delivery_place) as delivery_place,\n\tmax(case when rwmm.breast_feeding_in_one_hour = true or rwmm.breast_feeding_in_one_hour then 1 else 0 end) as breast_feeding_in_one_hour,\n\tmax(TRUNC(DATE_PART(''day'', rwmm.date_of_delivery- cast(t_pregnancy_registration_det.lmp_date as timestamp))/7)) as del_week,\n\tmax(case when rwmm.cortico_steroid_given = true then 1 else 0 end) as is_cortico_steroid,\n\tmax(case when rwmm.mother_alive = false then 0 else 1 end) as mother_alive,\n\tsum(case when rwcm.pregnancy_outcome = ''LBIRTH'' then 1 else 0 end) as total_out_come,\n\tsum(case when rwcm.pregnancy_outcome = ''LBIRTH'' and rwcm.gender = ''M''  then 1 else 0 end) as male,\n\tsum(case when rwcm.pregnancy_outcome = ''LBIRTH'' and rwcm.gender = ''F''  then 1 else 0 end) as female,\n\tsum(case when rwcm.pregnancy_outcome = ''SBIRTH'' then 1 else 0 end) as still_birth,\n\tsum(case when rwcm.pregnancy_outcome = ''LBIRTH'' then 1 else 0 end) as live_birth,\n\tmax(case when rwmm.family_planning_method = ''PPIUCD'' then rwmm.date_of_delivery end) as ppiucd_insert_date,\n\tmax(case when rwmm.family_planning_method = ''PPIUCD'' then rwmm.location_id end) as ppiucd_insert_location,\n\tmax(case when hid.is_fru then 1 else 0 end) as is_fru\n\tfrom t_pregnancy_registration_det \n\tinner join rch_wpd_mother_master rwmm on t_pregnancy_registration_det.pregnancy_reg_id = rwmm.pregnancy_reg_det_id\n\tleft join rch_wpd_child_master rwcm on rwmm.id = rwcm.wpd_mother_id \n\tleft join health_infrastructure_details hid on hid.id = rwmm.health_infrastructure_id\n\twhere rwmm.member_status in (''AVAILABLE'',''DEATH'') and (rwmm.state is null or rwmm.state != ''MARK_AS_FALSE_DELIVERY'')\n\tgroup by t_pregnancy_registration_det.pregnancy_reg_id\n) as t\nwhere t.pregnancy_reg_id = t_pregnancy_registration_det.pregnancy_reg_id;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED7''\nwhere event_config_id = 39 and status = ''PROCESSED6'';\ncommit;\n\n---8\nbegin;\nupdate t_pregnancy_registration_det \nset prev_preg_diff_in_month = case when \n\tprev_preg_diff_in_month < (\n\tEXTRACT(year FROM age(t_pregnancy_registration_det.lmp_date,t.last_delivery_date))*12 \n\t+ EXTRACT(month FROM age(t_pregnancy_registration_det.lmp_date,t.last_delivery_date))\n\t) \n\tthen prev_preg_diff_in_month \n\telse (\n\tEXTRACT(year FROM age(t_pregnancy_registration_det.lmp_date,t.last_delivery_date))*12 \n\t+ EXTRACT(month FROM age(t_pregnancy_registration_det.lmp_date,t.last_delivery_date))\n\t) end\nfrom (  \n\tselect t_pregnancy_registration_det.pregnancy_reg_id,\n\tmax(rch_wpd_mother_master.date_of_delivery) as last_delivery_date\n\tfrom t_pregnancy_registration_det INNER join\n\trch_wpd_mother_master on t_pregnancy_registration_det.member_id = rch_wpd_mother_master.member_id\n\tand rch_wpd_mother_master.date_of_delivery < t_pregnancy_registration_det.lmp_date\n\tgroup by t_pregnancy_registration_det.pregnancy_reg_id\n) as t\nwhere t.pregnancy_reg_id = t_pregnancy_registration_det.pregnancy_reg_id;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED8''\nwhere event_config_id = 39 and status = ''PROCESSED7'';\ncommit;\n\n---9\nbegin;\nupdate t_pregnancy_registration_det \nset cur_extreme_age = case when t.cur_extreme_age = 1 then true else false end\n,aadhar_and_bank = case when t.aadhar_and_bank = 1 then true else false end\n,aadhar_reg = case when t.aadhar_reg = 1 then true else false end\n,aadhar_with_no_bank = case when t.aadhar_with_no_bank = 1 then true else false end\n,bank_with_no_aadhar = case when t.bank_with_no_aadhar = 1 then true else false end\n,no_aadhar_and_bank = case when t.no_aadhar_and_bank = 1 then true else false end\n,chro_tb = case when t.chro_tb = 1 then true else false end\n,chro_diabetes = case when t.chro_diabetes = 1 then true else false end\n,chro_heart_kidney = case when t.chro_heart_kidney = 1 then true else false end\n,chro_hiv = case when t.chro_hiv = 1 then true else false end\n,chro_sickle = case when t.chro_sickle = 1 then true else false end\n,chro_thalessemia = case when t.chro_thalessemia = 1 then true else false end\n,member_current_location_id = t.member_current_location_id\n,tracking_location_id = t.member_current_location_id\n,age_during_delivery = t.age_during_delivery\n,any_chronic_dis = case when t.any_chronic_dis = 1 then true else false end\n,cur_social_vulnerability = case when t.cur_social_vulnerability = 1 then true else false end\n,maternal_detah = case when t.maternal_detah = 1 then true else false end\n,maternal_death_type = t.maternal_death_type\n,death_date = t.death_date\n,death_location_id = t.death_location_id\nfrom (\n\tselect t_pregnancy_registration_det.pregnancy_reg_id,\n\tmax (case when extract(years from age(t_pregnancy_registration_det.lmp_date,mem.dob)) < 18 or extract(years from age(t_pregnancy_registration_det.lmp_date,mem.dob)) > 35 then 1 else 0 end) cur_extreme_age,\n\tmax(extract(years from age(t_pregnancy_registration_det.lmp_date,mem.dob))) as age_during_delivery,\n\tmax(case when mem.jsy_beneficiary = true then 1 else 0 end) jsy_beneficiary,\n\tmax(case when mem.aadhar_number_encrypted is not null and mem.account_number is not null then 1 else 0 end) aadhar_and_bank,\n\tmax(case when mem.aadhar_number_encrypted is not null then 1 else 0 end) aadhar_reg,\n\tmax(case when mem.aadhar_number_encrypted is not null and mem.account_number is null then 1 else 0 end) as aadhar_with_no_bank,\n\tmax(case when mem.aadhar_number_encrypted is null and mem.account_number is not null then 1 else 0 end) as  bank_with_no_aadhar,\n\tmax(case when mem.aadhar_number_encrypted is null and mem.account_number is null then 1 else 0 end) as no_aadhar_and_bank,\n\tmax(case when chronic.chronic_disease_id = ''715'' then 1 else 0 end) as chro_tb,\n\tmax(case when chronic.chronic_disease_id = ''726'' then 1 else 0 end) as chro_diabetes,\n\tmax(case when chronic.chronic_disease_id = ''713'' then 1 else 0 end) as chro_heart_kidney,\n\tmax(case when chronic.chronic_disease_id = ''735'' then 1 else 0 end) as chro_hiv,\n\tmax(case when chronic.chronic_disease_id = ''729'' then 1 else 0 end) as chro_sickle,\n\tmax(case when chronic.chronic_disease_id = ''730'' then 1 else 0 end) as chro_thalessemia,\n\tmax(case when fam.area_id is null then fam.location_id else cast(fam.area_id as bigint) end) as member_current_location_id,\n\tmax(case when chronic.chronic_disease_id is not null then 1 else 0 end) as any_chronic_dis,\n\tmax(case when fam.vulnerable_flag = true then 1 else 0 end) as cur_social_vulnerability,\n\tmax(\n\tcase when \n\tmem.basic_state = ''DEAD''\n\tand (\n\tt_pregnancy_registration_det.date_of_delivery is null \n\tor (\n\trch_member_death_deatil.id is not null \n\tand (cast(rch_member_death_deatil.dod as date) - cast(t_pregnancy_registration_det.date_of_delivery as date) between  0 and 42)\n\t)\n\t) then 1 else 0 end\n\t) as maternal_detah,\n\tmax(\n\t\tcase when \n\t\t\tmem.basic_state = ''DEAD''\n\t\t\tand \n\t\t\tt_pregnancy_registration_det.date_of_delivery is null \n\t\t\tthen ''PRE-PARTUM''\n\t\twhen \n\t\t\tmem.basic_state = ''DEAD''\n\t\t\tand (\n\t\t\trch_member_death_deatil.id is not null \n\t\t\tand (cast(rch_member_death_deatil.dod as date) - cast(t_pregnancy_registration_det.date_of_delivery as date) =  0 )\n\t\t\t) then ''INTRA-PARTUM'' \n\t\twhen\n\t\t\tmem.basic_state = ''DEAD''\n\t\t\tand (\n\t\t\trch_member_death_deatil.id is not null \n\t\t\tand (cast(rch_member_death_deatil.dod as date) - cast(t_pregnancy_registration_det.date_of_delivery as date) between  0 and 42)\n\t\t\t) then ''POST-PARTUM'' \n\t\telse \n\t\t\tnull end\n\t) as maternal_death_type,\n\tmax(rch_member_death_deatil.dod) as death_date,\n\tmax(rch_member_death_deatil.location_id) as death_location_id\n\tfrom t_pregnancy_registration_det \n\tinner join imt_member mem on t_pregnancy_registration_det.member_id = mem.id\n\tinner join imt_family fam on mem.family_id= fam.family_id\n\tleft join  imt_member_chronic_disease_rel chronic on mem.id = chronic.member_id \n\tleft join rch_member_death_deatil on rch_member_death_deatil.id = mem.death_detail_id\n\tgroup by t_pregnancy_registration_det.pregnancy_reg_id\n) as t\nwhere t.pregnancy_reg_id = t_pregnancy_registration_det.pregnancy_reg_id;\n\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED9''\nwhere event_config_id = 39 and status = ''PROCESSED8'';\ncommit;\n\n\n---10\nbegin;\nupdate t_pregnancy_registration_det \nset \npnc1 = (case when t.pnc1 is not null then t.pnc1\n\t\t\t\twhen t.pnc2 is not null then t.pnc2\n\t\t\t\twhen t.pnc3 is not null then t.pnc3\n\t\t\t\twhen t.pnc4 is not null then t.pnc4\n\t\t\tend)\t\t\t\t\n, pnc1_location_id = (case when t.pnc1 is not null then t.pnc1_location_id\n\t\t\t\twhen t.pnc2 is not null then t.pnc2_location_id\n\t\t\t\twhen t.pnc3 is not null then t.pnc3_location_id\n\t\t\t\twhen t.pnc4 is not null then t.pnc4_location_id\n\t\t\tend)\n, pnc2 = (case \twhen t.pnc2 is not null and t.pnc1 is not null then t.pnc2\n\t\t\t\twhen t.pnc3 is not null and (t.pnc1 is not null or t.pnc2 is not null) then t.pnc3\n\t\t\t\twhen t.pnc4 is not null and (t.pnc1 is not null or t.pnc2 is not null or t.pnc3 is not null) then t.pnc4\n\t\t\tend)\n, pnc2_location_id = (case \twhen t.pnc2 is not null and t.pnc1 is not null then t.pnc2_location_id\n\t\t\t\twhen t.pnc3 is not null and (t.pnc1 is not null or t.pnc2 is not null) then t.pnc3_location_id\n\t\t\t\twhen t.pnc4 is not null and (t.pnc1 is not null or t.pnc2 is not null or t.pnc3 is not null) then t.pnc4_location_id\n\t\t\tend)\n, pnc3 = (case \twhen t.pnc3 is not null and (t.pnc1 is not null and t.pnc2 is not null) then t.pnc3\n\t\t\t\twhen t.pnc4 is not null and ((case when t.pnc1 is not null then 1 else 0 end)\n\t\t\t\t\t\t\t\t\t\t\t+(case when t.pnc2 is not null then 1 else 0 end)\n\t\t\t\t\t\t\t\t\t\t\t+(case when t.pnc3 is not null then 1 else 0 end)) = 2 then t.pnc4\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tend)\n, pnc3_location_id = (case \twhen t.pnc3 is not null and (t.pnc1 is not null and t.pnc2 is not null) then t.pnc3_location_id\n\t\t\t\twhen t.pnc4 is not null and ((case when t.pnc1 is not null then 1 else 0 end)\n\t\t\t\t\t\t\t\t\t\t\t+(case when t.pnc2 is not null then 1 else 0 end)\n\t\t\t\t\t\t\t\t\t\t\t+(case when t.pnc3 is not null then 1 else 0 end)) = 2 then t.pnc4_location_id\n\t\t\t\t\t\t\t\t\t\t\t\n\t\t\tend)\n, pnc4 = (case when t.pnc4 is not null and t.pnc1 is not null and t.pnc2 is not null and t.pnc3 is not null then t.pnc4 end)\n, pnc4_location_id = (case when t.pnc4 is not null and t.pnc1 is not null and t.pnc2 is not null and t.pnc3 is not null then t.pnc4_location_id end)\n, ifa_tab_after_delivery = t.ifa_tab_after_delivery\n, ppiucd_insert_date = case when t.ppiucd_insert_date is not null then t.ppiucd_insert_date else t_pregnancy_registration_det.ppiucd_insert_date end\n, ppiucd_insert_location = case when t.ppiucd_insert_date is not null then t.ppiucd_insert_location else t_pregnancy_registration_det.ppiucd_insert_location end\nfrom (\nselect t1.pregnancy_reg_id\n\t,case when t_pregnancy_registration_det.delivery_place in (''HOME'',''HOSP'',''108_AMBULANCE'') \n\t\tthen t_pregnancy_registration_det.date_of_delivery else t1.pnc1 end as pnc1\n\t,t1.pnc2,t1.pnc3,t1.pnc4\n\t,case when t_pregnancy_registration_det.delivery_place in (''HOME'',''HOSP'',''108_AMBULANCE'') \n\t\tthen t_pregnancy_registration_det.delivery_location_id else pnc1_master.location_id end as pnc1_location_id\n\t,pnc2_master.location_id as pnc2_location_id\n\t,pnc3_master.location_id as pnc3_location_id\n\t,pnc4_master.location_id as pnc4_location_id\n\t,t1.ifa_tab_after_delivery\n\t,t1.ppiucd_insert_date\n\t,t1.ppiucd_insert_location\n\tfrom (\n\tselect t_pregnancy_registration_det.pregnancy_reg_id,\n\tmin(case when cast(rpm.service_date as date) - t_pregnancy_registration_det.date_of_delivery between 0 and 2 then rpm.service_date else null end) as pnc1,\n\tmin(case when cast(rpm.service_date as date) - t_pregnancy_registration_det.date_of_delivery between 0 and 2 then rpm.id else null end) as pnc1_id,\n\t\n\tmin(case when cast(rpm.service_date as date) - t_pregnancy_registration_det.date_of_delivery between 3 and 6 then rpm.service_date else null end) as pnc2,\n\tmin(case when cast(rpm.service_date as date) - t_pregnancy_registration_det.date_of_delivery between 3 and 6 then rpm.id else null end) as pnc2_id,\n\t\n\tmin(case when cast(rpm.service_date as date) - t_pregnancy_registration_det.date_of_delivery between 7 and 13 then rpm.service_date else null end) as pnc3,\n\tmin(case when cast(rpm.service_date as date) - t_pregnancy_registration_det.date_of_delivery between 7 and 13 then rpm.id else null end) as pnc3_id,\n\t\n\tmin(case when cast(rpm.service_date as date) - t_pregnancy_registration_det.date_of_delivery  between 14 and 42 then rpm.service_date else null end) as pnc4,\n\tmin(case when cast(rpm.service_date as date) - t_pregnancy_registration_det.date_of_delivery  between 14 and 42 then rpm.id else null end) as pnc4_id,\n\t\n\t\n\tsum(rpmm.ifa_tablets_given) as ifa_tab_after_delivery,\n\t\n\tmax(case when family_planning_method = ''PPIUCD'' then cast(rpmm.fp_insert_operate_date as date) end) as ppiucd_insert_date,\n\tmax(case when family_planning_method = ''PPIUCD'' then rpm.location_id end) as ppiucd_insert_location\n\t\n\tfrom t_pregnancy_registration_det \n\tinner join rch_pnc_master rpm on t_pregnancy_registration_det.pregnancy_reg_id = rpm.pregnancy_reg_det_id\n\tleft join rch_pnc_mother_master rpmm on rpmm.pnc_master_id = rpm.id\n\twhere rpm.member_status = ''AVAILABLE''\n\tgroup by t_pregnancy_registration_det.pregnancy_reg_id) as t1\n\tinner join t_pregnancy_registration_det on t_pregnancy_registration_det.pregnancy_reg_id = t1.pregnancy_reg_id\n\tleft join rch_pnc_master pnc1_master on pnc1_master.id = pnc1_id\n\tleft join rch_pnc_master pnc2_master on pnc2_master.id = pnc2_id\n\tleft join rch_pnc_master pnc3_master on pnc3_master.id = pnc3_id\n\tleft join rch_pnc_master pnc4_master on pnc4_master.id = pnc4_id\n) as t\nwhere t.pregnancy_reg_id = t_pregnancy_registration_det.pregnancy_reg_id;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED10''\nwhere event_config_id = 39 and status = ''PROCESSED9'';\ncommit;\n\n---11\n---------------------Updating Data to Main Table-------------------------------------------------------------------------------------------------------------\nbegin;\n/*DROP TABLE IF EXISTS rch_pregnancy_analytics_details_t;\nCREATE TABLE rch_pregnancy_analytics_details_t (\n  pregnancy_reg_id bigint NOT NULL,\n  member_id bigint,\n  dob date,\n  family_id text,\n  member_name text,\n  mobile_number text,\n  reg_service_date date,\n  reg_service_date_month_year date,\n  reg_service_financial_year text,\n  reg_server_date timestamp without time zone,\n  pregnancy_reg_location_id bigint,\n  native_location_id integer,\n  pregnancy_reg_family_id bigint,\n  lmp_date date,\n  edd date,\n  preg_reg_state text,\n  member_basic_state text,\n  lmp_month_year date,\n  lmp_financial_year text,\n  date_of_delivery date,\n  date_of_delivery_month_year date,\n  delivery_location_id bigint,\n  delivery_family_id bigint,\n  delivery_reg_date date,\n  delivery_reg_date_financial_year text,\n  member_current_location_id bigint,\n  age_during_delivery smallint,\n  registered_with_no_of_child smallint,\n  registered_with_male_cnt smallint,\n  registered_with_female_cnt smallint,\n  anc1 date,\n  anc1_location_id integer,\n  anc2 date,\n  anc2_location_id integer,\n  anc3 date,\n  anc3_location_id integer,\n  anc4 date,\n  anc4_location_id integer,\n  total_regular_anc smallint,\n  tt1_given date,\n  tt1_location_id integer,\n  tt2_given date,\n  tt2_location_id integer,\n  tt_boster date,\n  tt_booster_location_id integer,\n  tt2_tt_booster_given date,\n  tt2_tt_booster_location_id integer,\n  early_anc boolean,\n  total_anc smallint,\n  ifa integer,\n  fa_tab_in_30_day integer,\n  fa_tab_in_31_to_60_day integer,\n  fa_tab_in_61_to_90_day integer,\n  ifa_tab_in_4_month_to_9_month integer,\n  hb_between_90_to_360_days integer,\n  hb real,\n  total_ca integer,\n  ca_tab_in_91_to_180_day integer,\n  ca_tab_in_181_to_360_day integer,\n  expected_delivery_place text,\n\t\n  L2L_Preg_Complication text,\n  Outcome_L2L_Preg text,\n  L2L_Preg_Complication_Length smallint,\n  Outcome_Last_Preg integer,\n  \n  alben_given boolean,\n  maternal_detah boolean,\n  maternal_death_type text,\n  death_date date,\n  death_location_id integer,\n  low_height boolean,\n  urine_albumin boolean,\n  systolic_bp smallint,\n  diastolic_bp smallint,\n  prev_pregnancy_date date,\n  prev_preg_diff_in_month smallint,\n  gravida smallint,\n  jsy_beneficiary boolean,\n  jsy_payment_date date,\n  any_chronic_dis boolean,\n  aadhar_and_bank boolean,\n  aadhar_reg boolean,\n  aadhar_with_no_bank boolean,\n  bank_with_no_aadhar boolean,\n  no_aadhar_and_bank boolean,\n  high_risk_mother boolean,\n  pre_preg_anemia boolean,\n  pre_preg_caesarean_section boolean,\n  pre_preg_aph boolean,\n  pre_preg_pph boolean,\n  pre_preg_pre_eclampsia boolean,\n  pre_preg_abortion boolean,\n  pre_preg_obstructed_labour boolean,\n  pre_preg_placenta_previa boolean,\n  pre_preg_malpresentation boolean,\n  pre_preg_birth_defect boolean,\n  pre_preg_preterm_delivery boolean,\n  any_prev_preg_complication boolean,\n  chro_tb boolean,\n  chro_diabetes boolean,\n  chro_heart_kidney boolean,\n  chro_hiv boolean,\n  chro_sickle boolean,\n  chro_thalessemia boolean,\n  cur_extreme_age boolean,\n  cur_low_weight boolean,\n  cur_severe_anemia boolean,\n  cur_blood_pressure_issue boolean,\n  cur_urine_protein_issue boolean,\n  cur_convulsion_issue boolean,\n  cur_malaria_issue boolean,\n  cur_social_vulnerability boolean,\n  cur_gestational_diabetes_issue boolean,\n  cur_twin_pregnancy boolean,\n  cur_mal_presentation_issue boolean,\n  cur_absent_reduce_fetal_movment boolean,\n  cur_less_than_18_month_interval boolean,\n  cur_aph_issue boolean,\n  cur_pelvic_sepsis boolean,\n  cur_hiv_issue boolean,\n  cur_vdrl_issue boolean,\n  cur_hbsag_issue boolean,\n  cur_brethless_issue boolean,\n  any_cur_preg_complication boolean,\n  high_risk_cnt smallint,\n  hbsag_test_cnt smallint,\n  hbsag_reactive_cnt smallint,\n  hbsag_non_reactive_cnt smallint,\n  delivery_outcome text,\n  type_of_delivery text,\n  delivery_place text,\n  home_del boolean,\n  institutional_del boolean,\n  delivery_108 boolean,\n  breast_feeding_in_one_hour boolean,\n  delivery_hospital text,\n  del_week smallint,\n  is_cortico_steroid boolean,\n  mother_alive boolean,\n  total_out_come smallint,\n  male smallint,\n  female smallint,\n  delivery_done_by text,\n  pnc1 date,\n  pnc1_location_id integer,\n  pnc2 date,\n  pnc2_location_id integer,\n  pnc3 date,\n  pnc3_location_id integer,\n  pnc4 date,\n  pnc4_location_id integer,\n  haemoglobin_tested_count integer,\n  iron_def_anemia_inj text,\n  blood_transfusion boolean,\n  ppiucd_insert_date date,\n  PRIMARY KEY (pregnancy_reg_id)\n);\n*/\n\ndelete from rch_pregnancy_analytics_details where (select cast(key_value as boolean) as value \nfrom system_configuration where system_key = ''rch_pregnancy_analytics_run_for_all_pregnancy'') = true;\n\ninsert into rch_pregnancy_analytics_details(\n\tpregnancy_reg_id\n)\nselect t_pregnancy_registration_det.pregnancy_reg_id\nfrom t_pregnancy_registration_det\nleft join rch_pregnancy_analytics_details on t_pregnancy_registration_det.pregnancy_reg_id = rch_pregnancy_analytics_details.pregnancy_reg_id\nwhere rch_pregnancy_analytics_details.pregnancy_reg_id is null;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED11''\nwhere event_config_id = 39 and status = ''PROCESSED10'';\ncommit;\n\n\n\n---12\nbegin;\nupdate rch_pregnancy_analytics_details \nset \n\tmember_id = t.member_id,\n\tdob = t.dob,\n\tfamily_id = t.family_id,\n\tunique_health_id = t.unique_health_id,\n\tmember_name = t.member_name,\n\tmember_caste = t.member_caste,\n\tis_bpl_family = t.is_bpl_family,\n\tmobile_number = t.mobile_number,\n\tmember_basic_state = t.member_basic_state,\n\tpreg_reg_state = t.preg_reg_state,\n\treg_service_date =t.reg_service_date,\n\treg_service_date_month_year =t.reg_service_date_month_year,\n\treg_service_financial_year = t.reg_service_financial_year,\n\treg_server_date =t.reg_server_date,\n\tpregnancy_reg_location_id = t.pregnancy_reg_location_id,\n\tnative_location_id = t.native_location_id,\n\tpregnancy_reg_family_id = t.pregnancy_reg_family_id,\n\tlmp_date = t.lmp_date,\n\tedd=t.edd,\n\tlmp_month_year = t.lmp_month_year,\n\tlmp_financial_year = t.lmp_financial_year,\n\tdate_of_delivery = t.date_of_delivery,\n\tdate_of_delivery_month_year = t.date_of_delivery_month_year,\n\tdelivery_location_id =t.delivery_location_id,\n\tdelivery_family_id =t.delivery_family_id,\n\tdelivery_reg_date = t.delivery_reg_date,\n\tdelivery_reg_date_financial_year = t.delivery_reg_date_financial_year,\n\t\n\tmember_current_location_id = t.member_current_location_id,\n\tage_during_delivery = t.age_during_delivery,\n\tregistered_with_no_of_child = t.registered_with_no_of_child,\n\tregistered_with_male_cnt = t.registered_with_male_cnt,\n\tregistered_with_female_cnt = t.registered_with_female_cnt,\n\tanc1 =t.anc1,\n\tanc1_location_id = t.anc1_location_id,\n\tanc2 =t.anc2,\n\tanc2_location_id = t.anc2_location_id,\n\tanc3 =t.anc3,\n\tanc3_location_id = t.anc3_location_id,\n\tanc4 =t.anc4,\n\tanc4_location_id = t.anc4_location_id,\n\tlast_systolic_bp = t.last_systolic_bp,\n\tlast_diastolic_bp = t.last_diastolic_bp,\n\ttt1_given =t.tt1_given,\n\ttt1_location_id = t.tt1_location_id,\n\ttt2_given =t.tt2_given,\n\ttt2_location_id = t.tt2_location_id,\n\ttt_boster =t.tt_boster,\n\ttt_booster_location_id = t.tt_booster_location_id,\n\ttt2_tt_booster_given = t.tt2_tt_booster_given,\n\ttt2_tt_booster_location_id = t.tt2_tt_booster_location_id,\n\tearly_anc =t.early_anc,\n\tifa =t.ifa,\n\tifa_180_anc_date = t.ifa_180_anc_date,\n\tifa_180_anc_location = t.ifa_180_anc_location,\n\tfa_tab_in_30_day = t.fa_tab_in_30_day,\n\tfa_tab_in_31_to_60_day = t.fa_tab_in_31_to_60_day,\n\tfa_tab_in_61_to_90_day = t.fa_tab_in_61_to_90_day,\n\tifa_tab_in_4_month_to_9_month = t.ifa_tab_in_4_month_to_9_month,\n\thb =t.hb,\n\thb_date = t.hb_date,\n\thb_between_90_to_360_days = t.hb_between_90_to_360_days,\n\ttotal_ca = t.total_ca,\n\tca_tab_in_91_to_180_day = t.ca_tab_in_91_to_180_day,\n\tca_tab_in_181_to_360_day = t.ca_tab_in_181_to_360_day,\n\texpected_delivery_place = t.expected_delivery_place,\n\t\n\tL2L_Preg_Complication = t.L2L_Preg_Complication,\n\tOutcome_L2L_Preg = t.Outcome_L2L_Preg,\n\tL2L_Preg_Complication_Length = t.L2L_Preg_Complication_Length,\n\t\n\talben_given =t.alben_given,\n\tcur_severe_anemia =t.cur_severe_anemia,\n\tcur_extreme_age =t.cur_extreme_age,\n\tlow_height =t.low_height,\n\tcur_urine_protein_issue = t.cur_urine_protein_issue,\n\tcur_convulsion_issue = t.cur_convulsion_issue,\n\tcur_malaria_issue = t.cur_malaria_issue,\n\tcur_social_vulnerability = t.cur_social_vulnerability,\n\tcur_gestational_diabetes_issue = t.cur_gestational_diabetes_issue,\n\tcur_twin_pregnancy = t.cur_twin_pregnancy,\n\tcur_mal_presentation_issue = t.cur_mal_presentation_issue,\n\tcur_absent_reduce_fetal_movment = t.cur_absent_reduce_fetal_movment,\n\tcur_less_than_18_month_interval = case when t.prev_preg_diff_in_month <= 18 then true else false end,\n\tcur_aph_issue = t.cur_aph_issue,\n\tcur_pelvic_sepsis = t.cur_pelvic_sepsis,\n\tcur_hiv_issue = t.cur_hiv_issue,\n\tcur_vdrl_issue = t.cur_vdrl_issue,\n\tcur_hbsag_issue = t.cur_hbsag_issue,\n\tcur_brethless_issue = t.cur_brethless_issue,\n\tcur_low_weight =t.cur_low_weight,\n\tmaternal_detah = t.maternal_detah,\n\tmaternal_death_type = t.maternal_death_type,\n\tdeath_date = t.death_date,\n\tdeath_location_id = t.death_location_id,\n\tany_cur_preg_complication = case when t.cur_extreme_age or t.cur_low_weight or t.cur_severe_anemia or t.low_height \n\tor t.cur_blood_pressure_issue or t.cur_urine_protein_issue or t.cur_malaria_issue\n\tor t.cur_social_vulnerability or t.cur_gestational_diabetes_issue or t.cur_twin_pregnancy\n\tor t.cur_mal_presentation_issue or t.cur_absent_reduce_fetal_movment or t.prev_preg_diff_in_month <= 18\n\tor t.cur_aph_issue or t.cur_pelvic_sepsis or t.cur_hiv_issue or t.cur_vdrl_issue or t.cur_hbsag_issue\n\tor t.cur_brethless_issue then true else false end,\n\turine_albumin =t.urine_albumin,\n\tcur_blood_pressure_issue =t.cur_blood_pressure_issue,\n\tsystolic_bp =t.systolic_bp,\n\tdiastolic_bp =t.diastolic_bp,\n\tany_prev_preg_complication = case when t.pre_preg_anemia or t.pre_preg_caesarean_section or t.pre_preg_aph \n\tor t.pre_preg_pph or t.pre_preg_pre_eclampsia or t.pre_preg_abortion or t.pre_preg_obstructed_labour\n\tor t.pre_preg_placenta_previa or t.pre_preg_malpresentation or t.pre_preg_birth_defect\n\tor t.pre_preg_preterm_delivery or t.total_out_come >= 3 then true else false end,\n\tprev_pregnancy_date =t.prev_pregnancy_date,\n\tprev_preg_diff_in_month =t.prev_preg_diff_in_month,\n\tgravida =t.registered_with_no_of_child,\n\tany_chronic_dis = case when t.chro_diabetes = true or t.chro_heart_kidney = true\n\tor t.chro_hiv = true or t.chro_thalessemia = true or t.chro_sickle = true \n\tor t.chro_tb = true \n\tthen true else false end,\n\ttotal_anc =t.total_anc,\n\tcomplete_anc_date = case when t.anc4 is not null and t.ifa_180_anc_date is not null then greatest(t.anc4,t.ifa_180_anc_date) end,\n\tcomplete_anc_location = case when (t.anc4 is not null and t.ifa_180_anc_date is not null) and (t.anc4 > t.ifa_180_anc_date) \n\t\t\t\t\t\t\t\t\tthen t.anc4_location_id \n\t\t\t\t\t\t\t\twhen (t.anc4 is not null and t.ifa_180_anc_date is not null) then t.ifa_180_anc_location end,\n\ttotal_regular_anc = (case when t.anc1 is null then 0 else 1 end) \n\t+  (case when t.anc2 is null then 0 else 1 end) \n\t+  (case when t.anc3 is null then 0 else 1 end) \n\t+  (case when t.anc4 is null then 0 else 1 end),  \n\tjsy_beneficiary =t.jsy_beneficiary,\n\tjsy_payment_date = t.jsy_payment_date,\n\taadhar_and_bank =t.aadhar_and_bank,\n\taadhar_reg =t.aadhar_reg,\n\taadhar_with_no_bank =t.aadhar_with_no_bank,\n\tbank_with_no_aadhar =t.bank_with_no_aadhar,\n\tno_aadhar_and_bank =t.no_aadhar_and_bank,\n\thigh_risk_mother = case when t.high_risk_mother = true or t.total_out_come >= 3 \n\tor t.chro_diabetes = true or t.chro_heart_kidney = true\n\tor t.chro_hiv = true or t.chro_thalessemia = true or t.chro_sickle = true \n\tor t.chro_tb = true or t.cur_extreme_age = true or t.cur_low_weight = true \n\tor t.cur_severe_anemia = true or t.cur_blood_pressure_issue = true \n\tor t.cur_gestational_diabetes_issue = true or t.prev_preg_diff_in_month <= 18\n\tor t.cur_social_vulnerability = true\n\tthen true else false end,\n\thigh_risk_cnt =t.high_risk_cnt + case when t.total_out_come >=3 then 1 else 0 end \n\t+ case when t.chro_tb then 1 else 0 end + case when t.chro_diabetes then 1 else 0 end\n\t+ case when t.chro_heart_kidney then 1 else 0 end + case when t.chro_hiv then 1 else 0 end\n\t+ case when t.chro_thalessemia then 1 else 0 end + case when t.chro_sickle then 1 else 0 end\n\t+ case when t.cur_extreme_age then 1 else 0 end\n\t+ case when t.prev_preg_diff_in_month <= 18 then 1 else 0 end,\n\thbsag_test_cnt =t.hbsag_test_cnt,\n\thbsag_reactive_cnt =t.hbsag_reactive_cnt,\n\thbsag_non_reactive_cnt =t.hbsag_non_reactive_cnt,\n\tpre_preg_anemia =t.pre_preg_anemia,\n\t\n\tpre_preg_aph =t.pre_preg_aph,\n\tpre_preg_pph =t.pre_preg_pph,\n\tpre_preg_pre_eclampsia =t.pre_preg_pre_eclampsia,\n\tpre_preg_obstructed_labour =t.pre_preg_obstructed_labour,\n\tpre_preg_placenta_previa =t.pre_preg_placenta_previa,\n\tpre_preg_malpresentation =t.pre_preg_malpresentation,\n\tpre_preg_birth_defect =t.pre_preg_birth_defect,\n\tpre_preg_preterm_delivery =t.pre_preg_preterm_delivery,\n\t\n\tpre_preg_caesarean_section =t.pre_preg_caesarean_section,\n\tpre_preg_abortion =t.pre_preg_abortion,\n\tchro_tb =t.chro_tb,\n\tchro_diabetes =t.chro_diabetes,\n\tchro_heart_kidney =t.chro_heart_kidney,\n\tchro_hiv =t.chro_hiv,\n\tchro_sickle =t.chro_sickle,\n\tchro_thalessemia =t.chro_thalessemia,\n\tdelivery_outcome =t.delivery_outcome,\n\tdelivery_health_infrastructure = t.delivery_health_infrastructure,\n\tis_chiranjivi_delivery = t.is_chiranjivi_delivery,\n\ttype_of_delivery=t.type_of_delivery,\n\tdelivery_place = t.delivery_place,\n\thome_del =t.home_del,\n\tinstitutional_del =t.institutional_del,\n\tdelivery_108 = t.delivery_108,\n    \n    delivery_out_of_state_govt = t.delivery_out_of_state_govt,\n    delivery_out_of_state_pvt = t.delivery_out_of_state_pvt,\n\n\tbreast_feeding_in_one_hour =t.breast_feeding_in_one_hour,\n\tdelivery_hospital =t.delivery_hospital,\n\tdel_week =t.del_week,\n\tis_cortico_steroid =t.is_cortico_steroid,\n\tmother_alive =t.mother_alive,\n\ttotal_out_come =t.total_out_come,\n\tmale =t.male,\n\tfemale =t.female,\n\t\n\tstill_birth = t.still_birth,\n\tlive_birth = t.live_birth,\n\t\n\tdelivery_done_by = t.delivery_done_by,\n\tpnc1 =t.pnc1,\n\tpnc1_location_id = t.pnc1_location_id,\n\tpnc2 =t.pnc2,\n\tpnc2_location_id = t.pnc2_location_id,\n\tpnc3 =t.pnc3,\n\tpnc3_location_id = t.pnc3_location_id,\n\tpnc4 =t.pnc4,\n\tpnc4_location_id = t.pnc4_location_id,\n\t\n\tifa_tab_after_delivery = t.ifa_tab_after_delivery,\n\t\n\thaemoglobin_tested_count = t.haemoglobin_tested_count,\n\tiron_def_anemia_inj = t.iron_def_anemia_inj,\n\tblood_transfusion = t.blood_transfusion,\n\tppiucd_insert_date = t.ppiucd_insert_date,\n\tppiucd_insert_location = t.ppiucd_insert_location,\n\tis_fru = t.is_fru,\n\thigh_risk_reasons = t.high_risk_reasons,\n\ttracking_location_id = t.tracking_location_id,\n\tis_valid_for_tracking_report = t.is_valid_for_tracking_report\nfrom t_pregnancy_registration_det t\nwhere t.pregnancy_reg_id = rch_pregnancy_analytics_details.pregnancy_reg_id;\n/*with member_details as (\n    select distinct on (member_id)\n    member_id,\n    pregnancy_reg_id,\n    high_risk_mother,\n    high_risk_reasons\n    from t_pregnancy_registration_det\n    order by member_id,pregnancy_reg_id desc\n)update imt_member\nset is_high_risk_case = member_details.high_risk_mother,\nadditional_info = concat(cast(additional_info as jsonb),cast(concat(''{\"highRiskReasons\":\"'',case when member_details.high_risk_reasons is not null then member_details.high_risk_reasons else ''null'' end,''\"}'') as jsonb))\nfrom member_details\nwhere imt_member.id = member_details.member_id\nand (\n    imt_member.is_high_risk_case != member_details.high_risk_mother\n    or cast(additional_info as jsonb) ->> ''highRiskReasons'' != member_details.high_risk_reasons\n);*/\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED12''\nwhere event_config_id = 39 and status = ''PROCESSED11'';\ncommit;\n\n---13\nbegin;\ndrop table if exists t_pregnancy_registration_det;\n\n\n---14\n-----------------------------------------------------------------------------------------------------------------------------\ndrop table if exists rch_lmp_base_location_wise_data_point_t;\ncreate table rch_lmp_base_location_wise_data_point_t (\n\tlocation_id bigint,\n\tmonth_year date,\n\tfinancial_year text,\n\t\n\tanc_reg bigint,\n\tjsy_beneficiary integer,\n\tjsy_beneficiaries_with_aadhar_and_bank_no integer,\n\tjsy_beneficiaries_with_aadhar_reg_no integer,\n\tjsy_beneficiaries_with_aadhar_id_but_no_bank_details integer,\n\tjsy_beneficiaries_with_bank_acc_but_no_aadhar_details integer,\n\tjsy_beneficiaries_with_no_aadhar_and_bank_details integer,\n\tabortion integer,\n\tmtp integer,\n\tno_of_inst_del integer,\n\tno_of_home_del integer,\n\tdelivery_108 integer,\n    delivery_out_of_state_govt integer,\n    delivery_out_of_state_pvt integer,\n\t\n\tno_of_maternal_death integer,\n\t\n\tno_of_missing_del integer,\n\tno_of_not_missing_del integer,\n\thigh_risk_mother bigint,\n\tpre_preg_pre_eclampsia bigint,\n\tprev_anemia bigint,\n\tprev_caesarian bigint,\n\tprev_aph_pph bigint,\n\tprev_abortion bigint,\n\tmultipara bigint,\n\tcur_mal_presentation_issue bigint,\n\tcur_malaria_issue bigint,\n\t\n\ttb bigint,\n\tdiabetes bigint,\n\theart_kidney bigint,\n\thiv bigint,\n\tsickle bigint,\n\tthalessemia bigint,\n\tearly_anc integer,\n\tanc1 integer,\n\tanc2 integer,\n\tanc3 integer,\n\tanc4 integer,\n\tfull_anc integer,\n\tifa integer,\n\ttt1 integer,\n\ttt2 integer,\n\ttt_booster integer,\n\ttt2_tt_booster integer,\n\tlbirth integer,\n\tsbirth integer,\n\thome_del integer,\n\tbreast_feeding integer,\n\tsc integer,\n\tphc integer,\n\tchc integer,\n\tsdh integer,\n\tuhc integer,\n\tgia integer,\n\tchiranjivi integer,\n\tmedi_college integer,\n\ttaluka_hospi integer,\n\tpvt integer,\n\n\thome_del_by_sba integer,\n\thome_del_by_non_sba integer,\n\tdel_over_due integer,\n\tifa_30_tablet_in_30_day integer,\n\tifa_30_tablet_in_31_to_61_day integer,\n\tifa_30_tablet_in_61_to_90_day integer,\n\thb_done integer,\n\thb_more_then_11_in_91_to_360_days integer,\n\tifa_180_with_hb_in_4_to_9_month integer,\n\thb_between_7_to_11 integer,\n\tifa_360_with_hb_between_7_to_11_in_4_to_9_month integer,\n\tca_180_given_in_2nd_trimester integer,\n\tca_180_given_in_3rd_trimester integer,\n\thr_anc_regd integer,\n\thr_tt1 integer,\n\thr_tt2_and_tt_boster integer,\n\thr_tt2_tt_booster integer,\n\thr_early_anc integer,\n\thr_anc1 integer,\n\thr_anc2 integer,\n\thr_anc3 integer,\n\thr_anc4 integer,\n\thr_no_of_delivery integer,\n\thr_mtp integer,\n\thr_abortion integer,\n\thr_pnc1 integer,\n\thr_pnc2 integer,\n\thr_pnc3 integer,\n\thr_pnc4 integer,\n\thr_maternal_death integer,\n\thr_sc integer,\n\thr_phc integer,\n\thr_fru_chc integer,\n\thr_non_fru_chc integer,\n\thr_sdh integer,\n\thr_uhc integer,\n\thr_gia integer,\n\thr_chiranjivi integer,\n\thr_medi_college integer,\n\thr_taluka_hospi integer,\n\thr_pvt integer,\n\thr_home_del_by_sba integer,\n\thr_home_del_by_non_sba integer,\n\tprimary key(location_id,month_year)\n);\n\ninsert into rch_lmp_base_location_wise_data_point_t(\n\tlocation_id,month_year,financial_year,\n\tanc_reg,jsy_beneficiary,jsy_beneficiaries_with_aadhar_and_bank_no,jsy_beneficiaries_with_aadhar_reg_no,\n\tjsy_beneficiaries_with_aadhar_id_but_no_bank_details,jsy_beneficiaries_with_bank_acc_but_no_aadhar_details,jsy_beneficiaries_with_no_aadhar_and_bank_details,\n\tabortion,mtp,no_of_maternal_death,no_of_inst_del,no_of_home_del,home_del_by_sba,\n\thome_del_by_non_sba,delivery_108,delivery_out_of_state_govt,delivery_out_of_state_pvt,no_of_missing_del,no_of_not_missing_del,\n\thigh_risk_mother,pre_preg_pre_eclampsia,prev_anemia,prev_caesarian,prev_aph_pph,prev_abortion,multipara,\n\tcur_malaria_issue,cur_mal_presentation_issue,tb,diabetes,heart_kidney,hiv,sickle,thalessemia,\n\tearly_anc,anc1,anc2,anc3,anc4,\n\tfull_anc,ifa,\n\ttt1,tt2,tt_booster,tt2_tt_booster,\n\tlbirth,sbirth,home_del,breast_feeding,sc,phc,chc,sdh,uhc,gia,chiranjivi,medi_college,taluka_hospi,pvt,del_over_due\n\t,ifa_30_tablet_in_30_day,ifa_30_tablet_in_31_to_61_day,ifa_30_tablet_in_61_to_90_day,hb_done\n\t,hb_more_then_11_in_91_to_360_days,ifa_180_with_hb_in_4_to_9_month,hb_between_7_to_11,ifa_360_with_hb_between_7_to_11_in_4_to_9_month\n\t,ca_180_given_in_2nd_trimester,ca_180_given_in_3rd_trimester,hr_anc_regd,\n\thr_tt1, hr_tt2_and_tt_boster, hr_tt2_tt_booster, hr_early_anc, hr_anc1, hr_anc2, hr_anc3,\n\thr_anc4, hr_no_of_delivery, hr_mtp, hr_abortion, hr_pnc1, hr_pnc2, hr_pnc3, hr_pnc4, hr_maternal_death,\n \thr_sc, hr_phc, hr_fru_chc, hr_non_fru_chc, hr_sdh, hr_uhc, hr_gia, hr_chiranjivi, hr_medi_college, hr_taluka_hospi, hr_pvt, hr_home_del_by_sba,\n\thr_home_del_by_non_sba\n)\nselect tracking_location_id,lmp_month_year,lmp_financial_year,\ncount(*) as anc_regd,\nsum(case when jsy_beneficiary = true then 1 else 0 end ) as jsy_beneficiary,\nsum(case when jsy_beneficiary = true and aadhar_and_bank then 1 else 0 end ) as jsy_beneficiaries_with_aadhar_and_bank_no,\nsum(case when jsy_beneficiary = true and aadhar_reg then 1 else 0 end ) as jsy_beneficiaries_with_aadhar_reg_no,\nsum(case when jsy_beneficiary = true and aadhar_with_no_bank then 1 else 0 end ) as jsy_beneficiaries_with_aadhar_id_but_no_bank_details,\nsum(case when jsy_beneficiary = true and bank_with_no_aadhar then 1 else 0 end ) as jsy_beneficiaries_with_bank_acc_but_no_aadhar_details,\nsum(case when jsy_beneficiary = true and no_aadhar_and_bank then 1 else 0 end ) as jsy_beneficiaries_with_no_aadhar_and_bank_details,\nsum(case when delivery_outcome in (''ABORTION'', ''SPONT_ABORTION'') then 1 else 0 end) as no_of_abortion,\nsum(case when delivery_outcome = ''MTP'' then 1 else 0 end) as no_of_mtp,\nsum(case when maternal_detah = true then 1 else 0 end) as no_of_death,\nsum(case when institutional_del and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as no_of_inst_del,\nsum(case when (home_del) and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as no_of_home_del,\nsum(case when home_del and delivery_outcome in (''LBIRTH'',''SBIRTH'') \n\tand (delivery_done_by is null  or delivery_done_by != ''NON-TBA'') then 1 else 0 end) as home_del_by_sba,\nsum(case when home_del and delivery_outcome in (''LBIRTH'',''SBIRTH'')\n\tand (delivery_done_by is not null  and delivery_done_by = ''NON-TBA'') then 1 else 0 end) as home_del_by_non_sba,\n\t\nsum(case when delivery_108 and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as delivery_108,\n\nsum(case when delivery_out_of_state_govt = true then 1 else 0 end) as delivery_out_of_state_govt,\nsum(case when delivery_out_of_state_pvt = true then 1 else 0 end) as delivery_out_of_state_pvt,\n\nsum(case when preg_reg_state in (''PENDING'',''PREGNANT'') \n\tand maternal_detah is false and edd <= current_date then 1 else 0 end) as no_of_missing_del,\nsum(case when preg_reg_state in (''PENDING'',''PREGNANT'') \n\tand maternal_detah is false and edd > current_date then 1 else 0 end) as no_of_not_missing_del,\t\nsum(case when high_risk_mother = true then 1 else 0 end) as high_risk_mother,\nsum(case when pre_preg_pre_eclampsia then 1 else 0 end) as pre_preg_pre_eclampsia,\nsum(case when pre_preg_anemia then 1 else 0 end) as prev_anemia,\nsum(case when pre_preg_caesarean_section then 1 else 0 end) as prev_caesarian,\nsum(case when pre_preg_aph or pre_preg_pph  then 1 else 0 end) as prev_aph_pph,\nsum(case when pre_preg_abortion then 1 else 0 end) as prev_abortion,\nsum(case when total_out_come>=3 then 1 else 0 end) as multipara,\nsum(case when cur_malaria_issue then 1 else 0 end) as cur_malaria_issue,\nsum(case when cur_mal_presentation_issue then 1 else 0 end) as cur_mal_presentation_issue,\nsum(case when chro_tb then 1 else 0 end) as tb,\nsum(case when chro_diabetes then 1 else 0 end) as diabetes,\nsum(case when chro_heart_kidney then 1 else 0 end) as heart_kidney,\nsum(case when chro_hiv then 1 else 0 end) as hiv,\nsum(case when chro_sickle then 1 else 0 end) as sickle,\nsum(case when chro_thalessemia then 1 else 0 end) as thalessemia,\nsum(case when early_anc then 1 else 0 end) as early_anc,\nsum(case when anc1 is not null then 1 else 0 end) as anc1,\nsum(case when anc2 is not null then 1 else 0 end) as anc2,\nsum(case when anc3 is not null then 1 else 0 end) as anc3,\nsum(case when anc4 is not null then 1 else 0 end) as anc4,\nsum(case when total_regular_anc >=4 and ifa >= 180 and (tt2_given is not null or tt_boster is not null) then 1 else 0 end) as full_anc,\nsum(case when ifa >= 180 then 1 else 0 end) as ifa,\nsum(case when tt1_given is not null then 1 else 0 end) as tt1,\nsum(case when tt2_given is not null then 1 else 0 end) as tt2,\nsum(case when tt_boster is not null then 1 else 0 end) as tt_boster,\nsum(case when tt2_tt_booster_given is not null then 1 else 0 end) as tt2_tt_booster,\nsum(case when delivery_outcome = ''LBIRTH'' then 1 else 0 end) as lbirth,\nsum(case when delivery_outcome = ''SBIRTH'' then 1 else 0 end) as sbirth,\nsum(case when home_del and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as home_del,\nsum(case when breast_feeding_in_one_hour = true then 1 else 0 end) as breast_feeding,\nsum(case when delivery_hospital in (''897'',''1062'') then 1 else 0 end) as sc,  \nsum(case when delivery_hospital in (''899'',''1061'') then 1 else 0 end) as phc,\nsum(case when delivery_hospital in (''895'',''1009'',''1084'') then 1 else 0 end) as chc,\nsum(case when delivery_hospital in (''890'',''1008'') then 1 else 0 end) as sdh,\nsum(case when delivery_hospital in (''894'',''1063'') then 1 else 0 end) as uhc,\nsum(case when delivery_hospital in (''1064'') then 1 else 0 end) as gia,\nsum(case when institutional_del and is_chiranjivi_delivery and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as chiranjivi,\nsum(case when delivery_hospital in (''891'',''1012'') then 1 else 0 end) as medi_college,\nsum(case when delivery_hospital in (''896'',''1007'') then 1 else 0 end) as taluka_hospi,\nsum(case when delivery_hospital in (''893'',''898'',''1013'',''1010'') then 1 else 0 end) as pvt,\nsum(case when lmp_date + interval ''281 days'' < now() and delivery_outcome is null then 1 else 0  end) as del_over_due,\nsum(case when fa_tab_in_30_day >= 30 then 1 else 0  end) as ifa_30_tablet_in_30_day,\nsum(case when fa_tab_in_31_to_60_day >= 30 then 1 else 0  end) as ifa_30_tablet_in_31_to_61_day,\nsum(case when fa_tab_in_61_to_90_day >= 30 then 1 else 0  end) as ifa_30_tablet_in_61_to_90_day,\nsum(case when hb is not null then 1 else 0  end) as hb_done,\nsum(case when hb_between_90_to_360_days > 11 then 1 else 0  end) as hb_more_then_11_in_91_to_360_days,\nsum(case when hb_between_90_to_360_days > 11 and ifa_tab_in_4_month_to_9_month >= 180 then 1 else 0  end) as ifa_180_with_hb_in_4_to_9_month,\nsum(case when hb_between_90_to_360_days between 7 and 11 then 1 else 0  end) as hb_between_7_to_11,\nsum(case when hb_between_90_to_360_days between 7 and 11 and ifa_tab_in_4_month_to_9_month >= 180 then 1 else 0  end) as ifa_360_with_hb_between_7_to_11_in_4_to_9_month,\nsum(case when ca_tab_in_91_to_180_day >= 180 then 1 else 0  end) as ca_180_given_in_2nd_trimester,\nsum(case when ca_tab_in_181_to_360_day >= 180 then 1 else 0  end) as ca_180_given_in_3rd_trimester,\ncount(*) filter ( where high_risk_mother = true) as hr_anc_regd,\nsum(case when high_risk_mother = true and tt1_given is not null then 1 else 0 end) as hr_tt1,\nsum(case when high_risk_mother = true and tt_boster is not null and  tt2_given is not null then 1 else 0 end) as hr_tt2_and_tt_boster,\nsum(case when high_risk_mother = true and tt2_tt_booster_given is not null then 1 else 0 end) as hr_tt2_tt_booster,\nsum(case when high_risk_mother = true and early_anc then 1 else 0 end) as hr_early_anc,\nsum(case when high_risk_mother = true and anc1 is not null then 1 else 0 end) as hr_anc1,\nsum(case when high_risk_mother = true and anc2 is not null then 1 else 0 end) as hr_anc2,\nsum(case when high_risk_mother = true and anc3 is not null then 1 else 0 end) as hr_anc3,\nsum(case when high_risk_mother = true and anc4 is not null then 1 else 0 end) as hr_anc4,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as hr_no_of_delivery,\nsum(case when high_risk_mother = true and delivery_outcome = ''MTP'' then 1 else 0 end) as hr_mtp,\nsum(case when high_risk_mother = true and delivery_outcome in (''ABORTION'', ''SPONT_ABORTION'') then 1 else 0 end) as hr_abortion,\nsum(case when high_risk_mother = true and pnc1 is not null then 1 else 0 end) as hr_pnc1,\nsum(case when high_risk_mother = true and pnc2 is not null then 1 else 0 end) as hr_pnc2,\nsum(case when high_risk_mother = true and pnc3 is not null then 1 else 0 end) as hr_pnc3,\nsum(case when high_risk_mother = true and pnc4 is not null then 1 else 0 end) as hr_pnc4,\nsum(case when high_risk_mother = true and maternal_detah = true then 1 else 0 end) as hr_maternal_death,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital in (''897'',''1062'') then 1 else 0 end) as hr_sc,  \nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital in (''899'',''1061'') then 1 else 0 end) as hr_phc,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and is_fru and delivery_hospital in (''895'',''1009'',''1084'') then 1 else 0 end) as hr_fru_chc,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and is_fru is false and delivery_hospital in (''895'',''1009'',''1084'') then 1 else 0 end) as hr_non_fru_chc,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital in (''890'',''1008'') then 1 else 0 end) as hr_sdh,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital in (''894'',''1063'') then 1 else 0 end) as hr_uhc,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital in (''1064'') then 1 else 0 end) as hr_gia,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital = ''892'' then 1 else 0 end) as hr_chiranjivi,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital in (''891'',''1012'') then 1 else 0 end) as hr_medi_college,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital in (''896'',''1007'') then 1 else 0 end) as hr_taluka_hospi,\nsum(case when high_risk_mother = true and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_hospital in (''893'',''898'',''1013'',''1010'') then 1 else 0 end) as hr_pvt,\nsum(case when high_risk_mother = true and home_del and delivery_outcome in (''LBIRTH'',''SBIRTH'') \n\tand (delivery_done_by is null  or delivery_done_by != ''NON-TBA'') then 1 else 0 end) as hr_home_del_by_sba,\nsum(case when high_risk_mother = true and home_del and delivery_outcome in (''LBIRTH'',''SBIRTH'')\n\tand (delivery_done_by is not null  and delivery_done_by = ''NON-TBA'') then 1 else 0 end) as hr_home_del_by_non_sba\n\nfrom rch_pregnancy_analytics_details\nwhere is_valid_for_tracking_report = true\ngroup by tracking_location_id,lmp_month_year,lmp_financial_year;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED14''\nwhere event_config_id = 39 and status = ''PROCESSED12'';\ncommit;\n---15\n----------------------------------------------------------------------------------------------------------------------------------------------\nbegin;\ndrop table if exists rch_delivery_date_base_location_wise_data_point_t;\ncreate table rch_delivery_date_base_location_wise_data_point_t (\n\tlocation_id bigint,\n\tmonth_year date,\n\t\n\tdel_reg integer,\n\tdel_reg_still_live_birth integer,\n\tpreg_reg integer,\n\tdel_less_eq_34 integer,\n\tdel_bet_35_37 integer,\n\tdel_greater_37 integer,\n\tcortico_steroid integer,\n\tmtp integer,\n\tlbirth integer,\n\tsbirth integer,\n\tabortion integer,\n\thome_del integer,\n\thome_del_by_sba integer,\n\thome_del_by_non_sba integer,\n\tbreast_feeding integer,\n\tsc integer,\n\tphc integer,\n\tchc integer,\n\tsdh integer,\n\tuhc integer,\n\tgia integer,\n\tchiranjivi integer,\n\tcm_dashboard_chirnajivi integer,\n\tpvt integer,\n\tmdh integer,\n\tdh integer,\n\tdelivery_108 integer,\n    \n    delivery_out_of_state_govt integer,\n    delivery_out_of_state_pvt integer,\n\n\tphi_del_3_ancs integer,\n\tinst_del integer,\n\tmaternal_detah integer,\n\tpnc1 integer,\n\tpnc2 integer,\n\tpnc3 integer,\n\tpnc4 integer,\n\tfull_pnc integer,\n\tifa_180_after_delivery integer,\n\tcalcium_360_after_delivery integer,\n\t\n\tprimary key(location_id,month_year)\t\n);\n\ninsert into rch_delivery_date_base_location_wise_data_point_t(\n\tlocation_id,month_year,\n\tdel_reg,del_reg_still_live_birth,del_less_eq_34,del_bet_35_37,del_greater_37,cortico_steroid,\n\tmtp,abortion,lbirth,sbirth,home_del,home_del_by_sba,home_del_by_non_sba,breast_feeding,\n\tsc,phc,chc,sdh,uhc,gia,chiranjivi,cm_dashboard_chirnajivi,pvt,mdh,dh,delivery_108,delivery_out_of_state_govt,delivery_out_of_state_pvt,\n\tphi_del_3_ancs,inst_del,pnc1,pnc2,pnc3,pnc4,full_pnc,ifa_180_after_delivery\n)\nselect delivery_location_id,\ncast(date_trunc(''month'',date_of_delivery_month_year) as date) as month_year,\ncount(*),\nsum(case when delivery_outcome in(''LBIRTH'',''SBIRTH'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as del_reg_still_live_birth,\nsum(case when del_week <= 34 and delivery_outcome in(''LBIRTH'',''SBIRTH'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as del_less_eq_34,\nsum(case when del_week between 35 and 37 and delivery_outcome in(''LBIRTH'',''SBIRTH'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as del_bet_35_37,\nsum(case when del_week > 37 and delivery_outcome in(''LBIRTH'',''SBIRTH'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as del_greater_37,\nsum(case when del_week <= 34 and delivery_outcome in(''LBIRTH'',''SBIRTH'') and is_cortico_steroid and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as cortico_steroid,\nsum(case when delivery_outcome = ''MTP'' and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as mtp,\nsum(case when delivery_outcome in (''ABORTION'', ''SPONT_ABORTION'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as abortion,\nsum(case when delivery_outcome = ''LBIRTH'' and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then total_out_come else 0 end) as lbirth,\nsum(case when (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then still_birth else 0 end) as sbirth,\nsum(case when home_del and delivery_outcome in (''LBIRTH'',''SBIRTH'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as home_del,\nsum(case when home_del and delivery_outcome in (''LBIRTH'',''SBIRTH'') \n\tand (delivery_done_by is null  or delivery_done_by != ''NON-TBA'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as home_del_by_sba,\nsum(case when home_del and delivery_outcome in (''LBIRTH'',''SBIRTH'') and delivery_done_by is not null \n\tand delivery_done_by = ''NON-TBA'' and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as home_del_by_non_sba,\nsum(case when delivery_hospital in (''897'',''1062'',''899'',''1061'',''895'',''1009'',''890'',''1008'',''894'',''1063'',''892'',''891'',''1012'',''896'',''1007'',''1084'') \n\tand delivery_outcome in (''LBIRTH'',''SBIRTH'') and breast_feeding_in_one_hour = true \n\tthen 1 else 0 end) as breast_feeding,\nsum(case when institutional_del  and  delivery_hospital in (''897'',''1062'') and delivery_outcome in (''LBIRTH'',''SBIRTH'')  then 1 else 0 end) as sc,  \nsum(case when institutional_del  and  delivery_hospital in (''899'',''1061'') and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as phc,\nsum(case when institutional_del  and  delivery_hospital in (''895'',''1009'',''1084'') and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as chc,\nsum(case when institutional_del  and  delivery_hospital in (''890'',''1008'') and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as sdh,\nsum(case when institutional_del  and  delivery_hospital in (''894'',''1063'') and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as uhc,\nsum(case when institutional_del  and  delivery_hospital in (''1064'') and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as gia,\nsum(case when institutional_del  and is_chiranjivi_delivery and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as chiranjivi,\nsum(case when is_chiranjivi_delivery and delivery_outcome in (''LBIRTH'',''SBIRTH'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as cm_dashboard_chirnajivi,\nsum(case when institutional_del  and  delivery_hospital in (''893'',''898'',''1013'',''1010'') and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as pvt,\nsum(case when institutional_del  and  delivery_hospital in (''891'',''1012'') and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as mdh,\nsum(case when institutional_del  and  delivery_hospital in (''896'',''1007'') and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as dh,\nsum(case when delivery_108 and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as delivery_108,\n\nsum(case when delivery_out_of_state_govt = true then 1 else 0 end) as delivery_out_of_state_govt,\nsum(case when delivery_out_of_state_pvt = true then 1 else 0 end) as delivery_out_of_state_pvt,\n\nsum(case when ((institutional_del  and delivery_hospital in (''897'',''1062'',''899'',''1061'',''895'',''1009'',''890'',''1008'',''894'',''1063'',''892'',''891'',''1012'',''896'',''1007'',''1084'')) \n\tor delivery_108)\n\tand delivery_outcome in (''LBIRTH'',''SBIRTH'') and total_regular_anc >= 3  then 1 else 0 end) as phi_del_3_ancs,\nsum(case when (institutional_del) and delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as no_of_inst_del,\nsum(case when pnc1 is not null then 1 else 0 end) as pnc1,\nsum(case when pnc2 is not null then 1 else 0 end) as pnc2,\nsum(case when pnc3 is not null then 1 else 0 end) as pnc3,\nsum(case when pnc4 is not null then 1 else 0 end) as pnc4,\nsum(case when pnc4 is not null and ifa_tab_after_delivery >= 180 then 1 else 0 end) as full_pnc,\nsum(case when ifa_tab_after_delivery >= 180 then 1 else 0 end) as ifa_180_after_delivery\n--,sum(case when maternal_detah then 1 else 0 end) as maternal_death\nfrom rch_pregnancy_analytics_details\nwhere date_of_delivery_month_year is not null and delivery_outcome is not null\ngroup by delivery_location_id,date_of_delivery_month_year;\n\n\nwith del_det as(\n\tselect rprd.native_location_id as location_id\n\t,cast(date_trunc(''month'', rprd.reg_service_date) as date) as month_year,\n\tcount(*) as anc_reg,\n\tsum(case when early_anc then 1 else 0 end) as early_anc\n\tfrom rch_pregnancy_analytics_details rprd\n\twhere rprd.reg_service_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n\tgroup by rprd.native_location_id,cast(date_trunc(''month'', rprd.reg_service_date) as date)\n),maternal_death_detail as (\n\tselect rch_pregnancy_analytics_details.death_location_id as location_id,\n\tcast(date_trunc(''month'', rch_pregnancy_analytics_details.death_date) as date) as month_year,\n\tcount(*) as maternal_detah \n\tfrom rch_pregnancy_analytics_details\n\twhere rch_pregnancy_analytics_details.death_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n\tand rch_pregnancy_analytics_details.maternal_detah = true\n\tgroup by rch_pregnancy_analytics_details.death_location_id\n\t,cast(date_trunc(''month'', rch_pregnancy_analytics_details.death_date) as date)\n),location_det as (\nselect location_id,month_year from del_det\n\tunion\nselect location_id,month_year from maternal_death_detail\t\n)\ninsert into rch_delivery_date_base_location_wise_data_point_t(location_id,month_year)\nselect location_det.location_id,location_det.month_year \nfrom location_det\nleft join rch_delivery_date_base_location_wise_data_point_t \non location_det.location_id = rch_delivery_date_base_location_wise_data_point_t.location_id\nand location_det.month_year = rch_delivery_date_base_location_wise_data_point_t.month_year\nwhere rch_delivery_date_base_location_wise_data_point_t.location_id is null;\n\n\nwith maternal_death_detail as(\n\tselect rch_pregnancy_analytics_details.death_location_id as location_id,\n\tcast(date_trunc(''month'', rch_pregnancy_analytics_details.death_date) as date) as month_year,\n\tcount(*) as maternal_detah \n\tfrom rch_pregnancy_analytics_details\n\twhere rch_pregnancy_analytics_details.death_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n\tand rch_pregnancy_analytics_details.maternal_detah = true\n\tgroup by rch_pregnancy_analytics_details.death_location_id\n\t,cast(date_trunc(''month'', rch_pregnancy_analytics_details.death_date) as date)\n)\t\nupdate rch_delivery_date_base_location_wise_data_point_t \nset maternal_detah = maternal_death_detail.maternal_detah\nfrom maternal_death_detail where maternal_death_detail.location_id = rch_delivery_date_base_location_wise_data_point_t.location_id\nand maternal_death_detail.month_year = rch_delivery_date_base_location_wise_data_point_t.month_year;\n\nwith del_det as(\n\tselect rprd.native_location_id as location_id,cast(date_trunc(''month'', rprd.reg_service_date) as date) as month_year,\n\tcount(*) as anc_reg,\n\tsum(case when early_anc then 1 else 0 end) as early_anc\n\tfrom rch_pregnancy_analytics_details rprd\n\twhere rprd.reg_service_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n\tgroup by rprd.native_location_id,cast(date_trunc(''month'', rprd.reg_service_date) as date)\n)\t\nupdate rch_delivery_date_base_location_wise_data_point_t \nset preg_reg = anc_reg\nfrom del_det where del_det.location_id = rch_delivery_date_base_location_wise_data_point_t.location_id\nand del_det.month_year = rch_delivery_date_base_location_wise_data_point_t.month_year;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED15''\nwhere event_config_id = 39 and status = ''PROCESSED14'';\ncommit;\n---16\n------------------------------------------------------------------------------------------------------------------------------------\nbegin;\ndrop table if exists rch_yearly_location_wise_analytics_data_t;\ncreate table rch_yearly_location_wise_analytics_data_t (\n\tlocation_id bigint,\n\tfinancial_year text,\n\tmonth_year date,\n\tage_less_15 integer,\n\tage_15_19 integer,\n\tage_20_24 integer,\n\tage_25_29 integer,\n\tage_30_34 integer,\n\tage_35_39 integer,\n\tage_40_44 integer,\n\tage_45_49 integer,\n\tage_greater_49 integer,\n\tanc_reg integer,\n\thbsag_test integer,\n\tnon_reactive integer,\n\treactive integer,\n\t\n\ttt1 integer,\n\ttt2_tt_booster integer,\n\tearly_anc integer,\n\tanc1 integer,\n\tanc2 integer,\n\tanc3 integer,\n\tanc4 integer,\n\tno_of_del integer,\n\tmtp integer,\n\tabortion integer,\n\tpnc1 integer,\n\tpnc2 integer,\n\tpnc3 integer,\n\tpnc4 integer,\n\tmaternal_detah integer,\n\tprimary key(location_id,financial_year,month_year)\n);\n\ninsert into rch_yearly_location_wise_analytics_data_t(\n\tlocation_id,financial_year,month_year,\n\tage_less_15,age_15_19,age_20_24,age_25_29,age_30_34,age_35_39,age_40_44,age_45_49,age_greater_49,anc_reg,\n\thbsag_test,non_reactive,reactive,\n\ttt1,tt2_tt_booster,early_anc,anc1,anc2,anc3,anc4,no_of_del,mtp,abortion,pnc1,pnc2,pnc3,pnc4,maternal_detah\n)\nselect rprd.tracking_location_id,rprd.reg_service_financial_year,rprd.reg_service_date_month_year,\nsum(case when age_during_delivery < 15 then 1 else 0 end) as age_less_15,\nsum(case when age_during_delivery between 15 and 19 then 1 else 0 end) as age_15_19,\nsum(case when age_during_delivery between 20 and 24 then 1 else 0 end) as age_20_24,\nsum(case when age_during_delivery between 25 and 29 then 1 else 0 end) as age_25_29,\nsum(case when age_during_delivery between 30 and 34 then 1 else 0 end) as age_30_34,  \nsum(case when age_during_delivery between 35 and 39 then 1 else 0 end) as age_35_39,\nsum(case when age_during_delivery between 40 and 44 then 1 else 0 end) as age_40_44,\nsum(case when age_during_delivery between 45 and 49 then 1 else 0 end) as age_45_49, \nsum(case when age_during_delivery > 49 then 1 else 0 end) as age_greater_49,\ncount(*) as anc_reg,\nsum(hbsag_test_cnt) as hbsag_test,              \nsum(hbsag_non_reactive_cnt) as non_reactive,          \nsum(hbsag_reactive_cnt) as reactive,\nsum(case when tt1_given is not null then 1 else 0 end) as tt1,\nsum(case when tt2_given is not null or tt_boster is not null  then 1 else 0 end) as tt2,\nsum(case when early_anc then 1 else 0 end) as early_anc,\nsum(case when total_regular_anc >=1 then 1 else 0 end) as anc1,\nsum(case when total_regular_anc >=2 then 1 else 0 end) as anc2,\nsum(case when total_regular_anc >=3 then 1 else 0 end) as anc3,\nsum(case when total_regular_anc >=4 then 1 else 0 end) as anc4,\nsum(case when delivery_outcome in (''LBIRTH'',''SBIRTH'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as no_of_del,\nsum(case when delivery_outcome = ''MTP'' and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as mtp,         \nsum(case when delivery_outcome in (''ABORTION'', ''SPONT_ABORTION'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as abortion,\nsum(case when pnc1 is not null then 1 else 0 end) as pnc1,\nsum(case when pnc2 is not null then 1 else 0 end) as pnc2,\nsum(case when pnc3 is not null then 1 else 0 end) as pnc3,\nsum(case when pnc4 is not null then 1 else 0 end) as pnc4,\nsum(case when maternal_detah then 1 else 0 end) as maternal_detah\nfrom rch_pregnancy_analytics_details rprd\nwhere is_valid_for_tracking_report = true\ngroup by rprd.tracking_location_id,rprd.reg_service_financial_year,rprd.reg_service_date_month_year;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED16''\nwhere event_config_id = 39 and status = ''PROCESSED15'';\ncommit;\n\n\n---17\n-----------------------------------------------------------------------------------------------------------------------------------------\nbegin;\ndrop table if exists rch_current_state_pregnancy_analytics_data_t;\ncreate table rch_current_state_pregnancy_analytics_data_t (\n\tlocation_id bigint primary key,\n\treg_preg_women integer,\n\thigh_risk integer,\n\tprev_compl integer,\n\tchronic integer,\n\ttwo_or_more_risk integer,\n\tcurrent_preg_compl integer,\n\tsevere_anemia integer,\n\tdiabetes integer,\n\tcur_mal_presentation_issue bigint,\n\tcur_malaria_issue bigint,\n\tmultipara bigint,\n\tblood_pressure integer,\n\tinterval_bet_preg_less_18_months integer,\n\textreme_age integer,\n\theight integer,\n\tweight  integer,\n\turine_albumin integer,\n\tanc_in_2or3_trim integer,\n\talben_given integer,\n\talben_not_given integer,\n\t\n\tpre_preg_pre_eclampsia bigint,\n\tprev_anemia bigint,\n\tprev_caesarian bigint,\n\tprev_aph_pph bigint,\n\tprev_abortion bigint,\n\t\n\tchro_tb bigint,\n\tchro_diabetes bigint,\n\tchro_heart_kidney bigint,\n\tchro_hiv bigint,\n\tchro_sickle bigint,\n\tchro_thalessemia bigint\n);\n\ninsert into rch_current_state_pregnancy_analytics_data_t(\n\tlocation_id,reg_preg_women,high_risk,two_or_more_risk,prev_compl,chronic,current_preg_compl\n\t,severe_anemia,blood_pressure,diabetes,cur_mal_presentation_issue,cur_malaria_issue,multipara,extreme_age,height,weight,urine_albumin\n\t,anc_in_2or3_trim,alben_given,alben_not_given,interval_bet_preg_less_18_months\n\t,pre_preg_pre_eclampsia,prev_anemia,prev_caesarian,prev_aph_pph,prev_abortion\n\t,chro_tb,chro_diabetes,chro_heart_kidney,chro_hiv,chro_sickle,chro_thalessemia\n) \nselect member_current_location_id,\ncount(*) as reg_preg_women,\nsum(case when high_risk_mother = true then 1 else 0 end) as high_risk,\nsum(case when high_risk_cnt >= 2 then 1 else 0 end) as two_or_more_risk,\nsum(case when any_prev_preg_complication then 1 else 0 end) as prev_compl,\nsum(case when any_chronic_dis then 1 else 0 end) as chronic,\nsum(case when any_cur_preg_complication then 1 else 0 end) as current_preg_compl,\nsum(case when cur_severe_anemia then 1 else 0 end) as severe_anemia,\nsum(case when cur_blood_pressure_issue then 1 else 0 end) as blood_pressure,\nsum(case when cur_gestational_diabetes_issue then 1 else 0 end) as diabetes,\nsum(case when cur_mal_presentation_issue then 1 else 0 end) as cur_mal_presentation_issue,\nsum(case when cur_malaria_issue then 1 else 0 end) as cur_malaria_issue,\nsum(case when total_out_come>=3 then 1 else 0 end) as multipara,\nsum(case when cur_extreme_age then 1 else 0 end) as extreme_age,\nsum(case when low_height then 1 else 0 end) as height,\nsum(case when cur_low_weight then 1 else 0 end) as weight,\nsum(case when urine_albumin then 1 else 0 end) as urine_albumin,\nsum(case when current_date - lmp_date between 92 and 245 then 1 else 0 end) anc_in_2or3_trim,\nsum(case when current_date - lmp_date between 92 and 245 and alben_given then 1 else 0 end) alben_given,\nsum(case when current_date - lmp_date between 92 and 245 and (alben_given is null or alben_given = false) then 1 else 0 end) alben_not_given,\nsum(case when cur_less_than_18_month_interval then 1 else 0 end) interval_bet_preg_less_18_months,\n\nsum(case when pre_preg_pre_eclampsia then 1 else 0 end) as pre_preg_pre_eclampsia,\nsum(case when pre_preg_anemia then 1 else 0 end) as prev_anemia,\nsum(case when pre_preg_caesarean_section then 1 else 0 end) as prev_caesarian,\nsum(case when pre_preg_aph or pre_preg_pph  then 1 else 0 end) as prev_aph_pph,\nsum(case when pre_preg_abortion then 1 else 0 end) as prev_abortion,\nsum(case when chro_tb then 1 else 0 end) as tb,\nsum(case when chro_diabetes then 1 else 0 end) as diabetes,\nsum(case when chro_heart_kidney then 1 else 0 end) as heart_kidney,\nsum(case when chro_hiv then 1 else 0 end) as hiv,\nsum(case when chro_sickle then 1 else 0 end) as sickle,\nsum(case when chro_thalessemia then 1 else 0 end) as thalessemia\nfrom rch_pregnancy_analytics_details\nwhere rch_pregnancy_analytics_details.member_basic_state in (''NEW'',''VERIFIED'',''REVERIFICATION'')\nand preg_reg_state in (''PENDING'',''PREGNANT'')\nand is_valid_for_tracking_report = true\ngroup by member_current_location_id;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED17''\nwhere event_config_id = 39 and status = ''PROCESSED16'';\ncommit;\n\n---18\n--------------------------------------------------------------------------------------------------------------------------------------\nbegin;\ndrop table if exists rch_service_provided_during_year_t;\ncreate table rch_service_provided_during_year_t (\n    location_id bigint,\n    month_year date,\n    financial_year text,\n    anc_reg integer,\n    beneficiaries_with_aadhar_reg_no integer,\n    jsy_beneficiary integer,\n    jsy_beneficiary_in_third_trimenster integer,\n    jsy_beneficiaries_with_aadhar_and_bank_no integer,\n    jsy_beneficiaries_with_aadhar_reg_no integer,\n    jsy_beneficiaries_with_aadhar_id_but_no_bank_details integer,\n    jsy_beneficiaries_with_bank_acc_but_no_aadhar_details integer,\n    jsy_beneficiaries_with_no_aadhar_and_bank_details integer,\n\n    regd_live_children integer,\n    regd_no_live_children integer,\n    c1_m1 integer,\n    c1_f1 integer,\n    c2_f2 integer,\n    c2_m2 integer,\n    c2_f1_m1 integer,\n    c3_f3 integer,\n    c3_m3 integer,\n    c3_m2_f1 integer,\n    c3_m1_f2 integer,\n\n    high_risk integer,\n    current_preg_compl integer,\n    severe_anemia integer,\n    diabetes integer,\n    cur_mal_presentation_issue bigint,\n    cur_malaria_issue bigint,\n    multipara bigint,\n    blood_pressure integer,\n    interval_bet_preg_less_18_months integer,\n    extreme_age integer,\n    height integer,\n    weight  integer,\n    urine_albumin integer,\n\n\n    tt1 integer,\n    tt2_tt_booster integer,\n    early_anc integer,\n    anc1 integer,\n    anc2 integer,\n    anc3 integer,\n    anc4 integer,\n    no_of_delivery integer,\n    mtp integer,\n    abortion integer,\n    live_birth integer,\n    still_birth integer,\n    pnc1 integer,\n    pnc2 integer,\n    pnc3 integer,\n    pnc4 integer,\n    mother_death integer,\n    ppiucd integer,\n\n    complete_anc_date integer,\n    ifa_180_anc_date integer,\n\tphi_del integer,\n\tphi_del_with_ppiucd integer,\n\n\n    primary key (location_id, month_year)\n);\n\n\nwith rch_service_yearly_pregnancy_reg as (\n    select rprd.native_location_id as location_id,cast(date_trunc(''month'', rprd.reg_service_date) as date) as month_year,\n    count(*) as anc_reg,\n    sum(case when early_anc then 1 else 0 end) as early_anc,\n    sum(case when aadhar_reg then 1 else 0 end ) as beneficiaries_with_aadhar_reg_no,\n    sum(case when jsy_beneficiary = true then 1 else 0 end ) as jsy_beneficiary,\n    sum(case when jsy_beneficiary = true and current_date - lmp_date >  168 then 1 else 0 end) as jsy_beneficiary_in_third_trimenster,\n    sum(case when jsy_beneficiary = true and aadhar_and_bank then 1 else 0 end ) as jsy_beneficiaries_with_aadhar_and_bank_no,\n    sum(case when jsy_beneficiary = true and aadhar_reg then 1 else 0 end ) as jsy_beneficiaries_with_aadhar_reg_no,\n    sum(case when jsy_beneficiary = true and aadhar_with_no_bank then 1 else 0 end ) as jsy_beneficiaries_with_aadhar_id_but_no_bank_details,\n    sum(case when jsy_beneficiary = true and bank_with_no_aadhar then 1 else 0 end ) as jsy_beneficiaries_with_bank_acc_but_no_aadhar_details,\n    sum(case when jsy_beneficiary = true and no_aadhar_and_bank then 1 else 0 end ) as jsy_beneficiaries_with_no_aadhar_and_bank_details,\n\n    sum(case when high_risk_mother = true then 1 else 0 end) as high_risk,\n    sum(case when any_cur_preg_complication then 1 else 0 end) as current_preg_compl,\n    sum(case when cur_severe_anemia then 1 else 0 end) as severe_anemia,\n    sum(case when cur_blood_pressure_issue then 1 else 0 end) as blood_pressure,\n    sum(case when cur_gestational_diabetes_issue then 1 else 0 end) as diabetes,\n    sum(case when cur_mal_presentation_issue then 1 else 0 end) as cur_mal_presentation_issue,\n    sum(case when cur_malaria_issue then 1 else 0 end) as cur_malaria_issue,\n    sum(case when total_out_come>=3 then 1 else 0 end) as multipara,\n    sum(case when cur_extreme_age then 1 else 0 end) as extreme_age,\n    sum(case when low_height then 1 else 0 end) as height,\n    sum(case when cur_low_weight then 1 else 0 end) as weight,\n    sum(case when urine_albumin then 1 else 0 end) as urine_albumin,\n    sum(case when cur_less_than_18_month_interval then 1 else 0 end) interval_bet_preg_less_18_months,\n\n    sum(case when registered_with_no_of_child > 0 then 1 else 0 end) as regd_live_children,\n    sum(case when registered_with_no_of_child = 0 or registered_with_no_of_child is null then 1 else 0 end) as regd_no_live_children,\n    sum(case when registered_with_no_of_child = 1 and registered_with_male_cnt = 1 then 1 else 0 end) as c1_m1,\n    sum(case when registered_with_no_of_child = 1 and registered_with_female_cnt = 1 then 1 else 0 end) as c1_f1,\n    sum(case when registered_with_no_of_child = 2 and registered_with_female_cnt = 2 then 1 else 0 end) as c2_f2,\n    sum(case when registered_with_no_of_child = 2 and registered_with_male_cnt = 2 then 1 else 0 end) as c2_m2,\n    sum(case when registered_with_no_of_child = 2 and registered_with_male_cnt = 1 and registered_with_female_cnt = 1 then 1 else 0 end) as c2_f1_m1,\n    sum(case when registered_with_no_of_child = 3 and registered_with_female_cnt = 3 then 1 else 0 end) as c3_f3,\n    sum(case when registered_with_no_of_child = 3 and registered_with_male_cnt = 3 then 1 else 0 end) as c3_m3,\n    sum(case when registered_with_no_of_child = 3 and registered_with_male_cnt = 2 and registered_with_female_cnt = 1 then 1 else 0 end) as c3_m2_f1,\n    sum(case when registered_with_no_of_child = 3 and registered_with_male_cnt = 1 and registered_with_female_cnt = 2 then 1 else 0 end) as c3_m1_f2,\n\tsum(case when ((institutional_del  and delivery_hospital in (''897'',''1062'',''899'',''1061'',''895'',''1009'',''890'',''1008'',''894'',''1063'',''892'',''891'',''1012'',''896'',''1007'',''1084'')) \n\tor delivery_108)\n\tand delivery_outcome in (''LBIRTH'',''SBIRTH'') then 1 else 0 end) as phi_del,\n\tsum(case when ((institutional_del  and delivery_hospital in (''897'',''1062'',''899'',''1061'',''895'',''1009'',''890'',''1008'',''894'',''1063'',''892'',''891'',''1012'',''896'',''1007'',''1084'')) \n\tor delivery_108)\n\tand delivery_outcome in (''LBIRTH'',''SBIRTH'') and ppiucd_insert_date is not null then 1 else 0 end) as phi_del_with_ppiucd\n\n    from rch_pregnancy_analytics_details rprd\n    where rprd.reg_service_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rprd.native_location_id,cast(date_trunc(''month'', rprd.reg_service_date) as date)\n), rch_yearly_vacination_tt1 as (\n    select rch_pregnancy_analytics_details.tt1_location_id as location_id\n    ,cast(date_trunc(''month'', rch_pregnancy_analytics_details.tt1_given) as date) as month_year\n    ,sum(1) as tt1\n    from rch_pregnancy_analytics_details\n    where rch_pregnancy_analytics_details.tt1_given >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.tt1_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.tt1_given) as date)\n), rch_yearly_vacination_tt2_tt_booster as (\n    select rch_pregnancy_analytics_details.tt2_tt_booster_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.tt2_tt_booster_given) as date) as month_year,\n    sum(1) as tt2_tt_booster\n    from rch_pregnancy_analytics_details\n    where rch_pregnancy_analytics_details.tt2_tt_booster_given >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.tt2_tt_booster_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.tt2_tt_booster_given) as date)\n), rch_yearly_anc1 as (\n    select rch_pregnancy_analytics_details.anc1_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.anc1) as date) as month_year,\n    sum(1) as anc1\n    from rch_pregnancy_analytics_details\n    where anc1 >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.anc1_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.anc1) as date)\n), rch_yearly_anc2 as (\n    select rch_pregnancy_analytics_details.anc2_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.anc2) as date) as month_year,\n    sum(1) as anc2\n    from rch_pregnancy_analytics_details\n    where anc2 >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.anc2_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.anc2) as date)\n), rch_yearly_anc3 as (\n    select rch_pregnancy_analytics_details.anc3_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.anc3) as date) as month_year,\n    sum(1) as anc3\n    from rch_pregnancy_analytics_details\n    where anc3 >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.anc3_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.anc3) as date)\n), rch_yearly_anc4 as (\n    select rch_pregnancy_analytics_details.anc4_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.anc4) as date) as month_year,\n    sum(1) as anc4\n    from rch_pregnancy_analytics_details\n    where anc4 >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.anc4_location_id,cast(date_trunc(''month'', rch_pregnancy_analytics_details.anc4) as date)\n), rch_wpd_anc_det as (\n    select rprd.delivery_location_id as location_id\n    ,cast(date_trunc(''month'', rprd.delivery_reg_date) as date) as month_year,\n    sum(case when delivery_outcome in (''LBIRTH'',''SBIRTH'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as no_of_delivery,\n    sum(case when delivery_outcome = ''MTP'' and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as mtp,\n    sum(case when delivery_outcome in (''ABORTION'', ''SPONT_ABORTION'') and (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then 1 else 0 end) as abortion,\n    sum(case when (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then live_birth else 0 end) as live_birth,\n    sum(case when (delivery_out_of_state_govt is false and delivery_out_of_state_pvt is false) then still_birth else 0 end) as still_birth\n    from rch_pregnancy_analytics_details rprd\n    where rprd.delivery_reg_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rprd.delivery_location_id,cast(date_trunc(''month'', rprd.delivery_reg_date) as date)\n), rch_yearly_pnc1 as (\n    select rch_pregnancy_analytics_details.pnc1_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.pnc1) as date) as month_year,\n    sum(case when pnc1 >= to_date(''01-04-2013'',''DD-MM-YYYY'') then 1 else 0 end) as pnc1\n    from rch_pregnancy_analytics_details\n    where pnc1 >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.pnc1_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.pnc1) as date)\n), rch_yearly_pnc2 as (\n    select rch_pregnancy_analytics_details.pnc2_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.pnc2) as date) as month_year,\n    sum(case when pnc2 >= to_date(''01-04-2013'',''DD-MM-YYYY'') then 1 else 0 end) as pnc2\n    from rch_pregnancy_analytics_details\n    where pnc2 >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.pnc2_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.pnc2) as date)\n), rch_yearly_pnc3 as (\n    select rch_pregnancy_analytics_details.pnc3_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.pnc3) as date) as month_year,\n    sum(case when pnc3 >= to_date(''01-04-2013'',''DD-MM-YYYY'') then 1 else 0 end) as pnc3\n    from rch_pregnancy_analytics_details\n    where pnc3 >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.pnc3_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.pnc3) as date)\n), rch_yearly_pnc4 as (\n    select rch_pregnancy_analytics_details.pnc4_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.pnc4) as date) as month_year,\n    sum(case when pnc4 >= to_date(''01-04-2013'',''DD-MM-YYYY'') then 1 else 0 end) as pnc4\n    from rch_pregnancy_analytics_details\n    where pnc4 >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.pnc4_location_id, cast(date_trunc(''month'', rch_pregnancy_analytics_details.pnc4) as date)\n), rch_yearly_maternal_death_det as (\n    select rch_pregnancy_analytics_details.death_location_id as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.death_date) as date) as month_year,\n    count(*) as maternal_detah\n    from rch_pregnancy_analytics_details\n    where rch_pregnancy_analytics_details.death_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    and rch_pregnancy_analytics_details.maternal_detah = true\n    group by rch_pregnancy_analytics_details.death_location_id,cast(date_trunc(''month'', rch_pregnancy_analytics_details.death_date) as date)\n), ppiucd_det as (\n    select rch_pregnancy_analytics_details.ppiucd_insert_location as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.ppiucd_insert_date) as date) as month_year,\n    count(*) filter (where delivery_hospital in (''897'',''1062'',''899'',''1061'',''895'',''1009'',''890'',''1008'',''894'',''1063'',''892'',''891'',''1012'',''896'',''1007'',''1084'')) as ppiucd\n    from rch_pregnancy_analytics_details\n    where rch_pregnancy_analytics_details.ppiucd_insert_date is not null and rch_pregnancy_analytics_details.institutional_del = true\n    group by rch_pregnancy_analytics_details.ppiucd_insert_location,cast(date_trunc(''month'', rch_pregnancy_analytics_details.ppiucd_insert_date) as date)\n), complete_anc_date_det as (\n    select rch_pregnancy_analytics_details.complete_anc_location as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.complete_anc_date) as date) as month_year,\n    sum(1) as complete_anc_date\n    from rch_pregnancy_analytics_details\n    where complete_anc_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.complete_anc_location, cast(date_trunc(''month'', rch_pregnancy_analytics_details.complete_anc_date) as date)\n)\n, ifa_180_anc_date_det as (\n    select rch_pregnancy_analytics_details.ifa_180_anc_location as location_id,\n    cast(date_trunc(''month'', rch_pregnancy_analytics_details.ifa_180_anc_date) as date) as month_year,\n    sum(1) as ifa_180_anc_date\n    from rch_pregnancy_analytics_details\n    where ifa_180_anc_date >= to_date(''01-04-2013'',''DD-MM-YYYY'')\n    group by rch_pregnancy_analytics_details.ifa_180_anc_location, cast(date_trunc(''month'', rch_pregnancy_analytics_details.ifa_180_anc_date) as date)\n)\n\n, locations as (\n    select distinct location_id, month_year from (\n    select location_id, month_year from rch_service_yearly_pregnancy_reg\n    union\n    select location_id, month_year from rch_yearly_vacination_tt1\n    union\n    select location_id, month_year from rch_yearly_vacination_tt2_tt_booster\n    union\n    select location_id, month_year from rch_yearly_anc1\n    union\n    select location_id, month_year from rch_yearly_anc2\n    union\n    select location_id, month_year from rch_yearly_anc3\n    union\n    select location_id, month_year from rch_yearly_anc4\n    union\n    select location_id, month_year from rch_wpd_anc_det\n    union\n    select location_id, month_year from rch_yearly_pnc1\n    union\n    select location_id, month_year from rch_yearly_pnc2\n    union\n    select location_id, month_year from rch_yearly_pnc3\n    union\n    select location_id, month_year from rch_yearly_pnc4\n    union\n    select location_id, month_year from rch_yearly_maternal_death_det\n    union\n    select location_id, month_year from ppiucd_det\n    union\n    select location_id, month_year from complete_anc_date_det\n    union\n    select location_id, month_year from ifa_180_anc_date_det\n    ) as t where location_id is not null\n)\ninsert into rch_service_provided_during_year_t (\n    location_id,month_year,financial_year,anc_reg,\n    beneficiaries_with_aadhar_reg_no,jsy_beneficiary,jsy_beneficiary_in_third_trimenster,\n    jsy_beneficiaries_with_aadhar_and_bank_no,jsy_beneficiaries_with_aadhar_reg_no,\n    jsy_beneficiaries_with_aadhar_id_but_no_bank_details,jsy_beneficiaries_with_bank_acc_but_no_aadhar_details,\n    jsy_beneficiaries_with_no_aadhar_and_bank_details\n\n    ,regd_live_children,regd_no_live_children,c1_m1,c1_f1,c2_f2,c2_m2,c2_f1_m1,c3_f3,c3_m3,c3_m2_f1,c3_m1_f2,phi_del,phi_del_with_ppiucd\n\n    ,high_risk,current_preg_compl,severe_anemia,diabetes,\n    cur_mal_presentation_issue,cur_malaria_issue,multipara,\n    blood_pressure,interval_bet_preg_less_18_months,extreme_age,\n    height,weight,urine_albumin,\n\n    tt1,tt2_tt_booster,\n    early_anc,anc1,anc2,anc3,anc4,\n    no_of_delivery,mtp,abortion,live_birth,still_birth,\n    pnc1,pnc2,pnc3,pnc4,mother_death\n    ,ppiucd\n    ,complete_anc_date\n    ,ifa_180_anc_date\n\n)\nselect locations.location_id, locations.month_year\n,case when extract(month from locations.month_year) > 3\n    then concat(extract(year from locations.month_year), ''-'', extract(year from locations.month_year) + 1)\n    else concat(extract(year from locations.month_year) - 1, ''-'', extract(year from locations.month_year)) end as financial_year\n,rch_service_yearly_pregnancy_reg.anc_reg\n,rch_service_yearly_pregnancy_reg.beneficiaries_with_aadhar_reg_no\n,rch_service_yearly_pregnancy_reg.jsy_beneficiary\n,rch_service_yearly_pregnancy_reg.jsy_beneficiary_in_third_trimenster\n,rch_service_yearly_pregnancy_reg.jsy_beneficiaries_with_aadhar_and_bank_no\n,rch_service_yearly_pregnancy_reg.jsy_beneficiaries_with_aadhar_reg_no\n,rch_service_yearly_pregnancy_reg.jsy_beneficiaries_with_aadhar_id_but_no_bank_details\n,rch_service_yearly_pregnancy_reg.jsy_beneficiaries_with_bank_acc_but_no_aadhar_details\n,rch_service_yearly_pregnancy_reg.jsy_beneficiaries_with_no_aadhar_and_bank_details\n\n,rch_service_yearly_pregnancy_reg.regd_live_children\n,rch_service_yearly_pregnancy_reg.regd_no_live_children\n,rch_service_yearly_pregnancy_reg.c1_m1\n,rch_service_yearly_pregnancy_reg.c1_f1\n,rch_service_yearly_pregnancy_reg.c2_f2\n,rch_service_yearly_pregnancy_reg.c2_m2\n,rch_service_yearly_pregnancy_reg.c2_f1_m1\n,rch_service_yearly_pregnancy_reg.c3_f3\n,rch_service_yearly_pregnancy_reg.c3_m3\n,rch_service_yearly_pregnancy_reg.c3_m2_f1\n,rch_service_yearly_pregnancy_reg.c3_m1_f2\n,rch_service_yearly_pregnancy_reg.phi_del\n,rch_service_yearly_pregnancy_reg.phi_del_with_ppiucd\n\n,rch_service_yearly_pregnancy_reg.high_risk,current_preg_compl\n,rch_service_yearly_pregnancy_reg.severe_anemia,diabetes\n,rch_service_yearly_pregnancy_reg.cur_mal_presentation_issue\n,rch_service_yearly_pregnancy_reg.cur_malaria_issue\n,rch_service_yearly_pregnancy_reg.multipara\n,rch_service_yearly_pregnancy_reg.blood_pressure\n,rch_service_yearly_pregnancy_reg.interval_bet_preg_less_18_months\n,rch_service_yearly_pregnancy_reg.extreme_age\n,rch_service_yearly_pregnancy_reg.height\n,rch_service_yearly_pregnancy_reg.weight\n,rch_service_yearly_pregnancy_reg.urine_albumin\n\n,rch_yearly_vacination_tt1.tt1,\nrch_yearly_vacination_tt2_tt_booster.tt2_tt_booster,\nrch_service_yearly_pregnancy_reg.early_anc,\nrch_yearly_anc1.anc1,\nrch_yearly_anc2.anc2,\nrch_yearly_anc3.anc3,\nrch_yearly_anc4.anc4,\nrch_wpd_anc_det.no_of_delivery,\nrch_wpd_anc_det.mtp,\nrch_wpd_anc_det.abortion,\nrch_wpd_anc_det.live_birth,\nrch_wpd_anc_det.still_birth,\nrch_yearly_pnc1.pnc1,\nrch_yearly_pnc2.pnc2,\nrch_yearly_pnc3.pnc3,\nrch_yearly_pnc4.pnc4,\nrch_yearly_maternal_death_det.maternal_detah,\nppiucd_det.ppiucd,\ncomplete_anc_date_det.complete_anc_date,\nifa_180_anc_date_det.ifa_180_anc_date\nfrom locations\nleft join rch_service_yearly_pregnancy_reg on rch_service_yearly_pregnancy_reg.location_id = locations.location_id\n    and rch_service_yearly_pregnancy_reg.month_year = locations.month_year\nleft join rch_yearly_vacination_tt1 on rch_yearly_vacination_tt1.location_id = locations.location_id\n    and rch_yearly_vacination_tt1.month_year = locations.month_year\nleft join rch_yearly_vacination_tt2_tt_booster on rch_yearly_vacination_tt2_tt_booster.location_id = locations.location_id\n    and rch_yearly_vacination_tt2_tt_booster.month_year = locations.month_year\nleft join rch_yearly_anc1 on rch_yearly_anc1.location_id = locations.location_id\n    and rch_yearly_anc1.month_year = locations.month_year\nleft join rch_yearly_anc2 on rch_yearly_anc2.location_id = locations.location_id\n    and rch_yearly_anc2.month_year = locations.month_year\nleft join rch_yearly_anc3 on rch_yearly_anc3.location_id = locations.location_id\n    and rch_yearly_anc3.month_year = locations.month_year\nleft join rch_yearly_anc4 on rch_yearly_anc4.location_id = locations.location_id\n    and rch_yearly_anc4.month_year = locations.month_year\nleft join rch_wpd_anc_det on rch_wpd_anc_det.location_id = locations.location_id\n    and rch_wpd_anc_det.month_year = locations.month_year\nleft join rch_yearly_pnc1 on rch_yearly_pnc1.location_id = locations.location_id\n    and rch_yearly_pnc1.month_year = locations.month_year\nleft join rch_yearly_pnc2 on rch_yearly_pnc2.location_id = locations.location_id\n    and rch_yearly_pnc2.month_year = locations.month_year\nleft join rch_yearly_pnc3 on rch_yearly_pnc3.location_id = locations.location_id\n    and rch_yearly_pnc3.month_year = locations.month_year\nleft join rch_yearly_pnc4 on rch_yearly_pnc4.location_id = locations.location_id\n    and rch_yearly_pnc4.month_year = locations.month_year\nleft join rch_yearly_maternal_death_det on rch_yearly_maternal_death_det.location_id = locations.location_id\n    and rch_yearly_maternal_death_det.month_year = locations.month_year\nleft join ppiucd_det on ppiucd_det.location_id = locations.location_id\n    and ppiucd_det.month_year = locations.month_year\nleft join complete_anc_date_det on complete_anc_date_det.location_id = locations.location_id\n    and complete_anc_date_det.month_year = locations.month_year\nleft join ifa_180_anc_date_det on ifa_180_anc_date_det.location_id = locations.location_id\n    and ifa_180_anc_date_det.month_year = locations.month_year;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED18''\nwhere event_config_id = 39 and status = ''PROCESSED17'';\ncommit;\n\nbegin; \n\ndrop table if exists rch_lmp_base_location_wise_data_point;\nALTER TABLE rch_lmp_base_location_wise_data_point_t\n  RENAME TO rch_lmp_base_location_wise_data_point;\n\n---21\ndrop table if exists rch_delivery_date_base_location_wise_data_point;\nALTER TABLE rch_delivery_date_base_location_wise_data_point_t\n  RENAME TO rch_delivery_date_base_location_wise_data_point;\n  \n---22\ndrop table if exists rch_yearly_location_wise_analytics_data;\nALTER TABLE rch_yearly_location_wise_analytics_data_t\n  RENAME TO rch_yearly_location_wise_analytics_data;\n  \n---23\ndrop table if exists rch_current_state_pregnancy_analytics_data;\nALTER TABLE rch_current_state_pregnancy_analytics_data_t\n  RENAME TO rch_current_state_pregnancy_analytics_data;\n  \n---24\ndrop table if exists rch_service_provided_during_year;\nALTER TABLE rch_service_provided_during_year_t\n  RENAME TO rch_service_provided_during_year;\n  \nupdate system_configuration set key_value = TO_CHAR(current_date, ''MM-DD-YYYY'') \nwhere system_key = ''rch_pregnancy_analytics_last_schedule_date'';\n\nupdate system_configuration set key_value = ''false'' \nwhere system_key = ''rch_pregnancy_analytics_run_for_all_pregnancy'';\n  \nupdate timer_event SET completed_on = clock_timestamp(),status = ''PROCESSED19''\nwhere event_config_id = 39 and status = ''PROCESSED18'';\n\ncommit;\n\nbegin;\ndrop table if exists rch_anemia_status_analytics_t;\ncreate table rch_anemia_status_analytics_t(\nlocation_id integer,\nmonth_year date,\nanc_reg integer,\nanc_with_hb integer,\nanc_with_hb_more_than_4 integer,\nmild_hb integer,\nmodrate_hb integer,\nsevere_hb integer,\nnormal_hb integer,\nsevere_hb_with_iron_def_inj integer,\nsevere_hb_with_blood_transfusion integer,\nprimary key (location_id,month_year)\n);\n\ninsert into rch_anemia_status_analytics_t(\nlocation_id\n,month_year\n,anc_reg\n,anc_with_hb\n,anc_with_hb_more_than_4\n,mild_hb\n,modrate_hb\n,severe_hb\n,normal_hb\n,severe_hb_with_iron_def_inj\n,severe_hb_with_blood_transfusion\n)\nselect \nrprd.native_location_id as location_id\n,cast(date_trunc(''month'', rprd.reg_service_date) as date) as month_year\n,count(*) as anc_reg\n,count(1) filter(where hb >= 0.1) as anc_with_hb\n,count(1) filter(where haemoglobin_tested_count >= 4) as anc_with_hb_more_than_4\n,count(1) filter(where hb between 10 and 10.99) as mild_hb\n,count(1) filter(where hb between 7 and 9.99) as modrate_hb\n,count(1) filter(where hb between 0.1 and 6.99) as severe_hb\n,count(1) filter(where hb >= 11) as normal_hb\n,count(1) filter(where hb between 0.1 and 6.99 and iron_def_anemia_inj is not null) as severe_hb_with_iron_def_inj\n,count(1) filter(where hb between 0.1 and 6.99 and blood_transfusion) as severe_hb_with_blood_transfusion\nfrom rch_pregnancy_analytics_details rprd\ngroup by rprd.native_location_id,cast(date_trunc(''month'', rprd.reg_service_date) as date);\n\ndrop table if exists rch_anemia_status_analytics;\nALTER TABLE rch_anemia_status_analytics_t\n  RENAME TO rch_anemia_status_analytics;\n\nupdate timer_event SET completed_on = clock_timestamp(),status = ''COMPLETED''\nwhere event_config_id = 39 and status = ''PROCESSED19'';\n\ncommit;","mobileNotificationType":null,"mobileNotificationTypeUUID":null,"emailSubject":null,"emailSubjectParameter":null,"templateParameter":null,"baseDateFieldName":null,"refCode":null,"memberFieldName":null,"userFieldName":null,"familyFieldName":null,"trigerWhen":"IMMEDIATELY","day":null,"hour":null,"miniute":null,"mobileNotificationConfigs":null,"configId":39,"queryMasterId":null,"queryCode":null,"queryMasterParamJson":null,"exceptionType":null,"exceptionMessage":null,"smsConfigJson":null,"systemFunctionId":null,"functionParams":null}]}]}]','ACTIVE','DAILY',NULL,'0873826b-e125-446c-bf4f-5e3b0d83c450');
